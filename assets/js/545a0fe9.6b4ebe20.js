"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[4090],{4506:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"mikrotik/l2tp/l2tpIPsec","title":"l2tp/IPSec","description":"RouterOS server configuration","source":"@site/docs/mikrotik/l2tp/l2tpIPsec.mdx","sourceDirName":"mikrotik/l2tp","slug":"/mikrotik/l2tp/l2tpIPsec","permalink":"/docs/mikrotik/l2tp/l2tpIPsec","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"l2tp/IPSec","displayed_sidebar":"mikrotikSidebar"},"sidebar":"mikrotikSidebar","previous":{"title":"l2tp no IPSec","permalink":"/docs/mikrotik/l2tp/l2tp-server-client"}}');var s=t(4848),i=t(8453);const o={sidebar_label:"l2tp/IPSec",displayed_sidebar:"mikrotikSidebar"},a="l2tp/IPSec",c={},l=[{value:"RouterOS server configuration",id:"routeros-server-configuration",level:2},{value:"step 1 enable the l2tp server",id:"step-1-enable-the-l2tp-server",level:3},{value:"step 2 create a vpn pool",id:"step-2-create-a-vpn-pool",level:3},{value:"RouterOs Client configuration",id:"routeros-client-configuration",level:2},{value:"make the routes for each router",id:"make-the-routes-for-each-router",level:2},{value:"Router A",id:"router-a",level:3},{value:"Router B",id:"router-b",level:3}];function d(e){const r={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"l2tpipsec",children:"l2tp/IPSec"})}),"\n",(0,s.jsx)(r.h2,{id:"routeros-server-configuration",children:"RouterOS server configuration"}),"\n",(0,s.jsx)(r.h3,{id:"step-1-enable-the-l2tp-server",children:"step 1 enable the l2tp server"}),"\n",(0,s.jsx)(r.p,{children:"Enable the l2tp server"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/interface l2tp-server server set enabled=ues use-ipsec=required ipsec-secret=1020 default-profile=default\n"})}),"\n",(0,s.jsx)(r.p,{children:"use-ipsec is set to required to make sure that only IPsec encapsulated L2TP connections are accepted"}),"\n",(0,s.jsx)(r.p,{children:"Now what it does is enables an L2TP server and creates a dynamic IPsec peer with a specified secret."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"[admin@MikroTik] /ip ipsec peer> print\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"caution",children:(0,s.jsx)(r.p,{children:"Care must be taken if static IPsec peer configuration exists."})}),"\n",(0,s.jsx)(r.h3,{id:"step-2-create-a-vpn-pool",children:"step 2 create a vpn pool"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/ip pool add name=vpn-pool range=10.10.1.2-10.10.1.100\n\n/ppp profile\nset default local-address=10.10.1.1 remote-address=vpn-pool\n\n/ppp secret\nadd name=user1 password=123\nadd name=user2 password=123\n"})}),"\n",(0,s.jsx)(r.h2,{id:"routeros-client-configuration",children:"RouterOs Client configuration"}),"\n",(0,s.jsx)(r.p,{children:"For RouterOS to work as L2TP/IPsec client, it is as simple as adding a new L2TP client."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/interface l2tp-client\nadd connect-to=<Public-IP> disabled=no ipsec-secret=mySecret name=l2tp-out1 \\\npassword=123 use-ipsec=yes user=user1\n"})}),"\n",(0,s.jsx)(r.p,{children:"It will automatically create dynamic IPsec peer and policy configurations."}),"\n",(0,s.jsx)(r.h2,{id:"make-the-routes-for-each-router",children:"make the routes for each router"}),"\n",(0,s.jsx)(r.h3,{id:"router-a",children:"Router A"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"add distance=1 dst-address=192.168.100.0/24 gateway=10.10.1.100\n"})}),"\n",(0,s.jsx)(r.h3,{id:"router-b",children:"Router B"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"add distance=1 dst-address=192.168.50.0/24 gateway=10.10.1.1\n"})})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>a});var n=t(6540);const s={},i=n.createContext(s);function o(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);