"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[9516],{818:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"linux/users","title":"User management","description":"Create user with root privileges","source":"@site/docs/linux/users.mdx","sourceDirName":"linux","slug":"/linux/users","permalink":"/docs/linux/users","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"User management","sidebar_position":3,"displayed_sidebar":"linuxSidebar"},"sidebar":"linuxSidebar","previous":{"title":"Basic commands","permalink":"/docs/linux/terminal_basics"},"next":{"title":"SSH keys","permalink":"/docs/linux/ssh"}}');var i=r(4848),o=r(8453);const t={sidebar_label:"User management",sidebar_position:3,displayed_sidebar:"linuxSidebar"},d="User management",l={},a=[{value:"Create user with root privileges",id:"create-user-with-root-privileges",level:2},{value:"1. Create user",id:"1-create-user",level:3},{value:"2. Grant normal User with root privileges",id:"2-grant-normal-user-with-root-privileges",level:3},{value:"3. Restrict SSH login as root",id:"3-restrict-ssh-login-as-root",level:3},{value:"Groups",id:"groups",level:2},{value:"1. Creating Groups",id:"1-creating-groups",level:3},{value:"2. Adding Users to Groups",id:"2-adding-users-to-groups",level:3},{value:"3. Special Bits",id:"3-special-bits",level:3}];function c(e){const s={admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"user-management",children:"User management"})}),"\n",(0,i.jsx)(s.h2,{id:"create-user-with-root-privileges",children:"Create user with root privileges"}),"\n",(0,i.jsx)(s.h3,{id:"1-create-user",children:"1. Create user"}),"\n",(0,i.jsxs)(s.p,{children:["First step is to create the user, use ",(0,i.jsx)(s.code,{children:"useradd"})," as the universal approach for all families or ",(0,i.jsx)(s.code,{children:"adduser"})," for guided creation under Debian"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="With home folder and full name"',children:'sudo useradd -m -c "Boris Kolev" boris\n'})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"-m"})," is for creating a home folder based on ",(0,i.jsx)(s.code,{children:"/etc/skel"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"-c"})," is for adding a comment where we add the full name"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="add new user Debian only, will create home folder and ask for pass"',children:"sudo adduser boris\n"})}),"\n",(0,i.jsxs)(s.p,{children:["If you want to change the password of a user use ",(0,i.jsx)(s.code,{children:"passwd"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo passwd boris\n"})}),"\n",(0,i.jsx)(s.h3,{id:"2-grant-normal-user-with-root-privileges",children:"2. Grant normal User with root privileges"}),"\n",(0,i.jsxs)(s.p,{children:["One way is to add the user to ",(0,i.jsx)(s.code,{children:"/etc/sudoers"})," list. You must open the config file with ",(0,i.jsx)(s.code,{children:"visudo"})," command as root"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="open visudo"',children:"sudo visudo\n"})}),"\n",(0,i.jsx)(s.p,{children:"when the sudoers config file is opened, append the following after root..."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="/etc/sudoers"',children:"...\r\n# User privilege specification\r\nroot      ALL=(ALL:ALL) ALL\r\nboris     ALL=(ALL:ALL) ALL\r\n...\n"})}),"\n",(0,i.jsx)(s.p,{children:"We can interpret the upper like this:"}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"boris ALL=(ALL:ALL) ALL"}),(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"who where=(run-as) (commands)"}),(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"boris onEveryHost=(as every USER : or GROUP) (all commands)"}),(0,i.jsx)(s.br,{}),"\n","Allow user to run any command as any user/group using sudo:",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"sudo -u otheruser -g othergroup somecommand"})]}),"\n"]}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsxs)(s.p,{children:["Never edit the sudoers with other tool, awlays use ",(0,i.jsx)(s.code,{children:"visudo"})]})}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsxs)(s.p,{children:["when the console ends with ",(0,i.jsx)(s.code,{children:"$"})," you are normal user and will need to use ",(0,i.jsx)(s.code,{children:"sudo"})," ",(0,i.jsx)(s.em,{children:"SuperUserDo"})," or you can type ",(0,i.jsx)(s.code,{children:"sudo bash"})," and the bash will open as root ",(0,i.jsx)(s.code,{children:"#"})]})}),"\n",(0,i.jsx)(s.h3,{id:"3-restrict-ssh-login-as-root",children:"3. Restrict SSH login as root"}),"\n",(0,i.jsxs)(s.p,{children:["It is awlays a good idea to restrict SSH login as ",(0,i.jsx)(s.code,{children:"root"})," everyone can brute force it, you can do this by changing the ",(0,i.jsx)(s.code,{children:"etc/ssh/sshd_config"})]}),"\n",(0,i.jsx)(s.p,{children:"add the following"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="/etc/ssh/sshd_conf"',children:"PermitRootLogin no\n"})}),"\n",(0,i.jsxs)(s.p,{children:["save the file, restart the ssh ",(0,i.jsx)(s.code,{children:"systemctl restart sshd"})," and try to login via SSH as ",(0,i.jsx)(s.code,{children:"root"})]}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsxs)(s.p,{children:["Be sure you ",(0,i.jsx)(s.strong,{children:"have a root user with SSH access"})," before restricting the ",(0,i.jsx)(s.code,{children:"root"})," login"]})}),"\n",(0,i.jsx)(s.h2,{id:"groups",children:"Groups"}),"\n",(0,i.jsx)(s.h3,{id:"1-creating-groups",children:"1. Creating Groups"}),"\n",(0,i.jsx)(s.p,{children:"Create a group named maintenance with group ID 2000"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo groupadd  -g 2000 maintenance\n"})}),"\n",(0,i.jsx)(s.h3,{id:"2-adding-users-to-groups",children:"2. Adding Users to Groups"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo usermod -aG maintenance boris\n"})}),"\n",(0,i.jsx)(s.h3,{id:"3-special-bits",children:"3. Special Bits"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:['Setuid(s) on a file = "Run as the file owner." ',(0,i.jsx)(s.code,{children:"chmod u+s myprogram"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:['Setgid(s) on a folder = "New files/folders keep this group." ',(0,i.jsx)(s.code,{children:"chmod g+s /shared/folder"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:['Sticky Bit(t) on a folder = "Only the file owner can delete their own files." ',(0,i.jsx)(s.code,{children:"chmod +t /tmp"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Special Bit"}),(0,i.jsx)(s.th,{children:"For Files"}),(0,i.jsx)(s.th,{children:"For Directories"}),(0,i.jsx)(s.th,{children:"Meaning"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Setuid (s)"}),(0,i.jsx)(s.td,{children:"When a file is executed, it runs with the owner's privileges."}),(0,i.jsx)(s.td,{children:"Not used for directories."}),(0,i.jsx)(s.td,{children:"Used on executables like /usr/bin/passwd (change password)."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Setgid (s)"}),(0,i.jsx)(s.td,{children:"When a file is executed, it runs with the group's privileges."}),(0,i.jsx)(s.td,{children:"New files/folders created inside the directory inherit the directory's group."}),(0,i.jsx)(s.td,{children:"Common in shared project folders."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Sticky Bit (t)"}),(0,i.jsx)(s.td,{children:"Not useful for files anymore."}),(0,i.jsx)(s.td,{children:"Users can only delete their own files inside the directory."}),(0,i.jsx)(s.td,{children:"Used on /tmp to avoid users deleting each other's files."})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"The interesting and usefull here is the setgid bit, where newly created files/folders keeps the same group."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="setgid(s) bit"',children:"chmod g+s /shared/folder\n"})}),"\n",(0,i.jsxs)(s.p,{children:["lets create a folder and inspect it permissions before setting the ",(0,i.jsx)(s.strong,{children:"gid bit"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"boris@BorisLegion:/$ sudo mkdir -pv /shared/folder\r\n[sudo] password for boris:\r\nmkdir: created directory '/shared'\r\nmkdir: created directory '/shared/folder'\n"})}),"\n",(0,i.jsx)(s.p,{children:"check the long list"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:"title='no gid bit'",children:"boris@BorisLegion:/$ ls -l /shared/\r\ntotal 4\r\ndrwxr-xr-x 2 root root 4096 Apr 28 06:09 folder\n"})}),"\n",(0,i.jsx)(s.p,{children:"create a simple file"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="no gid bit"',children:"boris@BorisLegion:/$ sudo touch /shared/folder/file1.txt\r\nboris@BorisLegion:/$ ls /shared/folder/file1.txt\r\n/shared/folder/file1.txt\r\nboris@BorisLegion:/$ ls -l /shared/folder/file1.txt\r\n-rw-r--r-- 1 root root 0 Apr 28 06:13 /shared/folder/file1.txt\n"})}),"\n",(0,i.jsx)(s.p,{children:"now lets set that special gid bit"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"boris@BorisLegion:/$ sudo chmod g+s /shared/folder/\r\nboris@BorisLegion:/$ ls -l /shared/\r\ntotal 4\r\ndrwxr-sr-x 2 root root 4096 Apr 28 06:13 folder\r\nboris@BorisLegion:/$\n"})}),"\n",(0,i.jsxs)(s.p,{children:["We see that we have that ",(0,i.jsx)(s.code,{children:"s"})," instead ",(0,i.jsx)(s.code,{children:"x"})," in the group permission Bits. All good but now we have to change the ownership of the folder.\r\nLets change ",(0,i.jsx)(s.strong,{children:"ownership"})," for all files and folders inside to ",(0,i.jsx)(s.strong,{children:"user"})," boris and ",(0,i.jsx)(s.strong,{children:"group"})," maintenace:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",metastring:'title="ownership"',children:"boris@BorisLegion:/$ sudo chown -R  boris:maintenance /shared/folder\r\nboris@BorisLegion:/$ ls -l /shared/\r\ntotal 4\r\ndrwxr-sr-x 2 boris maintenance 4096 Apr 28 06:13 folder\r\nboris@BorisLegion:/$ ls -l /shared/folder/\r\ntotal 0\r\n-rw-r--r-- 1 boris maintenance 0 Apr 28 06:13 file1.txt\n"})}),"\n",(0,i.jsx)(s.p,{children:"let us explore further:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"boris@BorisLegion:/$ touch /shared/folder/file2.txt\r\nboris@BorisLegion:/$ ls -l /shared/folder/\r\ntotal 0\r\n-rw-r--r-- 1 boris maintenance 0 Apr 28 06:13 file1.txt\r\n-rw-r--r-- 1 boris maintenance 0 Apr 28 06:30 file2.txt\r\nboris@BorisLegion:/$ umask\r\n0022\n"})}),"\n",(0,i.jsxs)(s.p,{children:["when we create a new file in the shared folder we do not use sudo but we see it is not write-enabled for the group why is that?\r\nWe will explore the ",(0,i.jsx)(s.strong,{children:"umask"})]}),"\n",(0,i.jsxs)(s.p,{children:["We can set the ",(0,i.jsx)(s.strong,{children:"umask"})," to 002 this way files created by us will have rights for files ",(0,i.jsx)(s.code,{children:"666 - 002 = 664"})," and for folders ",(0,i.jsx)(s.code,{children:"777 - 002 = 775"})]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>t,x:()=>d});var n=r(6540);const i={},o=n.createContext(i);function t(e){const s=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);