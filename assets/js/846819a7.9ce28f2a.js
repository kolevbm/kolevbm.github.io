"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[4615],{7151:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"mikrotik/l2tp/l2tp-server-client","title":"L2tp server","description":"not yet tested","source":"@site/docs/mikrotik/l2tp/l2tp-server-client.mdx","sourceDirName":"mikrotik/l2tp","slug":"/mikrotik/l2tp/l2tp-server-client","permalink":"/docs/mikrotik/l2tp/l2tp-server-client","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"l2tp no IPSec","displayed_sidebar":"mikrotikSidebar"},"sidebar":"mikrotikSidebar","previous":{"title":"DHCP-Server","permalink":"/docs/mikrotik/dhcp-server/"},"next":{"title":"l2tp/IPSec","permalink":"/docs/mikrotik/l2tp/l2tpIPsec"}}');var i=n(4848),r=n(8453);const l={sidebar_label:"l2tp no IPSec",displayed_sidebar:"mikrotikSidebar"},o="L2tp server",d={},a=[{value:"Starting point",id:"starting-point",level:2},{value:"start the l2tp server",id:"start-the-l2tp-server",level:3},{value:"start the l2tp client",id:"start-the-l2tp-client",level:3},{value:"firewall rule to enable udp for l2tp",id:"firewall-rule-to-enable-udp-for-l2tp",level:2},{value:"add a routes for site to site connection",id:"add-a-routes-for-site-to-site-connection",level:2},{value:"Router-B",id:"router-b",level:3},{value:"Router-B",id:"router-b-1",level:3},{value:"Disable/ stop l2tp client",id:"disable-stop-l2tp-client",level:2},{value:"step 1 Disable PPP Secret",id:"step-1-disable-ppp-secret",level:3},{value:"step 2 Stop active session",id:"step-2-stop-active-session",level:3}];function c(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"l2tp-server",children:"L2tp server"})}),"\n",(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsx)(t.p,{children:"not yet tested"})}),"\n",(0,i.jsx)(t.h2,{id:"starting-point",children:"Starting point"}),"\n",(0,i.jsxs)(t.p,{children:["This is run on a simulated GNS3 environement set as follows:\n",(0,i.jsx)(t.img,{alt:"netwok-map",src:n(1918).A+"",width:"1228",height:"612"})]}),"\n",(0,i.jsx)(t.p,{children:"The goal is to create a site-to-site tunnel connection between the two sites, where the server has a static real IP and the client is not obligated to have static IP."}),"\n",(0,i.jsx)(t.admonition,{title:"without IPSec",type:"note",children:(0,i.jsx)(t.p,{children:"This example does not use IPSec so the tunnel will not be encrypted."})}),"\n",(0,i.jsx)(t.h3,{id:"start-the-l2tp-server",children:"start the l2tp server"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"[admin@MikroTik] > /interface l2tp-server server set enabled=yes\n[admin@MikroTik] > /ppp secret add local-address=10.0.0.2 name=MT-User password=StrongPass profile=default-encryption remote-address=10.0.0.1 service=l2tp\n"})}),"\n",(0,i.jsx)(t.p,{children:"where:\nlocal-address is Router B\nremote-address is router A"}),"\n",(0,i.jsx)(t.h3,{id:"start-the-l2tp-client",children:"start the l2tp client"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"[admin@MikroTik] > /interface l2tp-client \\\nadd connect-to=192.168.51.3 disabled=no name=MT-User password=StrongPass user=MT-User\n"})}),"\n",(0,i.jsx)(t.p,{children:"where:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"connect-to=192.168.51.3 is the server real static ip address"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'[admin@MikroTik] > /interface l2tp-client print\nFlags: X - disabled, R - running\n0 R name="MT-User" max-mtu=1450 max-mru=1450 mrru=disabled connect-to=192.168.51.3 user="MT-User"\npassword="StrongPass" profile=default-encryption keepalive-timeout=60 use-ipsec=no ipsec-secret=""\nallow-fast-path=no add-default-route=no dial-on-demand=no allow=pap,chap,mschap1,mschap2\n'})}),"\n",(0,i.jsx)(t.h2,{id:"firewall-rule-to-enable-udp-for-l2tp",children:"firewall rule to enable udp for l2tp"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'/ip firewall filter\nadd action=accept chain=input comment="allow udp ltp2" dst-port=1701 in-interface=ether1 protocol=udp\n'})}),"\n",(0,i.jsx)(t.h2,{id:"add-a-routes-for-site-to-site-connection",children:"add a routes for site to site connection"}),"\n",(0,i.jsx)(t.h3,{id:"router-b",children:"Router-B"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"/ip route\nadd distance=1 dst-address=192.168.100.0/24 gateway=10.0.0.1\n"})}),"\n",(0,i.jsx)(t.p,{children:"where:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"dst-address is the local network of Router-B"}),"\n",(0,i.jsx)(t.li,{children:"gateway is the remote-address given in the ppp secret"}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"router-b-1",children:"Router-B"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"/ip route\nadd distance=1 dst-address=192.168.50.0/24 gateway=10.0.0.2\n"})}),"\n",(0,i.jsx)(t.p,{children:"where:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"dst-address is the local network of Router-A"}),"\n",(0,i.jsx)(t.li,{children:"gateway is the local-address given in the ppp secret"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"disable-stop-l2tp-client",children:"Disable/ stop l2tp client"}),"\n",(0,i.jsx)(t.p,{children:"disabling PPP Secret does not disconnect the current session, it only prevents new login so it is not enough."}),"\n",(0,i.jsx)(t.h3,{id:"step-1-disable-ppp-secret",children:"step 1 Disable PPP Secret"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"/ppp secret set remoteSite  disabled=yes\n"})}),"\n",(0,i.jsx)(t.h3,{id:"step-2-stop-active-session",children:"step 2 Stop active session"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"/ppp active print\n/ppp active remove [connection number]\n"})})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1918:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/lt2p-map-fb6e2e74eccd57ae3a9b2db3b032162b.png"},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);