"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[2886],{9277:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>l,frontMatter:()=>a,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"mikrotik/dhcp-server/dhcp-server","title":"DHCP-Server configuration","description":"Starting point","source":"@site/docs/mikrotik/dhcp-server/dhcp-server.mdx","sourceDirName":"mikrotik/dhcp-server","slug":"/mikrotik/dhcp-server/","permalink":"/docs/mikrotik/dhcp-server/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"DHCP-Server","displayed_sidebar":"mikrotikSidebar"},"sidebar":"mikrotikSidebar"}');var s=r(4848),i=r(8453);const a={sidebar_label:"DHCP-Server",displayed_sidebar:"mikrotikSidebar"},d="DHCP-Server configuration",c={},h=[{value:"Starting point",id:"starting-point",level:2},{value:"1. Add an ip adress to the interface running DHCP server",id:"1-add-an-ip-adress-to-the-interface-running-dhcp-server",level:2},{value:"2. Setup the DHCP server",id:"2-setup-the-dhcp-server",level:2},{value:"3. Masquarading",id:"3-masquarading",level:2},{value:"4. Test the DHCP server",id:"4-test-the-dhcp-server",level:2},{value:"5. Check the DHCP leases",id:"5-check-the-dhcp-leases",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"dhcp-server-configuration",children:"DHCP-Server configuration"})}),"\n",(0,s.jsx)(n.h2,{id:"starting-point",children:"Starting point"}),"\n",(0,s.jsx)(n.p,{children:"This is run on a simulated environement using VirtualBox. There we have two machines:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Machine-A ",(0,s.jsx)(n.a,{href:"https://mikrotik.com/download",children:"MikroTik CHR"})," (Cloud Hosted Router):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"running RouterOS"}),"\n",(0,s.jsxs)(n.li,{children:["Network Adapter 1: ",(0,s.jsx)(n.code,{children:"ether1"})," is NATed to the internet"]}),"\n",(0,s.jsxs)(n.li,{children:["Network Adapter 2: ",(0,s.jsx)(n.code,{children:"ether2"}),' is Attached to internal network named "R1"']}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Machine-B a Debian distro to check the DHCP server:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"running Debian 11"}),"\n",(0,s.jsxs)(n.li,{children:["Network Adapter 1: ",(0,s.jsx)(n.code,{children:"eth0"}),' is Attached to internal network named "R1"']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The configuration is done using the CLI mainly on Machine-A the Mikrotik CHR."}),"\n",(0,s.jsx)(n.h2,{id:"1-add-an-ip-adress-to-the-interface-running-dhcp-server",children:"1. Add an ip adress to the interface running DHCP server"}),"\n",(0,s.jsxs)(n.p,{children:["Note that the interface may be bridge interface or just a single ethernet interface. In this example we are using ",(0,s.jsx)(n.code,{children:"ether2"})," as the interface running the DHCP server."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Add IP address to the interface"',children:"/ip address add address=192.168.50.1/24 interface=ether2 network=192.168.50.0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2-setup-the-dhcp-server",children:"2. Setup the DHCP server"}),"\n",(0,s.jsx)(n.p,{children:"we will use the built-in setup command."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Setup DHCP server"',children:"/ip dhcp-server setup\n"})}),"\n",(0,s.jsx)(n.p,{children:"and follow the prompts:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  Select interface to run DHCP server on\r\n  dhcp server interface: ether2\r\n\r\n  Select network for DHCP addresses\r\n  dhcp address space: 192.168.50.0/24\r\n\r\n  Select gateway for given network\r\n  gateway for dhcp network: 192.168.50.1\r\n\r\n  Select pool of ip addresses given out by DHCP server\r\n  addresses to give out: 192.168.50.55-192.168.50.60\r\n\r\n  Select DNS servers\r\n  dns servers: 192.168.100.1\r\n\r\n  Select lease time\r\n  lease time: 1800\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3-masquarading",children:"3. Masquarading"}),"\n",(0,s.jsxs)(n.p,{children:["To have an internet connection on the internal network (dhcp-server runing on ether2), we need to masquerade the traffic going out of ",(0,s.jsx)(n.code,{children:"ether1"})," (the NATed interface)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Masquerade"',children:"/ip firewall nat add chain=srcnat action=masquerade out-interface=ether1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["e.g. automatically ",(0,s.jsx)(n.strong,{children:"changes the source IP address"})," of packets leaving dhcp-server network ",(0,s.jsx)(n.strong,{children:"to the IP address of the outgoing interface"})," (the one with internet ether1)."]}),"\n",(0,s.jsx)(n.h2,{id:"4-test-the-dhcp-server",children:"4. Test the DHCP server"}),"\n",(0,s.jsx)(n.p,{children:"Just run the Debian machine and check if it gets an IP address from the DHCP server."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Check IP address"',children:"ip addr show\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="check gateway"',children:"ip route show\n"})}),"\n",(0,s.jsx)(n.p,{children:"with the output similar to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"default via 192.168.50.1 dev eth0\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Check internet connection and dns"',children:"ping google.com\n"})}),"\n",(0,s.jsx)(n.h2,{id:"5-check-the-dhcp-leases",children:"5. Check the DHCP leases"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Check DHCP leases"',children:"/ip dhcp-server lease print\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Flags: D - DYNAMIC\r\nColumns: ADDRESS, MAC-ADDRESS, HOST-NAME, SERVER, STATUS, LAST-SEEN\r\n#   ADDRESS        MAC-ADDRESS        HOST-NAME  SERVER  STATUS  LAST-SEEN\r\n0 D 192.168.50.60  08:00:27:C7:C0:7D  debian     dhcp1   bound   1m33s\n"})})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var t=r(6540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);