"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[1858],{6879:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"nvidia/kernel","title":"Jetson orin nano kernal customization image build and flash on target","description":"Introduction","source":"@site/docs/nvidia/kernel.md","sourceDirName":"nvidia","slug":"/nvidia/kernel","permalink":"/docs/nvidia/kernel","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"browser-snap issue, Jetpack 6.2.1","sidebar_position":1,"displayed_sidebar":"nvidiaSidebar"},"sidebar":"nvidiaSidebar"}');var r=i(4848),t=i(8453);const l={sidebar_label:"browser-snap issue, Jetpack 6.2.1",sidebar_position:1,displayed_sidebar:"nvidiaSidebar"},o="Jetson orin nano kernal customization image build and flash on target",a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"[0] Download and install the Toolchain",id:"0-download-and-install-the-toolchain",level:2},{value:"[1] Sync the kernel source with Git",id:"1-sync-the-kernel-source-with-git",level:2},{value:"[2] Customize the Kernel",id:"2-customize-the-kernel",level:2},{value:"[3] Build the Jetson Linux kernel and its in-tree modules",id:"3-build-the-jetson-linux-kernel-and-its-in-tree-modules",level:2},{value:"[4] Install the kernel and in-tree modules",id:"4-install-the-kernel-and-in-tree-modules",level:2},{value:"[5] Building the NVIDIA Out-of-Tree Modules",id:"5-building-the-nvidia-out-of-tree-modules",level:2},{value:"Put your Jetson developer kit into Force Recovery Mode",id:"put-your-jetson-developer-kit-into-force-recovery-mode",level:2},{value:"Flash via USB",id:"flash-via-usb",level:2}];function h(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"jetson-orin-nano-kernal-customization-image-build-and-flash-on-target",children:"Jetson orin nano kernal customization image build and flash on target"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(n.p,{children:["The goal of this writing is to clarify for myself how to do the Permanent kernel-build fix for the ",(0,r.jsx)(n.a,{href:"https://jetsonhacks.com/2025/07/12/why-chromium-suddenly-broke-on-jetson-orin-and-how-to-bring-it-back/",children:"browser issue and the snap update"})]}),"\n",(0,r.jsx)(n.h1,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You have installed SDKManager and at least once flashed the board with it.",(0,r.jsx)(n.br,{}),"\n","this assures that the nvidia_sdk and Linux for Tegra is downloaded."]}),"\n",(0,r.jsxs)(n.li,{children:["find the OS release notes for the current Jetpack Release. In the case of writing I am using ",(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/jetpack/release-notes/index.html",children:"JetPack 6.2.1"})," which is with OS ",(0,r.jsx)(n.strong,{children:"L4T 36.4.4"})," chek the ",(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/archives/r36.4.4/ReleaseNotes/Jetson_Linux_Release_Notes_r36.4.4.pdf",children:"release notes"}),", from there you can find the ",(0,r.jsx)(n.em,{children:"toolchain"})," and the ",(0,r.jsx)(n.em,{children:"Release Tag"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/archives/r36.4.4/DeveloperGuide/IN/QuickStart.html",children:"NVIDIA Jetson docs for r36.4.4"})," the main source of information for how things are done"]}),"\n",(0,r.jsx)(n.li,{children:"keep in mind that the you will export environment variables and they will be available for the current shell (?and subshells) unless added in .bashrc, hence when you start don't close the terminal you are working in"}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"kernel-customization",children:"Kernel customization"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/archives/r36.4.4/DeveloperGuide/SD/Kernel/KernelCustomization.html",children:"source of information"})}),"\n",(0,r.jsx)(n.h2,{id:"0-download-and-install-the-toolchain",children:"[0] Download and install the Toolchain"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/archives/r36.4.4/DeveloperGuide/AT/JetsonLinuxToolchain.html#at-jetsonlinuxtoolchain",children:"source of information"}),(0,r.jsx)(n.br,{}),"\n","when you download and extract the tool chain export the CROSS_COMPILE variable for the current shell"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export CROSS_COMPILE=$HOME/l4t-gcc/aarch64--glibc--stable-2022.08-1/bin/aarch64-buildroot-linux-gnu-\n"})}),"\n",(0,r.jsx)(n.h2,{id:"1-sync-the-kernel-source-with-git",children:"[1] Sync the kernel source with Git"}),"\n",(0,r.jsxs)(n.p,{children:["You have to run the ",(0,r.jsx)(n.code,{children:"source_sync.sh"})," script to get the kernel source"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd <install-path>/Linux_for_Tegra/source\n./source_sync.sh -k -t <release-tag>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["in my case <install-path> is : ",(0,r.jsx)(n.code,{children:"~/nvidia/nvidia_sdk/JetPack_6.2.1_Linux_JETSON_ORIN_NANO_TARGETS/Linux_for_Tegra/source"})]}),"\n",(0,r.jsxs)(n.li,{children:["<release tag> obtained from the OS release:\xa0",(0,r.jsx)(n.code,{children:"jetson_36.4.4"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"./source_sync.sh -k -t jetson_36.4.4\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2-customize-the-kernel",children:"[2] Customize the Kernel"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"go to the correct folder"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/nvidia/nvidia_sdk/JetPack_6.2.1_Linux_JETSON_ORIN_NANO_TARGETS/Linux_for_Tegra/source/kernel/kernel-jammy-src/arch/arm64/configs\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"create a copy of defconfig defconfig.bak instead of make menuconfig"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp defconfig defconfig.bak\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["make the following changes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'CONFIG_LOCALVERSION="-snap"'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"CONFIG_SQUASHFS_XATTR=y"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"CONFIG_SECURITY_APPARMOR=y"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"show the changes"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ diff defconfig defconfig.bak \n2d1\n< CONFIG_LOCALVERSION="-snap"\n1290d1288\n< CONFIG_SQUASHFS_XATTR=y\n1313d1310\n< CONFIG_SECURITY_APPARMOR=y\n'})}),"\n",(0,r.jsx)(n.p,{children:"TODO:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"notes about Makefile in upper kenrel-jammy-src directory"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-build-the-jetson-linux-kernel-and-its-in-tree-modules",children:"[3] Build the Jetson Linux kernel and its in-tree modules"}),"\n",(0,r.jsx)(n.p,{children:"go to the correct folder where the Makefile is and build it with make"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export CROSS_COMPILE=<toolchain-path>/bin/aarch64-buildroot-linux-gnu-\nmake ARCH=arm64 -C kernel\n"})}),"\n",(0,r.jsxs)(n.p,{children:["note here ",(0,r.jsx)(n.code,{children:"-C"})," means go inside folder ",(0,r.jsx)(n.code,{children:"kernel"})]}),"\n",(0,r.jsx)(n.h2,{id:"4-install-the-kernel-and-in-tree-modules",children:"[4] Install the kernel and in-tree modules"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export INSTALL_MOD_PATH=<install-path>/Linux_for_Tegra/rootfs/\nsudo -E make ARCH=arm64 install -C kernel\ncp kernel/kernel-jammy-src/arch/arm64/boot/Image \\\n  <install-path>/Linux_for_Tegra/kernel/Image\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-building-the-nvidia-out-of-tree-modules",children:"[5] Building the NVIDIA Out-of-Tree Modules"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"goto :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd <install-path>/Linux_for_Tegra/source\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"build:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export CROSS_COMPILE=<toolchain-path>/bin/aarch64-buildroot-linux-gnu-\nexport KERNEL_HEADERS=$PWD/kernel/kernel-jammy-src\nmake modules\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"install:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export INSTALL_MOD_PATH=<install-path>/Linux_for_Tegra/rootfs/\nsudo -E make modules_install\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"update the intramfs:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd <install-path>/Linux_for_Tegra\nsudo ./tools/l4t_update_initrd.sh\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"After the modules are installed and the kernel Image is copied to Linux_for_Tegra/kernel/\nWe can proceed to flashing the image"}),"\n",(0,r.jsx)(n.h1,{id:"flashing-the-device-with-new-kernel",children:"Flashing the device with new kernel"}),"\n",(0,r.jsx)(n.h2,{id:"put-your-jetson-developer-kit-into-force-recovery-mode",children:"Put your Jetson developer kit into Force Recovery Mode"}),"\n",(0,r.jsx)(n.p,{children:"For the Jetson Orin Nano developer kit:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Disconnect the power cable to ensure that the developer kit is powered off."}),"\n",(0,r.jsxs)(n.li,{children:["Place a jumper to short the ",(0,r.jsx)(n.strong,{children:"FC REC"})," and ",(0,r.jsx)(n.strong,{children:"GND"})," pins on the 12-pin button header."]}),"\n",(0,r.jsx)(n.li,{children:"Reconnect the power cable."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://docs.nvidia.com/jetson/archives/r36.4.4/DeveloperGuide/IN/QuickStart.html#to-determine-whether-the-developer-kit-is-in-force-recovery-mode",children:"confirm that the board is in recovery mode"})}),"\n",(0,r.jsx)(n.h2,{id:"flash-via-usb",children:"Flash via USB"}),"\n",(0,r.jsx)(n.p,{children:"Jetson Orin Nano Developer Kit with Super Configuration (NVMe) :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 \\\n  -c tools/kernel_flash/flash_l4t_t234_nvme.xml -p "-c bootloader/generic/cfg/flash_t234_qspi.xml" \\\n  --showlogs --network usb0 jetson-orin-nano-devkit-super internal\n'})}),"\n",(0,r.jsx)(n.h1,{id:"finishing-the-installation-on-the-device-and-final-steps",children:"Finishing the installation on the device and final steps"}),"\n",(0,r.jsx)(n.p,{children:"You have to finish the installation of the OS (username password etc.) on the jetson itself so grab a keyboard and a mouse and connect the board to a monitor via DisplayPort cable."}),"\n",(0,r.jsxs)(n.p,{children:["After you are ready edit the ",(0,r.jsx)(n.code,{children:"/boot/extlinux/extlinux.conf "})," and APPEND"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"apparmor=1 security=apparmor"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Restart and try to install firefox or chromium via ",(0,r.jsx)(n.code,{children:"apt-get install"})]}),"\n",(0,r.jsx)(n.p,{children:"Note: I wanted to install from software gui but it did not loaded the first time, after that I installed firefox from the terminal, expirienced some delay because of snapd autostart, but after a while the browser was installed."})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);