"use strict";(self.webpackChunktaking_notes=self.webpackChunktaking_notes||[]).push([[8130],{7735:e=>{e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"rpi lerobot so-arm101 teleoperate","metadata":{"permalink":"/blog/rpi lerobot so-arm101 teleoperate","source":"@site/blog/2025-12-29-so-arm101-on-rpi/index.md","title":"Teleoperation of SO-ARM101 on rpi 3B+ as a service","description":"Goal of this project:","date":"2025-12-29T00:00:00.000Z","tags":[{"inline":true,"label":"rpi","permalink":"/blog/tags/rpi"},{"inline":true,"label":"raspbery Pi","permalink":"/blog/tags/raspbery-pi"},{"inline":true,"label":"linux","permalink":"/blog/tags/linux"},{"inline":true,"label":"lerobot","permalink":"/blog/tags/lerobot"},{"inline":true,"label":"so-arm101","permalink":"/blog/tags/so-arm-101"},{"inline":true,"label":"so-arm","permalink":"/blog/tags/so-arm"},{"inline":true,"label":"robotics","permalink":"/blog/tags/robotics"},{"inline":true,"label":"systemd","permalink":"/blog/tags/systemd"},{"inline":true,"label":"udev","permalink":"/blog/tags/udev"}],"readingTime":4.88,"hasTruncateMarker":true,"authors":[{"name":"Boris Kolev","title":"owner","key":"boris","page":null}],"frontMatter":{"slug":"rpi lerobot so-arm101 teleoperate","title":"Teleoperation of SO-ARM101 on rpi 3B+ as a service","authors":["boris"],"tags":["rpi","raspbery Pi","linux","lerobot","so-arm101","so-arm","robotics","systemd","udev"]},"unlisted":false,"nextItem":{"title":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","permalink":"/blog/luckfox rv1106g canbus mcp2518fd"}},"content":"Goal of this project:  \\nWhen the rpi boots up, the teleoperation of arms to be activated shortly\\n{/* truncate */}\\n## Lab setup\\n\\nIn the beginning I had a lot of issues with the rpi recognising the usb boards of the arms, one of them, sometimes both, \\nhad problems connecting as a usb device, asked the GPT of course. It was a power issue concerning both the pi itself and the boards, so I connected an external powered usb hub and everything was fine.  \\nThe main flaw of this lab setup is the number of power outlets I needed. Everything was 5V but I had no strong power supply onboard, so I used power adapter for each device, 4 in total.\\n\\n```\\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \\n         \u2502   Bus Servo Driver   \u2502                                  \\n         \u2502        board         \u2502                                  \\n         \u2502      follower        \u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502   usb    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c         \u2502      \\n         \u2502ext.power\u2502                              \u2502         \u2502      \\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502   USB   \u253c\u2500\u2500\u2500\u2500\u2500\u2510\\n                                           usb    \u2502   hub   \u2502     \u2502\\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524         \u2502     \u2502\\n         \u2502   Bus Servo Driver   \u2502      \u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\\n         \u2502        board         \u2502      \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\\n         \u2502      follower        \u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502ext.power\u2502     \u2502\\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                              \u2502\\n         \u2502ext.power\u2502                                              \u2502\\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                              \u2502\\n                                                                  \u2502\\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\\n         \u2502                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 usb \u2502\\n         \u2502                                           \u2502      \u253c\u2500\u2500\u2500\u2500\u2500\u2518\\n         \u2502                                           \u2502      \u2502      \\n         \u2502                                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \\n         \u250c\u2510                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \\n         \u2502\u2502            RPI 3B+                       \u2502      \u2502      \\n         \u2502\u2502                                          \u2502      \u2502      \\n         \u2514\u2518                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \\n         \u2502                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \\n         \u2502                                           \u2502      \u2502      \\n         \u2502                                           \u2502      \u2502      \\n         \u2502    \u250c\u2500\u2500\u2500\u2510                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \\n         \u2514\u2500\u2500\u2500\u2500\u2514\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                               \\n         \u2502ext.power\u2502                                               \\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                               \\n```\\n\\n## Installation of lerobot on the rpi\\nFollowing the [official guide for the installation](https://huggingface.co/docs/lerobot/installation)  of the project  \\nI encountered issues with the free space while installing one of the dependencies `OSError: [Errno 28] No space left on device`. It was the `/tmp` folder, \\nit had only 454MB of free space . It turned out that `/tmp` is a `tmpfs` (RAM-backed filesystem) limited to ~454 MB\\n``` shell\\nFilesystem      Size  Used Avail Use% Mounted on\\nudev            317M     0  317M   0% /dev\\ntmpfs           182M  4.1M  178M   3% /run\\n/dev/mmcblk0p2   29G  7.4G   20G  27% /\\ntmpfs           454M     0  454M   0% /dev/shm\\ntmpfs           5.0M   12K  5.0M   1% /run/lock\\ntmpfs           1.0M     0  1.0M   0% /run/credentials/systemd-journald.service\\n// highlight-start\\ntmpfs           454M     0  454M   0% /tmp\\n// highlight-end\\n/dev/mmcblk0p1  510M   74M  437M  15% /boot/firmware\\ntmpfs           1.0M     0  1.0M   0% /run/credentials/getty@tty1.service\\ntmpfs           1.0M     0  1.0M   0% /run/credentials/serial-getty@ttyS0.service\\ntmpfs            91M  8.0K   91M   1% /run/user/1000\\n```\\nSo before installing the pip packages `pip install -e .` I created a tmp directory \\n``` bash\\nmkdir -p ~/pip-tmp\\n``` \\nand after that \\n``` bash\\nTMPDIR=~/pip-tmp pip install -e .\\n```\\n## Calibration of the arms\\nThe motor IDs were set before, but I did not have the calibration configurations `~/.cache/huggingface/lerobot/calibration/robots/so101_follower/red_sting.json` and `~/.cache/huggingface/lerobot/calibration/teleoperators/so101_leader/gray_hound.json` so I made the calibration again following the [official guide](https://huggingface.co/docs/lerobot/so101#calibrate) but this time with the API.  \\nFirst run the _isolated Python environment_\\n```bash \\nconda activate lerobot\\n```\\nand then run the script for each robot:\\n```python title=\\"follower\\"\\nfrom lerobot.robots.so101_follower import SO101FollowerConfig, SO101Follower\\n\\nconfig = SO101FollowerConfig(\\n    port=\\"/dev/ttyUSB_follower_arm\\",\\n    id=\\"red_sting\\",\\n)\\n\\nfollower = SO101Follower(config)\\nfollower.connect(calibrate=False)\\nfollower.calibrate()\\nfollower.disconnect()\\n```\\n\\n```python title=\\"leader\\"\\nfrom lerobot.teleoperators.so101_leader import SO101LeaderConfig, SO101Leader\\n\\nconfig = SO101LeaderConfig(\\n    port=\\"/dev/ttyUSB_leader_arm\\",\\n    id=\\"gray_hound\\",\\n)\\n\\nleader = SO101Leader(config)\\nleader.connect(calibrate=False)\\nleader.calibrate()\\nleader.disconnect()\\n```\\n## Initial test of teleoperation\\n\\nWhen calibrated it was time to test the teleoperation, so under the isolated Python environment I run this script:\\n```python title=\\"teleoperate.py\\"\\nfrom lerobot.teleoperators.so101_leader import SO101LeaderConfig, SO101Leader\\nfrom lerobot.robots.so101_follower import SO101FollowerConfig, SO101Follower\\n\\nrobot_config = SO101FollowerConfig(\\n    port=\\"/dev/ttyUSB_follower_arm\\",\\n    id=\\"red_sting\\",\\n)\\n\\nteleop_config = SO101LeaderConfig(\\n    port=\\"/dev/ttyUSB_leader_arm\\",\\n    id=\\"gray_hound\\",\\n)\\n\\nrobot = SO101Follower(robot_config)\\nteleop_device = SO101Leader(teleop_config)\\nrobot.connect()\\nteleop_device.connect()\\n\\nwhile True:\\n    action = teleop_device.get_action()\\n    robot.send_action(action)\\n```\\nI confirmed that everything is okay and proceeded to the automation itself\\n\\n## Make the usb boards (follower, leader arms) distinguishable, udev rules\\nFirst I had to be sure that the USB devices had the same name each time they were plugged into the USB bus. Most of the time they had `/dev/ttyACM1` file names, ranging from 0-5. That meant it was not sure that `/dev/ttyACM0` is the follower, it could be the leader arm.  \\nOne way to distinguish a device is to use the VID and PID listed from `lsusb` but in this case they were the same:\\n```\\nBus 001 Device 061: ID 1a86:55d3 QinHeng Electronics USB Single Serial\\nBus 001 Device 062: ID 1a86:55d3 QinHeng Electronics USB Single Serial\\n```\\nAnother way is to bind it to the specific usb port, but it was not okay, so I used the `udevadm info` to check the serial ID of each chip inside. One by one knowing for sure that `/dev/ttyACM0` is the correct arm, I found the `ATTRS{serial}` of each motor driver PCB:\\n\\n```\\nudevadm info -a /dev/ttyACM2 | grep -i serial\\n    ATTRS{product}==\\"USB Single Serial\\"\\n    // highlight-start\\n    ATTRS{serial}==\\"5AB9067929\\"\\n    // highlight-end\\n    ATTRS{serial}==\\"3f980000.usb\\"\\nudevadm info -a /dev/ttyACM3 | grep -i serial\\n    ATTRS{product}==\\"USB Single Serial\\"\\n    ATTRS{serial}==\\"5AB9067722\\"\\n    ATTRS{serial}==\\"3f980000.usb\\"    \\n```\\nThen I created a ___udev rule___ and placed that rule in `/etc/udev/rules.d/`\\n``` shell title=\\"98-LeRobot.rules\\"\\nSUBSYSTEM==\\"tty\\", ATTRS{serial}==\\"5AB9067722\\", SYMLINK+=\\"ttyUSB_follower_arm\\"\\nSUBSYSTEM==\\"tty\\", ATTRS{serial}==\\"5AB9067929\\", SYMLINK+=\\"ttyUSB_leader_arm\\"\\n```\\nWith these rules in place I run the following commands to reload and trigger the new rules\\n```\\nsudo udevadm control --reload  \\nsudo udevadm trigger\\n```   \\n\\n## Prepare the shell script\\nPrior to creating the project running as a service I had to create and test the `autoTeleoperation.sh` script. The script checks for the existance of the files `/dev/ttyUSB_follower_arm` and ` /dev/ttyUSB_leader_arm`, if so activates the isolated python environment and runs the python script `teleoperate.py`\\n```\\n#!/bin/bash\\nset -e #exit on error\\n\\nCONDA_BASE=\\"/home/boris/opt/miniforge3\\"\\nENV_NAME=\\"lerobot\\"\\nSCRIPT=\\"/home/boris/teleoperate.py\\"\\n\\n\\necho \\"Waiting for USB devices...\\"\\n\\n# -e checks if file exists\\nwhile [ ! -e /dev/ttyUSB_follower_arm ] || [ ! -e /dev/ttyUSB_leader_arm ]; do\\n    sleep 2\\ndone\\n\\n# Activate conda\\nsource \\"$CONDA_BASE/etc/profile.d/conda.sh\\"\\nconda activate \\"$ENV_NAME\\"\\n\\necho \\"Starting Teleoperation!\\"\\n# Run python script\\nexec python \\"$SCRIPT\\"\\n```\\n## Create the daemon\\n\\nAfter the test of the shell script it was timi to create the  service itself  \\nTODO: where it must be, how to load it, how to use journalctl -u to check for logs\\n\\n```shell title=\\"lerobot.service\\"\\n[Unit]\\nDescription=LeRobot startup service\\nAfter=network.target\\nWants=network.target\\n\\n[Service]\\nType=simple\\nUser=boris\\nWorkingDirectory=/home/boris/lerobot\\nExecStart=/home/boris/autoTeleoperate.sh\\nRestart=always\\nRestartSec=20\\nStandardOutput=journal\\nStandardError=journal\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n\\n## References"},{"id":"luckfox rv1106g canbus mcp2518fd","metadata":{"permalink":"/blog/luckfox rv1106g canbus mcp2518fd","source":"@site/blog/2025-11-27-luckfox-rv1106g-canbus/index.md","title":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","description":"Table of Contents:","date":"2025-11-27T00:00:00.000Z","tags":[{"inline":true,"label":"luckfox","permalink":"/blog/tags/luckfox"},{"inline":true,"label":"buildroot","permalink":"/blog/tags/buildroot"},{"inline":true,"label":"can","permalink":"/blog/tags/can"},{"inline":true,"label":"canbus","permalink":"/blog/tags/canbus"},{"inline":true,"label":"kernel","permalink":"/blog/tags/kernel"},{"inline":true,"label":"dts","permalink":"/blog/tags/dts"},{"inline":true,"label":"mcp251xfd","permalink":"/blog/tags/mcp-251-xfd"},{"inline":true,"label":"mcp2518fd","permalink":"/blog/tags/mcp-2518-fd"},{"inline":true,"label":"linux","permalink":"/blog/tags/linux"}],"readingTime":7.4,"hasTruncateMarker":true,"authors":[{"name":"Boris Kolev","title":"owner","key":"boris","page":null}],"frontMatter":{"slug":"luckfox rv1106g canbus mcp2518fd","title":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","authors":["boris"],"tags":["luckfox","buildroot","can","canbus","kernel","dts","mcp251xfd","mcp2518fd","linux"]},"unlisted":false,"prevItem":{"title":"Teleoperation of SO-ARM101 on rpi 3B+ as a service","permalink":"/blog/rpi lerobot so-arm101 teleoperate"},"nextItem":{"title":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0412\u0440\u0430\u0433\u044a\u0442 - \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438","permalink":"/blog/ego-is-the-enemy"}},"content":"import Tabs from \\"@theme/Tabs\\";\\nimport TabItem from \\"@theme/TabItem\\";\\n\\n**Table of Contents:**\\n- [Lab setup](#lab-setup)\\n- [Buildroot](#buildroot)\\n  - [Add the packages in buildroot](#add-the-packages-in-buildroot)\\n- [Kernel config](#kernel-config)\\n  - [Configuring the Kernel](#configuring-the-kernel)\\n  - [Device Tree](#device-tree)\\n    - [1. Modify the `dts`](#1-modify-the-dts)\\n    - [2. Modify the `.dtsi`](#2-modify-the-dtsi)\\n- [Final preparation](#final-preparation)\\n- [End Result](#end-result)\\n- [References](#references)\\n\\n{/* truncate */}\\n\\n## Lab setup\\n\\nThe SBC *luckfox-pico-ultra* is mounted on a custom made motherboard with some external peripherals such as can bus and isolated rs-485  \\n  \\nSBC: [Luckfox Pico Ultra W rv1106g 8GB](https://www.luckfox.com/Luckfox-Pico/EN-Luckfox-Pico-Ultra)  \\nCustom motherboard: [schematics](./assets/custom-motherboard.pdf)\\n\\nI am using the containerized Luckfox SDK docker image `luckfoxtech/luckfox_pico:1.0` for build environment.\\nAs image flashing tool: `SOC Toolkit` for Windows. The whole system image flashing procedure is well documented in the [official wiki](https://wiki.luckfox.com/Luckfox-Pico-Ultra/Flash-image)\\n\\n## Buildroot \\n\\n### Add the packages in buildroot\\n\\n<Tabs>\\n  <TabItem value=\\"1. can-utils\\">\\n  **can-utils** includes `candump`, `cansend`, `cansniffer` etc  \\n\\n    <div style={{ width: \\"100\\" }}>![packages-1](./assets/packages-01.png)</div>\\n  </TabItem>\\n  <TabItem value=\\"2. iproute2\\">\\n  **iproute2** is the Linux networking toolkit that replaced net-tools (ifconfig, route, arp etc.)  \\n    [iproute2 cheatsheet](https://paulgorman.org/technical/linux-iproute2-cheatsheet.html)  \\n\\n    <div style={{ width: \\"80\\" }}>![packages-2](./assets/packages-02.png)</div>\\n  </TabItem>\\n</Tabs>\\n\\n## Kernel config\\n\\n### Configuring the Kernel \\n<Tabs>\\n  <TabItem value=\\"1. Set a local version\\">\\n  It is good to set the kernel a local version name, so you can later check what is the kernel image on the SBC with `uname` \\n  ```\\n  General Setup ---\x3e\\n   ()Local version - append to kernel release\\n  ```\\n    <div style={{ width: \\"100\\" }}>![kernel-local-version](./assets/kernel-local-version.png)</div>\\n  </TabItem>\\n  <TabItem value=\\"2. Enable the SPI\\">\\n ```\\n Device Drivers ---\x3e\\n   [*] SPI support\\n ```\\n    <div style={{ width: \\"100\\" }}>![kernel-local-version](./assets/kernel-spi-support.png)</div>\\n  It is also helpful to enable the Debug support for SPI drivers, one menu deep inside SPI support\\n  </TabItem>\\n  <TabItem value=\\"3. Enable CAN-SPI driver\\">\\n  ```\\n    Networking support ---\x3e  \\n     CAN bus subsystem support ---\x3e  \\n      CAN Device Drivers ---\x3e  \\n       CAN SPI interfaces ---\x3e\\n        <*> Microchip MCP251xFD SPI CAN controllers\\n  ```\\n    <div style={{ width: \\"50\\" }}>![kernel-local-version](./assets/kernel-can-drivers-01.png)</div>\\n    <div style={{ width: \\"100\\" }}>![kernel-local-version](./assets/kernel-can-drivers-02.png)</div>\\n  </TabItem>\\n</Tabs>\\n\\n### Device Tree\\n\\nAccording to Luckfox:  \\n\\n> For Luckfox Pico, the basic device tree configurations related to the RV1103 / RV1106 chips\u2014such as rv1106.dtsi, rv1106-pinctrl.dtsi, etc.\u2014are provided by Rockchip. Based on the hardware resources available on the Luckfox Pico, the default configurations are set in .dtsi files, while model-specific hardware information is defined in .dts files.\\n> * The configurations in .dts files have the highest priority and can override settings in the .dtsi files. You can reference nodes from .dtsi and either modify their properties or recreate them entirely.\\n> * For easier editing, the .dts file corresponding to the selected board support package is symlinked to `<luckfox-pico SDK>/config/dts_config` after running ./build.sh. Normally, you only need to edit the .dts file to configure hardware features\u2014.dtsi files should not be modified.\\n> \\n> ![dts-tree](./assets/dts-01.png)\\n\\nThe `dts` files are located under `<SDK-folder>/sysdrv/source/kernel/arch/arm/boot/dts` the ones that we need are named as follows: \\n|sbc|.dts|.dtsi|\\n|:-:|:-:|:-:|\\n|Luckfox Pico ultra W|rv1106g-luckfox-pico-ultra-w.dts|rv1106-luckfox-pico-ultra-ipc.dtsi|\\n\\n[(check here for others)](https://wiki.luckfox.com/Luckfox-Pico-Ultra/Device-Tree)\\n\\n #### 1. Modify the `dts`\\n\\nIn the `.dts` file you can see that I have removed a lot of things for the sake of simplicity and the lab itself (running the CAN). The missing parts are mainly regarding the `BT` and `SDIO-WIFI` \\n\\n - modified: [rv1106g-luckfox-pico-ultra-w.dts](./assets/rv1106g-luckfox-pico-ultra-w-modified.dts)\\n - original: [rv1106g-luckfox-pico-ultra-w.dts](./assets/rv1106g-luckfox-pico-ultra-w.dts)\\n\\n<Tabs>\\n  <TabItem value=\\"1. Modified dts\\">\\n    ```C title=\\"rv1106g-luckfox-pico-ultra-w.dts\\"\\n    // SPDX-License-Identifier: (GPL-2.0+ OR MIT)\\n    /*\\n    * Copyright (c) 2022 Rockchip Electronics Co., Ltd.\\n    */\\n\\n    /dts-v1/;\\n    #include \\"rv1106.dtsi\\"\\n    #include \\"rv1106-luckfox-pico-ultra-ipc.dtsi\\"\\n    #include <dt-bindings/input/input.h>\\n    #include <dt-bindings/display/media-bus-format.h>\\n\\n    / {\\n            ***>\\n            clk_mcp251xfd: clk_mcp251xfd {\\n                    compatible = \\"fixed-clock\\";\\n                    #clock-cells = <0>;\\n                    clock-frequency = <40000000>;\\n            };\\n            ***<\\n    };\\n    ***>\\n    /**********SPI**********/\\n    &spi0 {\\n            status = \\"okay\\";\\n            pinctrl-0 = <&spi0m0_clk &spi0m0_miso &spi0m0_mosi &spi0m0_cs0>;\\n            #address-cells = <1>;\\n            #size-cells = <0>;\\n            spidev@0 {\\n                    status = \\"okay\\";\\n                    compatible = \\"microchip,mcp251xfd\\";\\n                    reg = <0>;\\n                    spi-max-frequency = <4000000>;\\n                    interrupts = <RK_PC6 IRQ_TYPE_LEVEL_LOW>;\\n                    interrupt-parent = <&gpio1>;\\n                    clocks = <&clk_mcp251xfd>;\\n                    clock-names = \\"mcp251xfd\\";\\n                    vdd-supply = <&vcc_3v3>;\\n                    xceiver-supply = <&vcc_3v3>;\\n            };\\n    };\\n    ***<\\n    ```\\n  </TabItem>\\n  <TabItem value=\\"2. clock frequency\\">\\n  here the `clock-frequency` must be the equal to the oscillator of the board used e.g. if the oscillator is 20MHz it should be 20000000 in our case we use 40MHz, otherwise it just won\'t work\\n  ```C  title=\\"rv1106g-luckfox-pico-ultra-w.dts\\"\\n  ***>\\n  clk_mcp251xfd: clk_mcp251xfd {\\n                compatible = \\"fixed-clock\\";\\n                #clock-cells = <0>;\\n                clock-frequency = <40000000>;\\n        };\\n  ***<\\n  ```\\n  <div style={{ width: \\"100\\" }}>![mcp-oscillator](./assets/mcp-oscillator.png)</div>\\n  </TabItem>\\n\\n  <TabItem value=\\"3. interrupts\\">\\n  As pin for the interrupt we are using C6 from the luckfox board which should be configured as interrupt Input pin active on Low level\\n  ```C  title=\\"rv1106g-luckfox-pico-ultra-w.dts\\"\\n***>\\n/**********SPI**********/\\n&spi0 {\\n        status = \\"okay\\";\\n        pinctrl-0 = <&spi0m0_clk &spi0m0_miso &spi0m0_mosi &spi0m0_cs0>;\\n        #address-cells = <1>;\\n        #size-cells = <0>;\\n        spidev@0 {\\n                status = \\"okay\\";\\n                compatible = \\"microchip,mcp251xfd\\";\\n                reg = <0>;\\n                spi-max-frequency = <4000000>;\\n                interrupts = <RK_PC6 IRQ_TYPE_LEVEL_LOW>;\\n                interrupt-parent = <&gpio1>;\\n                clocks = <&clk_mcp251xfd>;\\n                clock-names = \\"mcp251xfd\\";\\n                vdd-supply = <&vcc_3v3>;\\n                xceiver-supply = <&vcc_3v3>;\\n        };\\n};\\n***<\\n  ```\\n  <div style={{ width: \\"100\\" }}>![dts-02](./assets/dts-02.png)</div>\\n  <div style={{ width: \\"100\\" }}>![dts-03](./assets/dts-03.png)</div>\\n  </TabItem>\\n</Tabs>\\n\\n\\n\\n#### 2. Modify the `.dtsi`\\n\\nHere I have removed `CSI`, `LCD/TP` and the things related to the RGB, \\nbecause some pins are needed for interrupt of the `mcp2518fd` chip.  \\n\\nYou can compare them to see the full changes e.g. with WinMerge:\\n   - modified `.dtsi` : [rv1106-luckfox-pico-ultra-ipc.dtsi](./assets/rv1106-luckfox-pico-ultra-ipc-modified.dtsi)  \\n   - original `.dtsi` : [rv1106-luckfox-pico-ultra-ipc.dtsi](./assets/rv1106-luckfox-pico-ultra-ipc.dtsi)\\n:::note\\nThe configurations in .dts files have the highest priority and can override settings in the .dtsi files, so\\nthe `clk_mcp2515` in the root node  and `&spi0` are overwrited by the dts so their prop values are not applied. \\n:::\\n<Tabs>\\n  <TabItem value=\\"Modified dts\\">\\n    ```C title=\\"rv1106-luckfox-pico-ultra-ipc.dtsi\\"\\n    // SPDX-License-Identifier: (GPL-2.0+ OR MIT)\\n    /*\\n    * Copyright (c) 2022 Rockchip Electronics Co., Ltd.\\n    */\\n\\n    #include \\"rv1106-evb.dtsi\\"\\n    #include <dt-bindings/input/input.h>\\n    #include <dt-bindings/display/media-bus-format.h>\\n\\n    / {\\n           ***>\\n            clk_mcp2515: clk_mcp2515 {\\n                            compatible = \\"fixed-clock\\";\\n                            #clock-cells = <0>;\\n                            clock-frequency = <8000000>;\\n            };\\n           ***<\\n    };\\n\\n    ***>\\n    // SPI\\n    &spi0 {\\n            pinctrl-0 = <&spi0m0_clk &spi0m0_miso &spi0m0_mosi &spi0m0_cs0>;\\n            #address-cells = <1>;\\n            #size-cells = <0>;\\n            spidev@0 {\\n                    compatible = \\"rockchip,spidev\\";\\n                    spi-max-frequency = <50000000>;\\n                    reg = <0>;\\n            };\\n\\n    };\\n    ***<\\n    &pinctrl {\\n      ***>\\n            spi0 {\\n                    spi0m0_clk: spi0m0-clk {\\n                            rockchip,pins = <1 RK_PC1 4 &pcfg_pull_none>;\\n                    };\\n                    spi0m0_mosi: spi0m0-mosi {\\n                            rockchip,pins = <1 RK_PC2 6 &pcfg_pull_none>;\\n                    };\\n                    spi0m0_miso: spi0m0-miso {\\n                            rockchip,pins = <1 RK_PC3 6 &pcfg_pull_none>;\\n                    };\\n                    spi0m0_cs0: spi0m0-cs0 {\\n                            rockchip,pins = <1 RK_PC0 4 &pcfg_pull_none>;\\n                    };\\n            };\\n      ***<\\n    };\\n    ```\\n  </TabItem>\\n</Tabs>\\n\\n## Final preparation\\n\\nBuild the image with the `SDK` and upload it with the `SOC toolkit`  \\n * Useful commands in host machine:\\n```bash\\n# attach to the container with the SDK\\ndocker attach <container-name>   \\n\\n# when inside the SDK folder to see options\\n./build.sh help  \\n\\n# copy a file/folder from docker container to current directory \\ndocker cp <container-name>:<full-path-to-sdk>/IMAGE/IPC_EMMC_BUILDROOT_RV1106_LUCKFOX_PICO_ULTRA_W_20251125.2257_RELEASE_TEST .    \\n\\n``` \\n * useful commands in embedded device:\\n```bash\\n# check kernel messages regarding mcp can or spi\\ndmesg | grep -E \\"mcp|can|spi\\"\\n\\n# prepare the can0 interface link\\nip link set can0 type can bitrate 500000\\n\\n# set the can bus Up and active\\nip link set can0 up\\n\\n# check recieved messages with candump\\ncandump can0\\n\\n# make automatic start of the interface on boot\\nvim /etc/network/interfaces\\n\\n  auto lo\\n  iface lo inet loopback\\n\\n  auto can0\\n    iface can0 inet manual\\n    up /sbin/ip link set can0 up type can bitrate 500000\\n    down /sbin/ip link set can0 down\\n\\n```\\n\\n\\n## End Result\\n\\nAfter successful build and upload, login the Luckfox and type `dmesg | grep mcp`, you should see something similar:\\n``` bash\\n[    0.165740] mcp251xfd spi0.0: setup mode 0, 8 bits/w, 4000000 Hz max --\x3e 0\\n[    0.165812] mcp251xfd spi0.0: can_rx_offload_init_queue: skb_queue_len_max=512\\n[    0.172937] mcp251xfd spi0.0 can0: MCP2518FD rev0.0 (-RX_INT -MAB_NO_WARN +CRC_REG +CRC_RX +CRC_TX +ECC -HD c:40.00MHz m:4.00MHz r:4.00MHz e:0.00MHz) successfully initialized.\\n```\\nThis is okay and the can chip has been initialized\\n\\n## References\\n\\n[Luckfox Forum](https://forums.luckfox.com/viewtopic.php?p=4290&hilit=mcp2515#p4290)  \\n[DeviceTree.org](https://www.devicetree.org/specifications)  \\n[rv1106-luckfox-pico-ultra-ipc.dtsi](https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106-luckfox-pico-ultra-ipc.dtsi)  \\n[rv1106g-luckfox-pico-ultra-w.dts](https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106g-luckfox-pico-ultra-w.dts)  \\n[irq.h](https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/include/dt-bindings/interrupt-controller/irq.h)  \\n[rk_gpio.h](https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/media/sysutils/include/rk_gpio.h)  \\n[Ruixiang\'s Notes](https://notes.rdu.im/system/linux/canbus/)"},{"id":"ego-is-the-enemy","metadata":{"permalink":"/blog/ego-is-the-enemy","source":"@site/blog/2025-02-24-ego-is-the-enemy/index.mdx","title":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0412\u0440\u0430\u0433\u044a\u0442 - \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438","description":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0432\u0440\u0430\u0433\u044a\u0442, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438 \u043e\u0442 \u043a\u043d\u0438\u0433\u0430\u0442\u0430 \u043d\u0430 \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439.","date":"2025-02-24T00:00:00.000Z","tags":[{"inline":true,"label":"\u0444\u0438\u043d\u0430\u043d\u0441\u0438","permalink":"/blog/tags/\u0444\u0438\u043d\u0430\u043d\u0441\u0438"},{"inline":true,"label":"\u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u0430","permalink":"/blog/tags/\u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u0430"},{"inline":true,"label":"\u0435\u0433\u043e","permalink":"/blog/tags/\u0435\u0433\u043e"},{"inline":true,"label":"non-technical","permalink":"/blog/tags/non-technical"}],"readingTime":4.48,"hasTruncateMarker":true,"authors":[{"name":"Boris Kolev","title":"owner","key":"boris","page":null}],"frontMatter":{"slug":"ego-is-the-enemy","title":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0412\u0440\u0430\u0433\u044a\u0442 - \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438","authors":["boris"],"tags":["\u0444\u0438\u043d\u0430\u043d\u0441\u0438","\u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u0430","\u0435\u0433\u043e","non-technical"]},"unlisted":false,"prevItem":{"title":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","permalink":"/blog/luckfox rv1106g canbus mcp2518fd"},"nextItem":{"title":"Docker compose for Firefly III with WireGuard VPN client","permalink":"/blog/docker-wg-firefly-iii"}},"content":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0432\u0440\u0430\u0433\u044a\u0442, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438 \u043e\u0442 \u043a\u043d\u0438\u0433\u0430\u0442\u0430 \u043d\u0430 \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439.\\n\\n\x3c!-- truncate --\x3e\\n\\n> \u0410\u043a\u043e \u043d\u0435 \u0441\u0438 \u0434\u0430\u0432\u0430\u043c\u0435 \u0442\u043e\u0447\u043d\u0430 \u0441\u043c\u0435\u0442\u043a\u0430 \u0437\u0430 \u0442\u043e\u0432\u0430 \u043a\u0430\u043a\u0432\u0438 \u0441\u0430 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u0438\u0442\u0435 \u043d\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0432 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0441 \u0442\u0435\u0437\u0438 \u043d\u0430 \u0434\u0440\u0443\u0433\u0438\u0442\u0435, \u043d\u0430\u0448\u0430\u0442\u0430 \u0441\u0430\u043c\u043e\u0443\u0432\u0435\u0440\u0435\u043d\u043e\u0441\u0442 \u043d\u0435 \u0435 \u043d\u0438\u0449\u043e \u0434\u0440\u0443\u0433\u043e, \u043e\u0441\u0432\u0435\u043d \u0441\u0430\u043c\u043e\u0438\u0437\u043c\u0430\u043c\u0430.\\n> \u041a\u0430\u043a \u0449\u0435 \u0441\u0442\u0438\u0433\u043d\u0435\u043c \u0434\u043e \u0434\u0440\u0443\u0433\u0438\u0442\u0435 \u0445\u043e\u0440\u0430, \u043a\u0430\u043a \u0449\u0435 \u0433\u0438 \u043c\u043e\u0442\u0438\u0432\u0438\u0440\u0430\u043c\u0435 \u0438\u043b\u0438 \u0440\u044a\u043a\u043e\u0432\u043e\u0434\u0438\u043c, \u0430\u043a\u043e \u043d\u0435 \u043c\u043e\u0436\u0435\u043c \u0434\u0430 \u043e\u0441\u044a\u0437\u043d\u0430\u0435\u043c \u043a\u0430\u043a\u0432\u0438 \u0441\u0430 \u0442\u0435\u0445\u043d\u0438\u0442\u0435 \u043d\u0443\u0436\u0434\u0438 - \u0437\u0430\u0449\u043e\u0442\u043e \u0441\u043c\u0435 \u0437\u0430\u0433\u0443\u0431\u0438\u043b\u0438 \u0432\u0440\u044a\u0437\u043a\u0430 \u0441\u044a\u0441 \u0441\u0435\u0431\u0435 \u0441\u0438?\\n\\n> \u0415\u0433\u043e\u0442\u043e \u0437\u0430\u043c\u0435\u043d\u044f \u0440\u0430\u0446\u0438\u043e\u043d\u0430\u043b\u043d\u0438\u0442\u0435 \u0438 \u043e\u0441\u044a\u0437\u043d\u0430\u0442\u0438 \u0447\u0430\u0441\u0442\u0438 \u043e\u0442 \u043d\u0430\u0448\u0430\u0442\u0430 \u043f\u0441\u0438\u0445\u0438\u043a\u0430 \u0441\u044a\u0441 \u0441\u0430\u043c\u043e\u0445\u0432\u0430\u043b\u0441\u0442\u0432\u043e \u0438 \u043d\u0430\u0440\u0446\u0438\u0441\u0438\u0437\u044a\u043c \u0438 \u043d\u0438 \u043a\u0430\u0437\u0432\u0430 \u043e\u043d\u043e\u0432\u0430, \u043a\u043e\u0435\u0442\u043e \u0436\u0435\u043b\u0430\u0435\u043c \u0434\u0430 \u0447\u0443\u0435\u043c, \u0442\u043e\u0433\u0430\u0432\u0430, \u043a\u043e\u0433\u0430\u0442\u043e \u0438\u0441\u043a\u0430\u043c\u0435 \u0434\u0430 \u0433\u043e \u0447\u0443\u0435\u043c.\\n\\n## \u0421\u0442\u0440\u0435\u043c\u0435\u0436\u044a\u0442\\n\\n### \u041a\u044a\u043c \u043a\u0430\u043a\u0432\u043e\u0442\u043e \u0438 \u0434\u0430 \u0441\u0435 \u0441\u0442\u0440\u0435\u043c\u0438\u0442\u0435, \u0435\u0433\u043e\u0442\u043e \u0435 \u0432\u0430\u0448\u0438\u044f\u0442 \u0432\u0440\u0430\u0433\\n\\n> \u0418\u0437\u043e\u043a\u0440\u0430\u0442 \u043a\u044a\u043c \u0414\u0435\u043c\u043e\u043d\u0438\u043a:\\n> \u0423\u043f\u0440\u0430\u0436\u043d\u044f\u0432\u0430\u0439 \u0441\u0435 \u0432 \u0441\u0430\u043c\u043e\u043a\u043e\u043d\u0442\u0440\u043e\u043b, \u0437\u0430 \u0434\u0430 \u043d\u0435 \u0438\u0437\u043f\u0430\u0434\u0430\u0448 \u0432\u044a\u0432 \u0432\u043b\u0430\u0441\u0442\u0442\u0430 \u043d\u0430 \u0443\u0437\u0431\u0443\u0445\u043b\u0438\u0432\u043e\u0441\u0442\u0442\u0430, \u0443\u0434\u043e\u0432\u043e\u043b\u0441\u0442\u0432\u0438\u044f\u0442\u0430 \u0438 \u0431\u043e\u043b\u043a\u0430\u0442\u0430.\\n> \u041e\u0442\u0432\u0440\u0430\u0449\u0430\u0432\u0430\u0439 \u0441\u0435 \u043e\u0442 \u043b\u0430\u0441\u043a\u0430\u0442\u0435\u043b\u0438\u0442\u0435 \u0442\u0430\u043a\u0430, \u043a\u0430\u043a\u0442\u043e \u0431\u0438 \u0441\u0435 \u043e\u0442\u0432\u0440\u0430\u0449\u0430\u0432\u0430\u043b \u043e\u0442 \u0438\u0437\u043c\u0430\u043c\u043d\u0438\u0446\u0438\u0442\u0435, \u0437\u0430\u0449\u043e\u0442\u043e \u0438 \u0435\u0434\u043d\u0438\u0442\u0435 \u0438 \u0434\u0440\u0443\u0433\u0438\u0442\u0435, \u0434\u043e\u0432\u0435\u0440\u0438 \u043b\u0438 \u0438\u043c \u0441\u0435 \u0447\u043e\u0432\u0435\u043a, \u043d\u0430\u043d\u0430\u0441\u044f\u0442 \u0432\u0440\u0435\u0434\u0430 \u043d\u0430 \u043e\u0437\u043d\u0438, \u043a\u043e\u0439\u0442\u043e \u0443\u043c \u0441\u0435 \u0434\u043e\u0432\u0435\u0440\u044f\u0432\u0430.\\n\\n> \u041d\u0430\u0434\u043c\u0435\u043d\u043d\u043e\u0441\u0442\u0442\u0430 \u0438 \u043d\u0430\u0440\u0446\u0438\u0441\u0438\u0437\u043c\u044a\u0442 \u043f\u0440\u0435\u0447\u0430\u0442 \u043d\u0430 \u0440\u0430\u0441\u0442\u0435\u0436\u0430. \u0421\u044a\u0449\u043e \u0442\u043e\u043b\u043a\u043e\u0432\u0430 \u0432\u0440\u0435\u0434\u043d\u0438 \u0437\u0430 \u043d\u0435\u0433\u043e \u0441\u0430 \u0444\u0430\u043d\u0442\u0430\u0437\u0438\u0438\u0442\u0435 \u0438 \\"\u043f\u0440\u043e\u0431\u043b\u044f\u0441\u044a\u0446\u0438\u0442\u0435\\".\\n> \u0414\u0430 \u0441\u0435 \u0443\u043f\u0440\u0430\u0436\u043d\u044f\u0432\u0430\u0442\u0435 \u0432 \u0442\u043e\u0432\u0430 - \u0434\u0430 \u0433\u043b\u0435\u0434\u0430\u0442\u0435 \u043d\u0430 \u0441\u0435\u0431\u0435 \u0441\u0438 \u043e\u0442 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u043e \u0440\u0430\u0437\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u0434\u0430 \u0440\u0430\u0437\u0432\u0438\u0432\u0430\u0442\u0435 \u0432 \u0441\u0435\u0431\u0435 \u0441\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0442\u0430 \u0434\u0430 \u0441\u0435 \u043e\u0442\u043a\u044a\u0441\u0432\u0430\u0442\u0435 \u043e\u0442 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u0438\u0442\u0435 \u0441\u0438 \u043c\u0438\u0441\u043b\u0438.\\n> \u041b\u0435\u0441\u043d\u043e \u0435 \u0434\u0430 \u0438\u0437\u043f\u0430\u0434\u043d\u0435\u0442\u0435 \u0432 \u0435\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u043d\u0430 \u043f\u0440\u0438\u0432\u044a\u0440\u0437\u0430\u043d\u043e\u0441\u0442 \u0438 \u0437\u0430\u0441\u043b\u0435\u043f\u0435\u043d\u0438\u0435 \u043e\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u0430 \u0441\u0438.\\n\\n> \u0417\u0430 \u0434\u0430 \u0438\u043c\u0430\u0442\u0435 \u0432\u044f\u0440\u0430 \u0432 \u0441\u0432\u043e\u044f\u0442\u0430 \u0440\u0430\u0431\u043e\u0442\u0430, \u0442\u0430\u0437\u0438 \u0432\u044f\u0440\u0430 \u0442\u0440\u044f\u0431\u0432\u0430 \u0434\u0430 \u0441\u0435 \u0431\u0430\u0437\u0438\u0440\u0430 \u043d\u0430 \u0438\u0441\u0442\u0438\u043d\u0430.\\n\\n### \u0414\u0443\u043c\u0438, \u0434\u0443\u043c\u0438, \u0434\u0443\u043c\u0438\\n\\n> \u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0442\u0430 \u0433\u044a\u0432\u043a\u0430\u0432\u043e\u0441\u0442 \u043d\u0435 \u0435 \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043e\u0442\u043e \u043f\u0440\u0435\u0434\u0438\u043c\u0441\u0442\u0432\u043e \u043d\u0430 \u043c\u044a\u043b\u0447\u043d\u0438\u0435\u0442\u043e, \u0434\u043e\u043a\u0430\u0442\u043e \u0434\u0440\u0443\u0433\u0438\u0442\u0435 \u043f\u0440\u0438\u043a\u0430\u0437\u0432\u0430\u0442. \u0422\u044f \u0435 \u0438 \u043f\u0441\u0438\u0445\u043e\u043b\u043e\u0433\u0438\u044f. \u0425\u0435\u0437\u043e\u0438\u0434 \u0435 \u043a\u0430\u0437\u0430\u043b **\\"\u041d\u0430\u0439-\u0433\u043e\u043b\u044f\u043c\u043e\u0442\u043e \u0441\u044a\u043a\u0440\u043e\u0432\u0438\u0449\u0435 \u043d\u0430 \u0447\u043e\u0432\u0435\u043a\u0430 \u0435 \u043f\u0435\u0441\u0442\u0435\u043b\u0438\u0432\u0438\u044f\u0442 \u0435\u0437\u0438\u043a\\"**.\\n\\n> \u0422\u0435 \u0440\u0430\u0431\u043e\u0442\u044f\u0442 \u0442\u0438\u0445\u043e \u0432 \u044a\u0433\u044a\u043b\u0430. \u041f\u0440\u0435\u0432\u0440\u044a\u0449\u0430\u0442 \u0432\u044a\u0442\u0440\u0435\u0448\u043d\u043e\u0442\u043e \u0441\u0438 \u0431\u0435\u0437\u043f\u043e\u043a\u043e\u0439\u0441\u0442\u0432\u043e \u0432 \u043f\u0440\u043e\u0434\u0443\u043a\u0442 - \u0438 \u043f\u043e\u0438\u043d\u044f\u043a\u043e\u0433\u0430 \u0432 \u0441\u043f\u043e\u043a\u043e\u0439\u0441\u0442\u0432\u0438\u0435. \u041f\u0440\u0435\u043d\u0435\u0431\u0440\u0435\u0433\u0432\u0430\u0442 \u043f\u043e\u0440\u0438\u0432\u0430 \u0434\u0430 \u0442\u044a\u0440\u0441\u044f\u0442 \u043f\u0440\u0438\u0437\u043d\u0430\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0438 \u0434\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0430\u0442. \u041d\u0435 \u0433\u043e\u0432\u043e\u0440\u044f\u0442 \u043c\u043d\u043e\u0433\u043e.\\n> \u041a\u043e\u0433\u0430\u0442\u043e \u043d\u0430\u0438\u0441\u0442\u0438\u043d\u0430 \u0433\u043e\u0432\u043e\u0440\u044f\u0442 \u0442\u043e \u0435 \u0437\u0430\u0441\u043b\u0443\u0436\u0435\u043d\u043e.\\n\\n> \u0415\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u0430\u0442\u0430 \u0432\u0440\u044a\u0437\u043a\u0430 \u043c\u0435\u0436\u0434\u0443 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u0430 \u0438 \u043f\u0440\u0430\u0437\u043d\u043e\u0442\u043e \u043f\u0440\u0438\u043a\u0430\u0437\u0432\u0430\u043d\u0435 \u0435, \u0447\u0435 \u0432\u0442\u043e\u0440\u043e\u0442\u043e \u0443\u0431\u0438\u0432\u0430 \u043f\u044a\u0440\u0432\u043e\u0442\u043e.\\n\\n### \u041d\u0435 \u0431\u044a\u0434\u0438 \u0441\u0442\u0440\u0430\u0441\u0442\u0435\u043d\\n\\n> \u041a\u0430\u043a \u043c\u043e\u0436\u0435 \u0447\u043e\u0432\u0435\u043a \u0434\u0430 \u0441\u0435 \u0442\u0440\u0443\u0434\u0438 \u0438 \u0434\u0430 \u043d\u0435 \u043f\u043e\u0441\u0442\u0438\u0433\u0430 \u043d\u0438\u0448\u043e? \u0415\u0442\u043e \u0442\u043e\u0432\u0430 \u0435 \u043f\u0430\u0440\u0430\u0434\u043e\u043a\u0441\u044a\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u0441\u0442\u0442\u0430.\\n\\n> \u0426\u0435\u043b\u0442\u0430, \u0431\u0438\u0445\u043c\u0435 \u043c\u043e\u0433\u043b\u0438 \u0434\u0430 \u043a\u0430\u0436\u0435\u043c, \u0435 \u0441\u0442\u0440\u0430\u0441\u0442, \u0441\u044a\u0447\u0435\u0442\u0430\u043d\u0430 \u0441 \u0433\u0440\u0430\u043d\u0438\u0446\u0438. \u0420\u0435\u0430\u043b\u0438\u0437\u043c\u044a\u0442 \u0435 \u0431\u0435\u0437\u043f\u0440\u0438\u0441\u0442\u0440\u0430\u0441\u0442\u043d\u043e\u0441\u0442 \u0438 \u043f\u0435\u0440\u0441\u043f\u0435\u043a\u0442\u0438\u0432\u0430.\\n\\n\u0413\u044c\u043e\u0442\u0435: \\"\u0413\u043e\u043b\u0435\u043c\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u0441\u0442\u0438 \u0441\u0430 \u0431\u043e\u043b\u0435\u0441\u0442\u0438, \u0437\u0430 \u0438\u0437\u043b\u0435\u043a\u0443\u0432\u0430\u043d\u0435\u0442\u043e \u043e\u0442 \u043a\u043e\u0438\u0442\u043e \u043d\u044f\u043c\u0430 \u043d\u0430\u0434\u0435\u0436\u0434\u0430\\". \u0415\u0442\u043e \u0437\u0430\u0449\u043e \u0440\u0430\u0437\u0441\u044a\u0434\u043b\u0438\u0432\u0438\u044f\u0442, \u0446\u0435\u043b\u0435\u043e\u0441\u044a\u0437\u043d\u0430\u0442 \u0447\u043e\u0432\u0435\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0430 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e \u043d\u0438\u0432\u043e, \u043e\u0442\u0432\u044a\u0434 \u043d\u0435\u0441\u0438\u0433\u0443\u0440\u043d\u043e\u0441\u0442\u0442\u0430 \u0438\u043b\u0438 \u0431\u043e\u043b\u0435\u0441\u0442\u0442\u0430.\\n\\n> \u0422\u043e\u0439 \u043d\u0430\u0435\u043c\u0430 \u043f\u0440\u043e\u0444\u0435\u0441\u0438\u043e\u043d\u0430\u043b\u0438\u0441\u0442\u0438 \u0438 \u0433\u0438 \u0438\u0437\u043f\u043e\u043b\u0437\u0432\u0430. \u0417\u0430\u0434\u0430\u0432\u0430 \u0432\u044a\u043f\u0440\u043e\u0441\u0438, \u043f\u0438\u0442\u0430 \u043a\u0430\u043a\u0432\u043e \u0431\u0438 \u043c\u043e\u0433\u043b\u043e \u0434\u0430 \u0442\u0440\u044a\u0433\u043d\u0435 \u043f\u043e\u0433\u0440\u0435\u0448\u043d\u043e, \u0442\u044a\u0440\u0441\u0438 \u043f\u0440\u0438\u043c\u0435\u0440\u0438. \u041f\u0440\u0435\u0434\u0432\u0438\u0436\u0434\u0430 \u043f\u043e\u044f\u0432\u0430\u0442\u0435 \u043d\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u0438 \u043e\u0431\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u0441\u0442\u0432\u0430. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u043e\u0447\u0432\u0430 \u0434\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0430, \u0441 \u043c\u0430\u043b\u043a\u0438 \u0441\u0442\u044a\u043f\u043a\u0438, \u0437\u0430\u0432\u044a\u0440\u0448\u0432\u0430 \u0433\u0438 \u0438 \u0442\u044a\u0440\u0441\u0438 \u043e\u0431\u0440\u0430\u0442\u043d\u0430 \u0432\u0440\u044a\u0437\u043a\u0430.\\n\\n> \u0414\u0430\u043b\u0435\u0447 \u043f\u043e-\u0434\u043e\u0431\u0440\u0435 \u0435 \u0434\u0430 \u0441\u0442\u0435 \u0443\u043f\u043b\u0430\u0448\u0435\u043d\u0438 \u043e\u0442 \u043f\u0440\u0435\u0434\u0441\u0442\u043e\u044f\u0449\u043e\u0442\u043e - \u0441\u043c\u0438\u0440\u0435\u043d\u0438 \u043e\u0442 \u043d\u0435\u0433\u043e\u0432\u0438\u0442\u0435 \u043c\u0430\u0449\u0430\u0431\u0438 \u0438 \u0440\u0435\u0448\u0435\u043d\u0438 \u0434\u0430 \u0433\u043e \u043e\u0441\u044a\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435 \u0432\u044a\u043f\u0440\u0435\u043a\u0438 \u0432\u0441\u0438\u0447\u043a\u043e.\\n\\n### \u0421\u043b\u0435\u0434\u0432\u0430\u0439 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f\u0442\u0430 \u043d\u0430 \u043f\u043b\u0430\u0442\u043d\u043e\u0442\u043e\\n\\n> \u041a\u043e\u0433\u0430\u0442\u043e \u0441\u043c\u0435 **\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0449\u0438** \u043c\u043e\u0436\u0435\u043c \u0434\u0430 \u0431\u044a\u0434\u0435\u043c \u0441\u0438\u0433\u0443\u0440\u043d\u0438 \u0441\u0430\u043c\u043e \u0437\u0430 \u043d\u044f\u043a\u043e\u043b\u043a\u043e \u043e\u0441\u043d\u043e\u0432\u043d\u0438 \u0444\u0430\u043a\u0442\u0430:\\n\\n     1) \u0438\u0437\u043e\u0431\u0449\u043e \u043d\u0435 \u0441\u043c\u0435 \u0442\u043e\u043b\u043a\u043e\u0432\u0430 \u0434\u043e\u0431\u0440\u0438 \u0438\u043b\u0438 \u0442\u043e\u043b\u043a\u043e\u0432\u0430 \u0432\u0430\u0436\u043d\u0438, \u043a\u043e\u043b\u043a\u043e\u0442\u043e \u0441\u0438 \u043c\u0438\u0441\u043b\u0438\u043c\\n     2) \u0438\u043c\u0430\u043c\u0435 \u043d\u0430\u0433\u043b\u0430\u0441\u0430, \u043a\u043e\u044f\u0442\u043e \u0442\u0440\u044f\u0431\u0432\u0430 \u0434\u0430 \u0441\u0435 \u043a\u043e\u0440\u0438\u0433\u0438\u0440\u0430\\n     3) \u043f\u043e\u0432\u0435\u0447\u0435\u0442\u043e \u043e\u0442 \u043d\u0435\u0449\u0430\u0442\u0430, \u043a\u043e\u0438\u0442\u043e \u043c\u0438\u0441\u043b\u0438\u043c, \u0447\u0435 \u0437\u043d\u0430\u0435\u043c \u0438\u043b\u0438 \u043f\u043e\u0432\u0435\u0447\u0435\u0442\u043e \u043e\u0442 \u043d\u0435\u0449\u0430\u0442\u0430, \u043a\u043e\u0438\u0442\u043e \u0441\u043c\u0435 \u043d\u0430\u0443\u0447\u0438\u043b\u0438 \u043e\u0442 \u043a\u043d\u0438\u0433\u0438\u0442\u0435 \u0438\u043b\u0438 \u0432 \u0443\u0447\u0438\u043b\u0438\u0449\u0435, \u0441\u0430 \u043e\u0441\u0442\u0430\u0440\u0435\u043b\u0438 \u0438\u043b\u0438 \u0441\u0430 \u043d\u0435\u0432\u0435\u0440\u043d\u0438\\n\\n> \u0422\u0438 \u0441\u0438 \u043d\u0430\u0439-\u043c\u0430\u043b\u043e\u0432\u0430\u0436\u043d\u0438\u044f\u0442 \u0447\u043e\u0432\u0435\u043a \u0432 \u0441\u0442\u0430\u044f\u0442\u0430, \u0434\u043e\u043a\u0430\u0442\u043e \u043d\u0435 \u043f\u0440\u043e\u043c\u0435\u043d\u0438\u0448 \u0442\u043e\u0432\u0430 \u0441 \u0440\u0435\u0437\u0443\u043b\u0442\u0430\u0442\u0438\u0442\u0435 \u0441\u0438.\\n\\n\u041c\u0438\u0441\u043b\u0435\u0442\u0435 \u0437\u0430 \u0445\u043e\u0440\u0430\u0442\u0430 \u043f\u043e \u0441\u043b\u0435\u0434\u043d\u0438\u044f \u043d\u0430\u0447\u0438\u043d:\\n\\n> \u041a\u0430\u043a\u0432\u043e \u043c\u043e\u0433\u0430 \u0434\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u044f \u0437\u0430 \u043d\u0435\u0433\u043e? \u0418 \u0430\u043a\u043e \u0433\u043b\u0435\u0434\u0430\u0442\u0435 \u043d\u0430 \u0442\u043e\u0432\u0430 \u043f\u043e \u043d\u0430\u0447\u0438\u043d, \u043a\u043e\u0439\u0442\u043e \u0435 \u0438\u0437\u0446\u044f\u043b\u043e \u043e\u0442 \u043f\u043e\u043b\u0437\u0430 \u0437\u0430 \u043d\u0435\u0433\u043e, \u0430 \u043d\u0435 \u0437\u0430 \u0432\u0430\u0441. \u041a\u0443\u043c\u0443\u043b\u0430\u0442\u0438\u0432\u043d\u0438\u044f\u0442 \u0435\u0444\u0435\u043a\u0442, \u043a\u043e\u0439\u0442\u043e \u0431\u0438 \u0438\u043c\u0430\u043b\u043e \u0442\u043e\u0432\u0430 \u0441 \u0432\u0440\u0435\u043c\u0435\u0442\u043e, \u0431\u0438 \u0431\u0438\u043b \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u0435\u043d: \u0431\u0438\u0445\u0442\u0435 \u0441\u0435 \u043d\u0430\u0443\u0447\u0438\u043b\u0438 \u0434\u043e \u0433\u043e\u043b\u044f\u043c\u0430 \u0441\u0442\u0435\u043f\u0435\u043d \u0434\u0430 \u0440\u0435\u0448\u0430\u0432\u0430\u0442\u0435 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438. \u0411\u0438\u0445\u0442\u0435 \u0438\u043c\u0430\u043b\u0438 \u0440\u0435\u043f\u0443\u0442\u0430\u0446\u0438\u044f \u043d\u0430 \u043a\u0440\u0430\u0439\u043d\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0447\u043e\u0432\u0435\u043a. \u0411\u0438\u0445\u0442\u0435 \u0438\u043c\u0430\u043b\u0438 \u0431\u0435\u0437\u0431\u0440\u043e\u0439 \u043d\u043e\u0432\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0438. \u0411\u0438\u0445\u0442\u0435 \u0438\u043c\u0430\u043b\u0438 \u043e\u0433\u0440\u043e\u043c\u0435\u043d \u0431\u0440\u043e\u0439 \u0434\u043e\u0431\u0440\u043e\u0436\u0435\u043b\u0430\u0442\u0435\u043b\u0438.\\n\\n> \u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f\u0442\u0430 \u0435 \u043d\u0430\u0439-\u0442\u0440\u0443\u0434\u043d\u0430\u0442\u0430 \u0447\u0430\u0441\u0442. \u041b\u0435\u0441\u043d\u043e \u0435 \u0434\u0430 \u0431\u044a\u0434\u0435\u0448 \u043e\u0437\u043b\u043e\u0431\u0435\u043d \u043a\u0430\u0442\u043e \u041c\u0430\u0440\u0446\u0438\u0430\u043b. \u0414\u0430 \u043c\u0440\u0430\u0437\u0438\u0448 \u0434\u043e\u0440\u0438 \u0441\u0430\u043c\u0430\u0442\u0430 \u043c\u0438\u0441\u044a\u043b \u0437\u0430 \u043f\u043e\u0434\u043b\u0438\u0437\u0443\u0440\u0441\u0442\u0432\u043e. \u0414\u0430 \u043f\u0440\u0435\u0437\u0438\u0440\u0430\u0448 \u043e\u043d\u0435\u0437\u0438 \u043a\u043e\u0438\u0442\u043e \u0438\u043c\u0430\u0442 \u043f\u043e\u0432\u0435\u0447\u0435 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430, \u043f\u043e\u0432\u0435\u0447\u0435 \u043e\u043f\u0438\u0442 \u0438\u043b\u0438 \u043f\u043e-\u0432\u0438\u0441\u043e\u043a\u043e \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043e \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043e\u0442 \u0442\u0435\u0431. \u0414\u0430 \u0441\u0438 \u043a\u0430\u0437\u0432\u0430\u0448, \u0447\u0435 \u0432\u0441\u044f\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434\u0430, \u043a\u043e\u044f\u0442\u043e \u043d\u0435 \u0438\u0437\u0440\u0430\u0437\u0445\u043e\u0434\u0432\u0430\u0448 \u0432\u044a\u0432 \u0432\u044a\u0440\u0448\u0435\u043d\u0435 \u043d\u0430 \u0441\u0432\u043e\u044f\u0442\u0430 \u0440\u0430\u0431\u043e\u0442\u0430\\n> \u0438\u043b\u0438 \u0432 \u0440\u0430\u0431\u043e\u0442\u0430 \u043f\u043e \u0441\u0435\u0431\u0435 \u0441\u0438, \u0435 \u043f\u0438\u043b\u0435\u0435\u043d\u0435 \u043d\u0430 \u0442\u0432\u043e\u0435\u0442\u043e \u0434\u0430\u0440\u043e\u0432\u0430\u043d\u0438\u0435. \u0414\u0430 \u043d\u0430\u0441\u0442\u043e\u044f\u0432\u0430\u0448: \\"\u041d\u044f\u043c\u0430 \u0434\u0430 \u0441\u0435 \u0443\u043d\u0438\u0436\u0430 \u0434\u043e \u0442\u0430\u043a\u0430\u0432\u0430 \u0441\u0442\u0435\u043f\u0435\u043d\\".\\n> \u0429\u043e\u043c \u0441\u0435 \u043f\u0440\u0435\u0431\u043e\u0440\u0438\u043c \u0441 \u0442\u043e\u044f \u0435\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u0435\u043d \u0438 \u0435\u0433\u043e\u0438\u0441\u0442\u0438\u0447\u0435\u043d \u0438\u043c\u043f\u0443\u043b\u0441, \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f\u0442\u0430 \u043d\u0430 \u043f\u043b\u0430\u0442\u043d\u043e\u0442\u043e \u0435 \u043b\u0435\u043d\u0441\u0430. \u041d\u0435\u0439\u043d\u0438\u0442\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0438 \u0441\u0430 \u0431\u0435\u0437\u043a\u0440\u0430\u0439\u043d\u0438.\\n> \u041e\u0442\u043a\u0440\u0438\u0439\u0442\u0435 \u0431\u043b\u0430\u0433\u043e\u043f\u0440\u0438\u044f\u0442\u043d\u0438 \u0432\u044a\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438, \u0437\u0430 \u0434\u0430 \u0440\u0435\u043a\u043b\u0430\u043c\u0438\u0440\u0430\u0442\u0435 \u0442\u0435\u0445\u043d\u0438\u044f \u0442\u0430\u043b\u0430\u043d\u0442, \u043d\u0430\u043c\u0438\u0440\u0430\u0439\u0442\u0435 \u043a\u0430\u043d\u0430\u043b\u0438 \u0438 \u0445\u043e\u0440\u0430, \u0441 \u043a\u043e\u0438\u0442\u043e \u0434\u0430 \u0441\u044a\u0442\u0440\u0443\u0434\u043d\u0438\u0447\u0438\u0442\u0435, \u0438 \u043f\u0440\u0435\u043c\u0430\u0445\u0432\u0430\u0439\u0442\u0435 \u043e\u0442\u0432\u043b\u0438\u0447\u0430\u0449\u0438\u0442\u0435 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u0438, \u043a\u043e\u0438\u0442\u043e \u043f\u0440\u0435\u0447\u0430\u0442 \u043d\u0430 \u0442\u0435\u0445\u043d\u0438\u044f \u043d\u0430\u043f\u0440\u0435\u0434\u044a\u043a \u0438 \u0444\u043e\u043a\u0443\u0441. \u041f\u0440\u0435\u043c\u0438\u0441\u043b\u0435\u0442\u0435 \u0432\u0441\u044f\u043a\u0430 \u0438\u043d\u0432\u0435\u0441\u0442\u0438\u0446\u0438\u044f \u0432 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0438\u0442\u0435 \u0441\u0438 \u0438 \u0432 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043e\u0442\u043e \u0441\u0438 \u0440\u0430\u0437\u0432\u0438\u0442\u0438\u0435.\\n\\n> \u0430\u043a\u043e \u043f\u043e\u0432\u0434\u0438\u0442\u043d\u0435\u0442\u0435 \u0442\u043e\u0432\u0430 \u043d\u0430\u043c\u0435\u0442\u0430\u043b\u043e, \u0449\u0435 \u0432\u0438\u0434\u0438\u0442\u0435 \u043e\u043d\u043e\u0432\u0430, \u043a\u043e\u0435\u0442\u043e \u0435\u0433\u043e\u0442\u043e \u043d\u0430 \u043f\u043e\u0432\u0435\u0447\u0435\u0442\u043e \u0445\u043e\u0440\u0430 \u0438\u043c \u043f\u0440\u0435\u0447\u0438 \u0434\u0430 \u043e\u0446\u0435\u043d\u044f\u0442: \u0447\u043e\u0432\u0435\u043a\u0430, \u043a\u043e\u0439\u0442\u043e \u0440\u0430\u0437\u0447\u0438\u0441\u0442\u0432\u0430 \u043f\u044a\u0442\u044f, \u0432 \u043a\u0440\u0430\u0439\u043d\u0430 \u0441\u043c\u0435\u0442\u043a\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0430 \u043d\u0435\u0433\u043e\u0432\u0430\u0442\u0430 \u043f\u043e\u0441\u043e\u043a\u0430, \u0442\u043e\u0447\u043d\u043e \u043a\u0430\u043a\u0442\u043e \u043f\u043b\u0430\u0442\u043d\u043e\u0442\u043e \u0435 \u043e\u0441\u043d\u043e\u0432\u0430\u0442\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u0430\u0442\u0430.\\n\\n### \u0412\u044a\u0437\u0434\u044a\u0440\u0436\u0430\u0439 \u0441\u0435\\n\\n> \u0421\u043f\u043e\u043a\u043e\u0439\u043d\u043e \u043f\u043e\u0434\u043c\u0438\u043d\u0435\u0442\u0435 \u043e\u0431\u0438\u0434\u0430\u0442\u0430 \u0438 \u0441\u0435 \u0442\u0440\u0443\u0434\u0435\u0442\u0435 \u043e\u0449\u0435 \u043f\u043e-\u0443\u0441\u0438\u043b\u0435\u043d\u043e. \u0418\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0438 \u0438\u0433\u0440\u0430\u0442\u0430. \u041d\u0435 \u043e\u0431\u0440\u044a\u0449\u0430\u0439\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u0448\u0443\u043c\u0430; \u0437\u0430 \u0431\u043e\u0433\u0430, \u043d\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0432\u0430\u0439\u0442\u0435 \u0434\u0430 \u0432\u0438 \u043e\u0442\u0432\u043b\u0438\u0447\u0430\u0442. \u0421\u0430\u043c\u043e\u043e\u0431\u043b\u0430\u0434\u0430\u043d\u0438\u0435\u0442\u043e \u0435 \u0442\u0440\u0443\u0434\u043d\u043e, \u0430\u043b\u0430 \u0438\u0437\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u043d\u043e\u0432\u0430\u0436\u043d\u043e \u0443\u043c\u0435\u043d\u0438\u0435.\\n> \u0427\u0435\u0441\u0442\u043e \u0449\u0435 \u0441\u0435 \u0438\u0437\u043a\u0443\u0448\u0430\u0432\u0430\u0442\u0435, \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e \u0434\u043e\u0440\u0438 \u043d\u044f\u043c\u0430 \u0434\u0430 \u0438\u0437\u0434\u044a\u0440\u0436\u0438\u0442\u0435. \u041d\u0438\u043a\u043e\u0439 \u043d\u0435 \u0435 \u0441\u044a\u0432\u044a\u0440\u0448\u0435\u043d, \u043d\u043e \u0442\u0440\u044f\u0431\u0432\u0430 \u0434\u0430 \u0441\u0435 \u043e\u043f\u0438\u0442\u0432\u0430\u043c\u0435.\\n\\n> \u0420\u043e\u0431\u0438\u043d\u0441\u044a\u043d \u043d\u0435 \u0435 \u043b\u0438\u0448\u0435\u043d \u043e\u0442 \u0441\u0442\u0440\u0430\u0441\u0442, \u0430\u043b\u0430 \u0442\u043e\u0439 \u0440\u0430\u043d\u043e \u043d\u0430\u0443\u0447\u0430\u0432\u0430, \u0447\u0435 \u043e\u043f\u044a\u043d\u0430\u0442\u043e\u0442\u043e \u0432\u044a\u0436\u0435, \u043f\u043e \u043a\u043e\u0435\u0442\u043e \u0432\u044a\u0440\u0432\u0438, \u0449\u0435 \u043f\u043e\u043d\u0435\u0441\u0435 \u0441\u0430\u043c\u043e \u0441\u0430\u043c\u043e\u043e\u0431\u043b\u0430\u0434\u0430\u043d\u0438\u0435\u0442\u043e \u0438 \u0447\u0435 \u0442\u043e \u043d\u0435 \u043f\u0440\u043e\u0449\u0430\u0432\u0430 \u043d\u0430 \u0435\u0433\u043e\u0442\u043e.\\n\\n### \u041e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0442\u0430 \u043e\u0442 \u0440\u0430\u043d\u043d\u043e\u0442\u043e \u0432\u044a\u0437\u0433\u043e\u0440\u0434\u044f\u0432\u0430\u043d\u0435\\n\\n\u041c\u0430\u043b\u043a\u0438\u044f\u0442 \u043f\u0440\u0438\u043d\u0446: \\"\u0421\u0443\u0435\u0442\u043d\u0438\u0442\u0435 \u0445\u043e\u0440\u0430 \u043d\u0438\u043a\u043e\u0433\u0430 \u043d\u0435 \u0447\u0443\u0432\u0430\u0442 \u043d\u0438\u0449\u043e \u0434\u0440\u0434\u0443\u0433\u043e , \u043e\u0441\u0432\u0435\u043d \u043f\u043e\u0445\u0432\u0430\u043b\u0438\u0442\u0435\\"\\n\\n### \u0422\u0440\u0443\u0434, \u0442\u0440\u0443\u0434, \u0442\u0440\u0443\u0434\\n\\n\u041f\u0438\u0442\u044a\u0440 \u0414\u0440\u0430\u043a\u044a\u0434\\n\\n> \u0418 \u043d\u0430\u0439-\u0434\u043e\u0431\u0440\u0438\u044f\u0442 \u043f\u043b\u0430\u043d \u0435 \u0441\u0430\u043c\u043e \u0434\u043e\u0431\u0440\u0438 \u043d\u0430\u043c\u0435\u0440\u0435\u043d\u0438\u044f, \u0430\u043a\u043e \u043d\u0435 \u0441\u0435 \u043f\u0440\u0438\u0432\u0435\u0434\u0435 \u0432 \u0434\u0435\u043b\u043e.\\n\\n> \u041d\u0435 \u043c\u043e\u0436\u0435\u0448 \u0434\u0430 \u0441\u0438 \u0438\u0437\u0433\u0440\u0430\u0434\u0438\u0448 \u0440\u0435\u043f\u0443\u0442\u0430\u0446\u0438\u044f \u0441 \u043d\u0430\u043c\u0435\u0440\u0435\u043d\u0438\u0435\u0442\u043e \u043a\u0430\u043a\u0432\u043e \u0441\u043c\u044f\u0442\u0430\u0448 \u0434\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0448.\\n\\n\u0411\u0435\u043d \u0425\u043e\u0440\u043e\u0432\u0438\u0446\\n\\n> \\"\u0422\u0440\u0443\u0434\u043d\u043e\u0442\u043e \u043d\u0435 \u0435 \u0434\u0430 \u0441\u0438 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0448 \u0433\u043e\u043b\u044f\u043c\u0430, \u0440\u0438\u0441\u043a\u043e\u0432\u0430\u043d\u0430, \u0441\u043c\u0435\u043b\u0430 \u0446\u0435\u043b. \u0422\u0440\u0443\u0434\u043d\u043e\u0442\u043e \u0435 \u0434\u0430 \u0443\u0432\u043e\u043b\u043d\u044f\u0432\u0430\u0448 \u0445\u043e\u0440\u0430, \u043a\u043e\u0433\u0430\u0442\u043e \u043d\u0435 \u043f\u043e\u0441\u0442\u0438\u0433\u043d\u0435\u0448 \u0433\u043e\u043b\u044f\u043c\u0430\u0442\u0430 \u0441\u0438 \u0446\u0435\u043b... \u0422\u0440\u0443\u0434\u043d\u043e\u0442\u043e \u043d\u0435 \u0435 \u0434\u0430 \u0438\u043c\u0430\u0448 \u0433\u043e\u043b\u044f\u043c\u0430 \u043c\u0435\u0447\u0442\u0430. \u0422\u0440\u0443\u0434\u043d\u043e\u0442\u043e \u0435 \u0434\u0430 \u0441\u0435 \u0441\u044a\u0431\u0443\u0436\u0434\u0430\u0448 \u043d\u043e\u0449\u0435\u043c \u043e\u0431\u043b\u044f\u043d \u043e\u0442 \u0441\u0442\u0443\u0434\u0435\u043d\u0430 \u043f\u043e\u0442, \u043a\u043e\u0433\u0430\u0442\u043e \u043c\u0435\u0447\u0442\u0430\u0442\u0430 \u0442\u0438 \u0441\u0435 \u043f\u0440\u0435\u0432\u044a\u0440\u043d\u0435 \u0432 \u043a\u043e\u0448\u043c\u0430\u0440.\\"\\n\\n> \u0414\u0430\u0440\u0432\u0438\u043d, \u0440\u0430\u0431\u043e\u0442\u0438 \u0434\u0435\u0441\u0435\u0442\u0438\u043b\u0435\u0442\u0438\u044f \u043f\u043e \u0441\u0432\u043e\u044f\u0442\u0430 \u0442\u0435\u043e\u0440\u0438\u044f \u043d\u0430 \u0435\u0432\u043e\u043b\u044e\u0446\u0438\u044f\u0442\u0430, \u043a\u0430\u0442\u043e \u0441\u0435 \u0432\u044a\u0437\u0434\u044a\u0440\u0436\u0430 \u0434\u0430 \u044f \u043f\u043e\u0431\u043b\u0438\u043a\u0443\u0432\u0430, \u0437\u0430\u0449\u043e\u0442\u043e \u043e\u0449\u0435 \u043d\u0435 \u0435 \u0437\u0430\u0432\u044a\u0440\u0448\u0435\u043d\u0430."},{"id":"docker-wg-firefly-iii","metadata":{"permalink":"/blog/docker-wg-firefly-iii","source":"@site/blog/2024-12-31-docker-wg-firefly-iii/index.md","title":"Docker compose for Firefly III with WireGuard VPN client","description":"\u0417\u0430\u043f\u0438\u0441\u0430\u0445 \u0441\u0438 firefly-iii \u0432 docker \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u0435\u043d \u0441\u044a\u0440\u0432\u044a\u0440 Raspberry Pi5, \u043d\u043e \u0438\u0441\u043a\u0430\u0445 \u0434\u0430 \u0438\u043c\u0430\u043c \u0434\u043e\u0441\u0442\u044a\u043f \u0434\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435\u0442\u043e \u043d\u0430\u0432\u0441\u044f\u043a\u044a\u0434\u0435, \u0430 \u043d\u0435 \u0441\u0430\u043c\u043e \u0432 \u0434\u043e\u043c\u0430\u0448\u043d\u0430\u0442\u0430 \u043c\u0440\u0435\u0436\u0430.","date":"2024-12-31T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"finance","permalink":"/blog/tags/finance"},{"inline":true,"label":"firefly","permalink":"/blog/tags/firefly"},{"inline":true,"label":"wg","permalink":"/blog/tags/wg"},{"inline":true,"label":"wireguard","permalink":"/blog/tags/wireguard"}],"readingTime":4.88,"hasTruncateMarker":true,"authors":[{"name":"Boris Kolev","title":"owner","key":"boris","page":null}],"frontMatter":{"slug":"docker-wg-firefly-iii","title":"Docker compose for Firefly III with WireGuard VPN client","authors":["boris"],"tags":["docker","finance","firefly","wg","wireguard"]},"unlisted":false,"prevItem":{"title":"\u0415\u0433\u043e\u0442\u043e \u0435 \u0412\u0440\u0430\u0433\u044a\u0442 - \u0420\u0430\u0439\u044a\u043d \u0425\u043e\u043b\u0438\u0434\u0435\u0439, \u0438\u0437\u0431\u0440\u0430\u043d\u0438 \u043e\u0442\u043a\u044a\u0441\u0438","permalink":"/blog/ego-is-the-enemy"},"nextItem":{"title":"Regex MDbus LOG file with node.js","permalink":"/blog/regex"}},"content":"\u0417\u0430\u043f\u0438\u0441\u0430\u0445 \u0441\u0438 [firefly-iii](https://www.firefly-iii.org/) \u0432 docker \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u0435\u043d \u0441\u044a\u0440\u0432\u044a\u0440 Raspberry Pi5, \u043d\u043e \u0438\u0441\u043a\u0430\u0445 \u0434\u0430 \u0438\u043c\u0430\u043c \u0434\u043e\u0441\u0442\u044a\u043f \u0434\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435\u0442\u043e \u043d\u0430\u0432\u0441\u044f\u043a\u044a\u0434\u0435, \u0430 \u043d\u0435 \u0441\u0430\u043c\u043e \u0432 \u0434\u043e\u043c\u0430\u0448\u043d\u0430\u0442\u0430 \u043c\u0440\u0435\u0436\u0430.\\n\u0417\u0430 \u0446\u0435\u043b\u0442\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0445 docker-compose \u0444\u0430\u0439\u043b, \u043a\u043e\u0439\u0442\u043e:\\n\\n- \u0441\u044a\u0437\u0434\u0430\u0432\u0430 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u0441 [firefly-iii](https://www.firefly-iii.org/) \u0438 \u0434\u0440\u0443\u0433\u0438\u0442\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u0438 \u0437\u0430 \u043d\u0435\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0438\\n- \u0441\u044a\u0437\u0434\u0430\u0432\u0430 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u0441 [linuxserver/wireguard](https://github.com/linuxserver/docker-wireguard) VPN \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d \u043a\u0430\u0442\u043e \u043a\u043b\u0438\u0435\u043d\u0442, \u043a\u043e\u0439\u0442\u043e \u0441\u0435 \u0441\u0432\u044a\u0440\u0437\u0432\u0430 \u043a\u044a\u043c \u043b\u0438\u0447\u0435\u043d wireguard VPN \u0441\u044a\u0440\u0432\u044a\u0440 \u0438\u043d\u0441\u0442\u0430\u043b\u0438\u0440\u0430\u043d \u043d\u0430 Mikrotik \u0440\u0443\u0442\u0435\u0440 \u0432 \u0434\u0440\u0443\u0433\u0430 \u043c\u0440\u0435\u0436\u0430 \u0441\u044a\u0441 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u043d \u043f\u0443\u0431\u043b\u0438\u0447\u0435\u043d \u0430\u0434\u0440\u0435\u0441.\\n- \u0441\u0432\u044a\u0440\u0437\u0432\u0430 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0438\u0442\u0435 \u0432 \u043e\u0431\u0449\u0430 \u0438\u0437\u043e\u043b\u0438\u0440\u0430\u043d\u0430 \u043c\u0440\u0435\u0436\u0430 \u0441\u044a\u0441 \u0441\u0442\u0430\u0442\u0438\u0447\u043d\u0438 IP \u0430\u0434\u0440\u0435\u0441\u0438.\\n- \u043f\u0440\u0435\u043d\u0430\u0441\u043e\u0447\u0432\u0430\u043d\u0435 \u043d\u0430 \u043f\u043e\u0440\u0442\u043e\u0432\u0435 \u043e\u0442 VPN \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u043a\u044a\u043c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441 _firefly-iii_.\\n\\n\u041d\u043e \u0440\u0430\u0437\u0431\u0438\u0440\u0430 \u0441\u0435 \u0442\u043e\u0432\u0430 \u043d\u0435 \u0431\u0435\u0448\u0435 \u0434\u043e\u0441\u0442\u0430\u0442\u044a\u0447\u043d\u043e, \u0437\u0430 \u0434\u0430 \u0438\u043c\u0430\u043c \u0432\u0440\u044a\u0437\u043a\u0430 \u043a\u044a\u043c _firefly-iii_ \u0438\u0437\u0432\u044a\u043d \u043b\u043e\u043a\u0430\u043b\u043d\u0430 \u043c\u0440\u0435\u0436\u0430 \u0432 \u0434\u043e\u043c\u0430 \u043c\u0438.\\n\x3c!-- truncate --\x3e\\n\\n## WireGuard VPN\\n\\n\u0417\u0430 \u0446\u0435\u043b\u0442\u0430 \u0442\u0440\u044f\u0431\u0432\u0430\u0448\u0435 \u0434\u0430 \u0441\u0435 \u043d\u0430\u043f\u0440\u0430\u0432\u044f\u0442 \u043f\u0440\u0435\u043d\u0430\u0441\u043e\u0447\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u043f\u043e\u0440\u0442\u043e\u0432\u0435 \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441 _wireguard_. \u0422\u0435\u0437\u0438 \u043f\u0440\u0435\u043d\u0430\u0441\u043e\u0447\u0432\u0430\u043d\u0438\u044f \u043b\u0435\u0441\u043d\u043e \u043c\u043e\u0433\u0430\u0442 \u0434\u0430 \u0441\u0435 \u0434\u043e\u0431\u0430\u0432\u044f\u0442 \u0438 \u043f\u0440\u0435\u0437\\n\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u0438\u044f \u0444\u0430\u0439\u043b `wg0.conf` \u0447\u0440\u0435\u0437 `PostUp` \u0438 `PostDown` \u043a\u043e\u043c\u0430\u043d\u0434\u0438.\\n\\n### \u0421\u0442\u044a\u043f\u043a\u0430 1 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0430\u043d\u0435 \u043d\u0430 \u043a\u043b\u044e\u0447\u043e\u0432\u0435 \u0437\u0430 _wireguard_ \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\\n\\n\u0417\u0430 `linux` \u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0446\u0438\u0438, \u043a\u043e\u0438\u0442\u043e \u0441\u0430 \u0441 `kernel` \u0432\u0435\u0440\u0441\u0438\u044f `5.6+` \u043c\u043e\u0436\u0435 \u0434\u0430 \u0441\u0435 \u0438\u0437\u043f\u043e\u043b\u0437\u0432\u0430 `wireguard` \u043c\u043e\u0434\u0443\u043b\u0430, \u043a\u043e\u0439\u0442\u043e \u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u044f\u0434\u0440\u043e\u0442\u043e \u043f\u043e \u043f\u043e\u0434\u0440\u0430\u0437\u0431\u0438\u0440\u0430\u043d\u0435. \u041d\u044f\u043c\u0430 \u043d\u0443\u0436\u0434\u0430 \u043e\u0442 \u0438\u043d\u0441\u0442\u0430\u043b\u0438\u0440\u0430\u043d\u0435 \u043d\u0430 `wireguard-tools` \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438 \u043f\u0430\u043a\u0435\u0442\u0438.\\n\\n```bash title=\\"Generate keys for wireguard container\\"\\n wg genkey | tee privatekey | wg pubkey > publickey\\n```\\n\\n:::important\\n\u0442\u0435\u0437\u0438 \u0444\u0430\u0439\u043b\u043e\u0432\u0435 \u0442\u0440\u044f\u0431\u0432\u0430 \u0434\u0430 \u0441\u0430 \u0432 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f\u0442\u0430 `./config` \u043a\u043e\u044f\u0442\u043e \u043f\u043e\u0441\u043b\u0435 \u0449\u0435 \u0441\u0435 \u043c\u0430\u043f\u043d\u0435 \u043a\u044a\u043c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441 _wireguard_\\n:::\\n\\n:::note\\nThe tee command in Linux reads input from standard input (stdin) and writes it to both standard output (stdout) and one or more specified files. It essentially \\"splits\\" the output, allowing it to be displayed on the terminal and saved to a file simultaneously.\\n:::\\n\\n#### \u0421\u0442\u044a\u043f\u043a\u0430 1.1  \u0437\u0430\u0434\u0430\u0432\u0430\u043d\u0435 \u043d\u0430 \u043f\u0440\u0430\u0432\u0430 \u0437\u0430 private key \u0444\u0430\u0439\u043b\u0430\\n\\n```bash title=\\"Set permissions for the private key file\\"\\nchmod 600 privatekey\\n```\\n4+2 = 6 (read and write for the owner)\\n0 (no permissions for the group)\\n0 (no permissions for others)\\n\\n### \u0421\u0442\u044a\u043f\u043a\u0430 2 \u0441\u044a\u0437\u0434\u0430\u0432\u0430\u043d\u0435 \u043d\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u0435\u043d \u0444\u0430\u0439\u043b \u0437\u0430 _wireguard_ \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\\n\\n```conf title=\\"wg0.conf\\"\\n[Interface]\\nPrivateKey = <container_private_key>\\nAddress = 192.168.100.4/24\\nDNS = 192.168.100.1\\n\\nPostUp = iptables -t nat -A PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\\nPostDown = iptables -t nat -D PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE\\n\\n[Peer]\\nPublicKey = <server_public_key>\\nAllowedIPs = 0.0.0.0/0\\nEndpoint = <server_ip>:<server_port>\\nPersistentKeepalive = 50\\n```\\n - \u0432 \u0441\u043b\u0443\u0447\u0430\u044f \u043f\u0440\u0435\u043d\u0430\u0441\u043e\u0447\u0432\u0430\u043c\u0435 192.168.100.4:80 _wireguard_ (wg0_interfece) \u043a\u044a\u043c 192.168.200.4:8080 _firefly-iii_:\\n`iptables -t nat -A PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080`\\n - \u0441\u043b\u0435\u0434 \u0442\u043e\u0432\u0430 \u043c\u0430\u0441\u043a\u0438\u0440\u0430\u043c\u0435 \u043f\u0430\u043a\u0435\u0442\u0438\u0442\u0435, \u043a\u043e\u0438\u0442\u043e \u043f\u0440\u0435\u043c\u0438\u043d\u0430\u0432\u0430\u0442 \u043f\u0440\u0435\u0437 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 `eth0` \u043d\u0430 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441 _wireguard_:\\n`iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE`\\n\\n > \u0438\u0437\u043f\u043e\u043b\u0437\u0432\u0430\u043c\u0435 `%i` \u0437\u0430 \u0438\u043c\u0435\u0442\u043e \u043d\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430, \u043a\u043e\u0435\u0442\u043e \u0449\u0435 \u0431\u044a\u0434\u0435 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u043e \u043e\u0442 _wireguard_.\\n\\n:::tip\\n\u0442\u0440\u044f\u0431\u0432\u0430 \u0434\u0430 \u0441\u0435 \u0434\u043e\u0431\u0430\u0432\u0438 \u0432 `/etc/sysctl.conf`: \\n`net.ipv4.ip_forward=1` \u0437\u0430 \u0434\u0430 \u043f\u043e\u0437\u0432\u0432\u043e\u043b\u0438\u043c \u043f\u0440\u0435\u043d\u0430\u0441\u043e\u0447\u0432\u0430\u043d\u0435\u0442\u043e \u043d\u0430 \u043f\u043e\u0440\u0442\u043e\u0432\u0435, \u0432 \u0441\u043b\u0443\u0447\u0430\u044f \u0442\u043e\u0432\u0430 \u0441\u0435 \u043f\u0440\u0430\u0432\u0438 \u0432 `docker-compose` \u0444\u0430\u0439\u043ba\\n:::\\n\\n### \u0421\u0442\u044a\u043f\u043a\u0430 3 \u0434\u043e\u0431\u0430\u0432\u044f\u043d\u0435 \u043d\u0430 \u043d\u043e\u0432 \u043f\u0438\u044a\u0440 peer \u043a\u044a\u043c _wireguard_ \u0441\u044a\u0440\u0432\u044a\u0440\u0430\\n\\n\u0422\u0435\u0437\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0432 \u043c\u043e\u044f \u0441\u043b\u0443\u0447\u0430\u0439 \u0441\u0430 \u043f\u0440\u0435\u0437 \u043c\u0438\u043a\u043e\u0442\u0440\u0438\u043a \u0440\u0443\u0442\u0435\u0440\u0430, \u043a\u043e\u0438\u0442\u043e \u043d\u044f\u043c\u0430 \u0434\u0430 \u043e\u043f\u0438\u0441\u0432\u0430\u043c. \u0422\u0443\u043a \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0430 \u043d\u0430\u043c\u0435\u0440\u0438\u0442\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0437\u0430 \u0442\u043e\u0432\u0430 \u043a\u0430\u043a \u0441\u0435 \u043f\u0440\u0430\u0432\u0438: [WireGuard VPN Server on MikroTik](https://help.mikrotik.com/docs/spaces/ROS/pages/69664792/WireGuard)\\n\\n\\n### \u0421\u0442\u044a\u043f\u043a\u0430 4 \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430\u043d\u0435 \u043d\u0430 _wireguard_ \u0442\u0435\u0441\u0442\u043e\u0432\u0438 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\\n\\n\u0426\u0435\u043b\u0442\u0430 \u043d\u0430 \u0442\u0430\u0437\u0438 \u0441\u0442\u044a\u043f\u043a\u0430 \u0435 \u0434\u0430 \u0441\u0435 \u0442\u0435\u0441\u0442\u0432\u0430 \u0434\u0430\u043b\u0438 _wireguard_ \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u043c\u043e\u0436\u0435 \u0434\u0430 \u0441\u0435 \u0441\u0432\u044a\u0440\u0436\u0435 \u043a\u044a\u043c _wireguard_ \u0441\u044a\u0440\u0432\u044a\u0440\u0430.\\n\\n```yaml title=\\"wg-test-compose.yml\\"\\nservices:\\n  wireguard:\\n    image: lscr.io/linuxserver/wireguard:latest         #should retrieve the correct image for your arch\\n    container_name: wireguard\\n    cap_add:\\n      - NET_ADMIN\\n      - SYS_MODULE #optional Some hosts may not load the iptables kernel modules by default\\n    environment:\\n      - PUID=1000\\n      - PGID=1000\\n      - TZ=Etc/UTC\\n      #- SERVERURL=wireguard.domain.com #optional\\n      #- SERVERPORT=51820 #optional\\n      #- PEERS=1 #optional\\n      #- PEERDNS=auto #optional\\n      #- INTERNAL_SUBNET=10.13.13.0 #optional\\n      #- ALLOWEDIPS=0.0.0.0/0 #optional\\n      #- PERSISTENTKEEPALIVE_PEERS= #optional\\n      - LOG_CONFS=true #optional\\n    volumes:\\n      - ./config:/config\\n      - /lib/modules:/lib/modules #optional if SYS_MODULE is set\\n    ports:\\n      - 51820:51820/udp\\n    sysctls:\\n      - net.ipv4.conf.all.src_valid_mark=1\\n      - net.ipv4.ip_forward=1\\n    restart: unless-stopped\\n\\n```\\n\u043c\u043e\u0436\u0435 \u0434\u0430 \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430\u043c\u0435 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441\\n`docker compose -f wg-test-compose.yml up `\\n\\n:::tip\\n\u043f\u0440\u0438 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430\u043d \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043c\u043e\u0436\u0435 \u0434\u0430 \u0432\u043b\u0435\u0437\u0435\u0442\u0435 \u0432 \u043d\u0435\u0433\u043e \u0441 `docker exec -it wireguard /bin/bash` \u0438 \u0434\u0430 \u043f\u0438\u043d\u0433\u043d\u0435\u0442\u0435 wireguard \u0441\u044a\u0440\u0432\u044a\u0440\u0430 \u0441 `ping <server_ip>`  \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0430 \u043c\u0430\u0448\u0438\u043d\u0430 \u0432 \u043c\u0440\u0435\u0436\u0430\u0442\u0430 \u043d\u0430 \u0441\u044a\u0440\u0432\u044a\u0440\u0430.\\n:::\\n\u0441\u043b\u0435\u0434 \u043a\u0430\u0442\u043e \u0432\u0441\u0438\u0447\u043a\u043e \u0440\u0430\u0431\u043e\u0442\u0438 \u043c\u043e\u0436\u0435 \u0434\u0430 \u0438\u0437\u0442\u0440\u0438\u0435\u0442\u0435 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0441 `docker compose -f wg-test-compose.yml down` \u0438 \u0434\u0430 \u043f\u0440\u0435\u043c\u0438\u043d\u0435\u0442\u0435 \u043a\u044a\u043c \u0441\u043b\u0435\u0434\u0432\u0430\u0449\u0438\u044f \u0435\u0442\u0430\u043f\\n\\n## Docker compose\\n\\n\u0417\u0430 \u0434\u043e\u043f\u044a\u043b\u043d\u0438\u0442\u0435\u043b\u043d\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043a\u0430\u043a \u0441\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u0432\u0430 _firefly-iii_ \u0432 docker \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043c\u043e\u0436\u0435 \u0434\u0430 \u043f\u0440\u043e\u0447\u0435\u0442\u0435\u0442\u0435 \u0442\u0443\u043a: [Firefly III Docker](https://docs.firefly-iii.org/how-to/firefly-iii/installation/docker/)\\n\\n\u0426\u0435\u043b\u0438\u044f\u0442 docker-compose \u0444\u0430\u0439\u043b \u0438\u0437\u0433\u043b\u0435\u0436\u0434\u0430 \u0442\u0430\u043a\u0430:\\n\\n```yaml title=\\"docker-compose.yml\\"\\nservices:\\n  wireguard:\\n    image: lscr.io/linuxserver/wireguard:latest         #should retrieve the correct image for your arch\\n    container_name: wireguard\\n    networks:\\n      wg_network:\\n        ipv4_address: 192.168.200.2\\n    cap_add:\\n      - NET_ADMIN\\n      - SYS_MODULE #optional Some hosts may not load the iptables kernel modules by default\\n    environment:\\n      - PUID=1000\\n      - PGID=1000\\n      - TZ=Etc/UTC\\n      #- SERVERURL=wireguard.domain.com #optional\\n      #- SERVERPORT=51820 #optional\\n      #- PEERS=1 #optional\\n      #- PEERDNS=auto #optional\\n      #- INTERNAL_SUBNET=10.13.13.0 #optional\\n      #- ALLOWEDIPS=0.0.0.0/0 #optional\\n      #- PERSISTENTKEEPALIVE_PEERS= #optional\\n      - LOG_CONFS=true #optional\\n    volumes:\\n      - ./config:/config\\n      - /lib/modules:/lib/modules #optional if SYS_MODULE is set\\n    ports:\\n      - 51820:51820/udp\\n    sysctls:\\n      - net.ipv4.conf.all.src_valid_mark=1\\n      - net.ipv4.ip_forward=1\\n    restart: unless-stopped\\n\\n  app:\\n    image: fireflyiii/core:latest\\n    hostname: app\\n    container_name: firefly_iii_core\\n    restart: always\\n    volumes:\\n      - firefly_iii_upload:/var/www/html/storage/upload\\n    env_file: .env\\n    networks:\\n      wg_network:\\n        ipv4_address: 192.168.200.4\\n    ports:\\n      - 85:8080\\n    depends_on:\\n      - db\\n  db:\\n    image: mariadb:lts\\n    hostname: db\\n    container_name: firefly_iii_db\\n    restart: always\\n    env_file: .db.env\\n    networks:\\n      wg_network:\\n        ipv4_address: 192.168.200.3\\n    volumes:\\n      - firefly_iii_db:/var/lib/mysql\\n  cron:\\n    #\\n    # To make this work, set STATIC_CRON_TOKEN in your .env file or as an environment variable and replace REPLACEME below\\n    # The STATIC_CRON_TOKEN must be *exactly* 32 characters long\\n    #\\n    image: alpine\\n    restart: always\\n    container_name: firefly_iii_cron\\n    command: sh -c \\"echo \\\\\\"0 3 * * * wget -qO- http://app:8080/api/v1/cron/REPLACEME;echo\\\\\\" | crontab - && crond -f -L /dev/stdout\\"\\n    networks:\\n      wg_network:\\n        ipv4_address: 192.168.200.5\\n\\nvolumes:\\n   firefly_iii_upload:\\n   firefly_iii_db:\\n\\nnetworks:\\n  wg_network:\\n    driver: bridge\\n    ipam:\\n      config:\\n        - subnet: 192.168.200.0/24\\n```"},{"id":"regex","metadata":{"permalink":"/blog/regex","source":"@site/blog/2024-09-24-basic-nodejs-regex-formatter/index.mdx","title":"Regex MDbus LOG file with node.js","description":"Open a file, perform regex and generate output file","date":"2024-09-24T00:00:00.000Z","tags":[{"inline":false,"label":"regex","permalink":"/blog/tags/regex","description":"regex tag description"},{"inline":false,"label":"node","permalink":"/blog/tags/node"},{"inline":false,"label":"javascript","permalink":"/blog/tags/js"},{"inline":true,"label":"modbus","permalink":"/blog/tags/modbus"}],"readingTime":2.15,"hasTruncateMarker":true,"authors":[{"name":"Boris Kolev","title":"owner","key":"boris","page":null}],"frontMatter":{"slug":"regex","title":"Regex MDbus LOG file with node.js","authors":["boris"],"tags":["regex","node","js","modbus"]},"unlisted":false,"prevItem":{"title":"Docker compose for Firefly III with WireGuard VPN client","permalink":"/blog/docker-wg-firefly-iii"}},"content":"Open a file, perform regex and generate output file\\n\\n\x3c!-- truncate --\x3e\\n\\nCreate a `*.js` file dor exapmle `formatter.js` , *formatter* because this will format [beckhoff.log](./beckhoff.LOG) file from MDBus session to our needs.\\n\\n\\n- will filter for slaveID 01 and func type 03 with `pattern1`, will add new line `\\\\n` and carriage return `\\\\r` before the first match group `$1`, which is (`pattern1`)\\n- will remove the date/time stamp on `pattern2`,\\n- additional formatting with the 3rd pattern\\n\\n```js title=\\"formatter.js\\"\\nconst fs = require(\\"fs\\");\\n\\n// Function to process the file\\nfunction processFile(inputFile, outputFile) {\\n  // Read the input file as a string\\n  fs.readFile(inputFile, \\"utf8\\", (err, data) => {\\n    if (err) {\\n      console.error(\\"Error reading the input file:\\", err);\\n      return;\\n    }\\n\\n    // Find the pattern \\"01 03 \\" and ensure a newline before each occurrence\\n    const pattern1 = \\"01 03 \\";\\n    const pattern2 = /\\\\d{2} \\\\d{2}:\\\\d{2}:\\\\d{2}\\\\.\\\\d{3} B/g;\\n    const modifiedData = data\\n      .replace(pattern2, \\"\\")\\n      .replace(new RegExp(`(${pattern1})`, \\"g\\"), \\"\\\\n\\\\r$1\\")\\n      .replace(/\\\\s\\\\n\\\\s{2}/g, \\"\\");\\n\\n    // Write the modified content to output.txt\\n    file: fs.writeFile(outputFile, modifiedData, \\"utf8\\", (err) => {\\n      if (err) {\\n        console.error(\\"Error writing the output file:\\", err);\\n        return;\\n      }\\n      console.log(`File processed successfully. Check the output at ${outputFile}`);\\n    });\\n  });\\n}\\n\\n// Specify input and output file paths\\nconst inputFile = \\"beckhoff.log\\";\\nconst outputFile = \\"output.txt\\";\\n\\n// Process the file\\nprocessFile(inputFile, outputFile);\\n\\n```\\n\\nTo run the code make sure `beckhoff.log` is in the same folder and type in the terminal:\\n```\\nnode formatter.js\\n```\\nthis will run the app and generate a text file `output.txt` with formatted data\\n\\n\\n## Additional Explanation:\\n\\n***From ChatGPT:***\\n\\n The expression `\\\\n\\\\r$1` is commonly used in the context of a replace operation with regular expressions. Here\'s what it means:\\n\\n `\\\\n\\\\r`: This represents a combination of newline (\\\\n) and carriage return (\\\\r), which is often used to create a new line or start a new paragraph in some operating systems (like Windows).\\n\\n`\\\\n`: Newline character (moves the cursor to the next line).\\\\\\n`\\\\r`: Carriage return (moves the cursor to the beginning of the line).\\\\\\n`$1`: In regular expressions, $1 refers to the first captured group from a matching pattern.\\n\\n When you use parentheses () in a regular expression, whatever is matched inside those parentheses is stored as a \\"capture group.\\"\\n `$1` is a placeholder for the content of the first capturing group, i.e., whatever was matched by the first set of parentheses in the regex.\\n\\n const regex = /(\\\\d+)/g;\\n const str = \\"12345\\";\\n const result = str.replace(regex, \'\\\\n\\\\r$1\');\\n console.log(result);\\n\\n Explanation:\\n\\n Pattern `(\\\\d+)`: Captures one or more digits (e.g., 12345).\\n Replacement `\\\\n\\\\r$1`: Adds a newline and carriage return before the matched digits (which is captured as `$1`)."}]}}')}}]);