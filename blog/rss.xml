<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>BK`s notes Blog</title>
        <link>https://kolevbm.github.io/blog</link>
        <description>BK`s notes Blog</description>
        <lastBuildDate>Mon, 29 Dec 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Teleoperation of SO-ARM101 on rpi 3B+ as a service]]></title>
            <link>https://kolevbm.github.io/blog/rpi lerobot so-arm101 teleoperate</link>
            <guid>https://kolevbm.github.io/blog/rpi lerobot so-arm101 teleoperate</guid>
            <pubDate>Mon, 29 Dec 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Goal of this project:]]></description>
            <content:encoded><![CDATA[<p>Goal of this project:<br>
<!-- -->When the rpi boots up, the teleoperation of arms to be activated shortly</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab setup<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#lab-setup" class="hash-link" aria-label="Direct link to Lab setup" title="Direct link to Lab setup">​</a></h2>
<p>In the beginning I had a lot of issues with the rpi recognising the usb boards of the arms, one of them, sometimes both,
had problems connecting as a usb device, asked the GPT of course. It was a power issue concerning both the pi itself and the boards, so I connected an external powered usb hub and everything was fine.<br>
<!-- -->The main flaw of this lab setup is the number of power outlets I needed. Everything was 5V but I had no strong power supply onboard, so I used power adapter for each device, 4 in total.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">         ┌──────────────────────┐                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │   Bus Servo Driver   │                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │        board         │                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │      follower        ┼──────┐                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └──────────────────────┘      │   usb    ┌─────────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌─────────┐                   └──────────┼         │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ext.power│                              │         │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └─────────┘                              │   USB   ┼─────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           usb    │   hub   │     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌──────────────────────┐      ┌──────────┤         │     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │   Bus Servo Driver   │      │          └─────────┘     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │        board         │      │          ┌─────────┐     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │      follower        ┼──────┘          │ext.power│     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └──────────────────────┘                 └─────────┘     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌─────────┐                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ext.power│                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └─────────┘                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌──────────────────────────────────────────────────┐     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           ┌──────┐ usb │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           │      ┼─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           │      │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           └──────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌┐                                          ┌──────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ││            RPI 3B+                       │      │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ││                                          │      │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └┘                                          └──────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           ┌──────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           │      │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                                           │      │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │    ┌───┐                                  └──────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └────└───┘─────────────────────────────────────────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ┌─────────┐                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ext.power│                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └─────────┘                                               </span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-of-lerobot-on-the-rpi">Installation of lerobot on the rpi<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#installation-of-lerobot-on-the-rpi" class="hash-link" aria-label="Direct link to Installation of lerobot on the rpi" title="Direct link to Installation of lerobot on the rpi">​</a></h2>
<p>Following the <a href="https://huggingface.co/docs/lerobot/installation" target="_blank" rel="noopener noreferrer">official guide for the installation</a>  of the project<br>
<!-- -->I encountered issues with the free space while installing one of the dependencies <code>OSError: [Errno 28] No space left on device</code>. It was the <code>/tmp</code> folder,
it had only 454MB of free space . It turned out that <code>/tmp</code> is a <code>tmpfs</code> (RAM-backed filesystem) limited to ~454 MB</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Filesystem      Size  Used Avail Use% Mounted on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">udev            317M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  317M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           182M  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.1M  178M   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">% /run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/mmcblk0p2   29G  </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">.4G   20G  </span><span class="token number" style="color:#36acaa">27</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           454M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  454M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /dev/shm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">.0M   12K  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">.0M   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /run/lock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /run/credentials/systemd-journald.service</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">tmpfs           454M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  454M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/mmcblk0p1  510M   74M  437M  </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">% /boot/firmware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /run/credentials/getty@tty1.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.0M   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /run/credentials/serial-getty@ttyS0.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmpfs            91M  </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">.0K   91M   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /run/user/1000</span><br></span></code></pre></div></div>
<p>So before installing the pip packages <code>pip install -e .</code> I created a tmp directory</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> ~/pip-tmp</span><br></span></code></pre></div></div>
<p>and after that</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">TMPDIR</span><span class="token operator" style="color:#393A34">=~</span><span class="token plain">/pip-tmp pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token builtin class-name">.</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="calibration-of-the-arms">Calibration of the arms<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#calibration-of-the-arms" class="hash-link" aria-label="Direct link to Calibration of the arms" title="Direct link to Calibration of the arms">​</a></h2>
<p>The motor IDs were set before, but I did not have the calibration configurations <code>~/.cache/huggingface/lerobot/calibration/robots/so101_follower/red_sting.json</code> and <code>~/.cache/huggingface/lerobot/calibration/teleoperators/so101_leader/gray_hound.json</code> so I made the calibration again following the <a href="https://huggingface.co/docs/lerobot/so101#calibrate" target="_blank" rel="noopener noreferrer">official guide</a> but this time with the API.<br>
<!-- -->First run the <em>isolated Python environment</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda activate lerobot</span><br></span></code></pre></div></div>
<p>and then run the script for each robot:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">follower</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> lerobot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">robots</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">so101_follower </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SO101FollowerConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SO101Follower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101FollowerConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/dev/ttyUSB_follower_arm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"red_sting"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follower </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101Follower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follower</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calibrate</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follower</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">calibrate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follower</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">leader</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> lerobot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">teleoperators</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">so101_leader </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SO101LeaderConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SO101Leader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101LeaderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/dev/ttyUSB_leader_arm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"gray_hound"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101Leader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calibrate</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">calibrate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-test-of-teleoperation">Initial test of teleoperation<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#initial-test-of-teleoperation" class="hash-link" aria-label="Direct link to Initial test of teleoperation" title="Direct link to Initial test of teleoperation">​</a></h2>
<p>When calibrated it was time to test the teleoperation, so under the isolated Python environment I run this script:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">teleoperate.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> lerobot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">teleoperators</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">so101_leader </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SO101LeaderConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SO101Leader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> lerobot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">robots</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">so101_follower </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SO101FollowerConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SO101Follower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robot_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101FollowerConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/dev/ttyUSB_follower_arm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"red_sting"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">teleop_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101LeaderConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/dev/ttyUSB_leader_arm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"gray_hound"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101Follower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">robot_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">teleop_device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SO101Leader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">teleop_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">teleop_device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> teleop_device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>I confirmed that everything is okay and proceeded to the automation itself</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="make-the-usb-boards-follower-leader-arms-distinguishable-udev-rules">Make the usb boards (follower, leader arms) distinguishable, udev rules<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#make-the-usb-boards-follower-leader-arms-distinguishable-udev-rules" class="hash-link" aria-label="Direct link to Make the usb boards (follower, leader arms) distinguishable, udev rules" title="Direct link to Make the usb boards (follower, leader arms) distinguishable, udev rules">​</a></h2>
<p>First I had to be sure that the USB devices had the same name each time they were plugged into the USB bus. Most of the time they had <code>/dev/ttyACM1</code> file names, ranging from 0-5. That meant it was not sure that <code>/dev/ttyACM0</code> is the follower, it could be the leader arm.<br>
<!-- -->One way to distinguish a device is to use the VID and PID listed from <code>lsusb</code> but in this case they were the same:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Bus 001 Device 061: ID 1a86:55d3 QinHeng Electronics USB Single Serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bus 001 Device 062: ID 1a86:55d3 QinHeng Electronics USB Single Serial</span><br></span></code></pre></div></div>
<p>Another way is to bind it to the specific usb port, but it was not okay, so I used the <code>udevadm info</code> to check the serial ID of each chip inside. One by one knowing for sure that <code>/dev/ttyACM0</code> is the correct arm, I found the <code>ATTRS{serial}</code> of each motor driver PCB:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">udevadm info -a /dev/ttyACM2 | grep -i serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ATTRS{product}=="USB Single Serial"</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    ATTRS{serial}=="5AB9067929"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ATTRS{serial}=="3f980000.usb"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">udevadm info -a /dev/ttyACM3 | grep -i serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ATTRS{product}=="USB Single Serial"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ATTRS{serial}=="5AB9067722"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ATTRS{serial}=="3f980000.usb"    </span><br></span></code></pre></div></div>
<p>Then I created a <em><strong>udev rule</strong></em> and placed that rule in <code>/etc/udev/rules.d/</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">98-LeRobot.rules</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">SUBSYSTEM</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">"tty"</span><span class="token plain">, ATTRS</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">serial</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">"5AB9067722"</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">SYMLINK</span><span class="token operator" style="color:#393A34">+=</span><span class="token string" style="color:#e3116c">"ttyUSB_follower_arm"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">SUBSYSTEM</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">"tty"</span><span class="token plain">, ATTRS</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">serial</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">"5AB9067929"</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">SYMLINK</span><span class="token operator" style="color:#393A34">+=</span><span class="token string" style="color:#e3116c">"ttyUSB_leader_arm"</span><br></span></code></pre></div></div>
<p>With these rules in place I run the following commands to reload and trigger the new rules</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo udevadm control --reload  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo udevadm trigger</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-the-shell-script">Prepare the shell script<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#prepare-the-shell-script" class="hash-link" aria-label="Direct link to Prepare the shell script" title="Direct link to Prepare the shell script">​</a></h2>
<p>Prior to creating the project running as a service I had to create and test the <code>autoTeleoperation.sh</code> script. The script checks for the existance of the files <code>/dev/ttyUSB_follower_arm</code> and <code> /dev/ttyUSB_leader_arm</code>, if so activates the isolated python environment and runs the python script <code>teleoperate.py</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -e #exit on error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONDA_BASE="/home/boris/opt/miniforge3"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV_NAME="lerobot"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SCRIPT="/home/boris/teleoperate.py"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Waiting for USB devices..."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -e checks if file exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while [ ! -e /dev/ttyUSB_follower_arm ] || [ ! -e /dev/ttyUSB_leader_arm ]; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Activate conda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source "$CONDA_BASE/etc/profile.d/conda.sh"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda activate "$ENV_NAME"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Starting Teleoperation!"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run python script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec python "$SCRIPT"</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-daemon">Create the daemon<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#create-the-daemon" class="hash-link" aria-label="Direct link to Create the daemon" title="Direct link to Create the daemon">​</a></h2>
<p>After the test of the shell script it was timi to create the  service itself<br>
<!-- -->TODO: where it must be, how to load it, how to use journalctl -u to check for logs</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">lerobot.service</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Description</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LeRobot startup </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">After</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Wants</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">User</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">boris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">WorkingDirectory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/home/boris/lerobot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ExecStart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/home/boris/autoTeleoperate.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Restart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">RestartSec</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">StandardOutput</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">journal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">StandardError</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">journal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">WantedBy</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">multi-user.target</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="https://kolevbm.github.io/blog/rpi%20lerobot%20so-arm101%20teleoperate#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>]]></content:encoded>
            <category>rpi</category>
            <category>raspbery Pi</category>
            <category>linux</category>
            <category>lerobot</category>
            <category>so-arm101</category>
            <category>so-arm</category>
            <category>robotics</category>
            <category>systemd</category>
            <category>udev</category>
        </item>
        <item>
            <title><![CDATA[Running can bus on embedded linux - Luckfox Pico Ultra rv1106g]]></title>
            <link>https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd</link>
            <guid>https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd</guid>
            <pubDate>Thu, 27 Nov 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Table of Contents:]]></description>
            <content:encoded><![CDATA[<p><strong>Table of Contents:</strong></p>
<ul>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#lab-setup">Lab setup</a></li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#buildroot">Buildroot</a>
<ul>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#add-the-packages-in-buildroot">Add the packages in buildroot</a></li>
</ul>
</li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#kernel-config">Kernel config</a>
<ul>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#configuring-the-kernel">Configuring the Kernel</a></li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#device-tree">Device Tree</a>
<ul>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#1-modify-the-dts">1. Modify the <code>dts</code></a></li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#2-modify-the-dtsi">2. Modify the <code>.dtsi</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#final-preparation">Final preparation</a></li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#end-result">End Result</a></li>
<li><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#references">References</a></li>
</ul>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab setup<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#lab-setup" class="hash-link" aria-label="Direct link to Lab setup" title="Direct link to Lab setup">​</a></h2>
<p>The SBC <em>luckfox-pico-ultra</em> is mounted on a custom made motherboard with some external peripherals such as can bus and isolated rs-485</p>
<p>SBC: <a href="https://www.luckfox.com/Luckfox-Pico/EN-Luckfox-Pico-Ultra" target="_blank" rel="noopener noreferrer">Luckfox Pico Ultra W rv1106g 8GB</a><br>
<!-- -->Custom motherboard: <a href="https://kolevbm.github.io/assets/files/custom-motherboard-8b88d5035818191d3482460d593d54b0.pdf" target="_blank">schematics</a></p>
<p>I am using the containerized Luckfox SDK docker image <code>luckfoxtech/luckfox_pico:1.0</code> for build environment.
As image flashing tool: <code>SOC Toolkit</code> for Windows. The whole system image flashing procedure is well documented in the <a href="https://wiki.luckfox.com/Luckfox-Pico-Ultra/Flash-image" target="_blank" rel="noopener noreferrer">official wiki</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="buildroot">Buildroot<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#buildroot" class="hash-link" aria-label="Direct link to Buildroot" title="Direct link to Buildroot">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-packages-in-buildroot">Add the packages in buildroot<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#add-the-packages-in-buildroot" class="hash-link" aria-label="Direct link to Add the packages in buildroot" title="Direct link to Add the packages in buildroot">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. can-utils</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. iproute2</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><strong>can-utils</strong> includes <code>candump</code>, <code>cansend</code>, <code>cansniffer</code> etc</p><div style="width:100"><img decoding="async" loading="lazy" alt="packages-1" src="https://kolevbm.github.io/assets/images/packages-01-3826990006abc127ebcc2fa125c04bb9.png" width="746" height="576" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>iproute2</strong> is the Linux networking toolkit that replaced net-tools (ifconfig, route, arp etc.)<br>
<a href="https://paulgorman.org/technical/linux-iproute2-cheatsheet.html" target="_blank" rel="noopener noreferrer">iproute2 cheatsheet</a></p><div style="width:80"><img decoding="async" loading="lazy" alt="packages-2" src="https://kolevbm.github.io/assets/images/packages-02-8eb1c128005216d952c5c1b6f2cfd0d3.png" width="736" height="588" class="img_ev3q"></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kernel-config">Kernel config<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#kernel-config" class="hash-link" aria-label="Direct link to Kernel config" title="Direct link to Kernel config">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-kernel">Configuring the Kernel<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#configuring-the-kernel" class="hash-link" aria-label="Direct link to Configuring the Kernel" title="Direct link to Configuring the Kernel">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. Set a local version</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. Enable the SPI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3. Enable CAN-SPI driver</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>It is good to set the kernel a local version name, so you can later check what is the kernel image on the SBC with <code>uname</code></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">General Setup ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ()Local version - append to kernel release</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="https://kolevbm.github.io/assets/images/kernel-local-version-ab1466021b3a222ec519b56950135aff.png" width="740" height="591" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [*] SPI support</span><br></span></code></pre></div></div><p></p><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="https://kolevbm.github.io/assets/images/kernel-spi-support-124d68ae0461a59ddc6cdd94082901e5.png" width="742" height="589" class="img_ev3q"></div>
It is also helpful to enable the Debug support for SPI drivers, one menu deep inside SPI support<p></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  Networking support ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CAN bus subsystem support ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CAN Device Drivers ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CAN SPI interfaces ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;*&gt; Microchip MCP251xFD SPI CAN controllers</span><br></span></code></pre></div></div><div style="width:50"><img decoding="async" loading="lazy" alt="kernel-local-version" src="https://kolevbm.github.io/assets/images/kernel-can-drivers-01-3788877007555cf49e30b2af1dc357e9.png" width="743" height="592" class="img_ev3q"></div><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="https://kolevbm.github.io/assets/images/kernel-can-drivers-02-c1179bc98222e6b9d046db02cf06bd9a.png" width="737" height="589" class="img_ev3q"></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-tree">Device Tree<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#device-tree" class="hash-link" aria-label="Direct link to Device Tree" title="Direct link to Device Tree">​</a></h3>
<p>According to Luckfox:</p>
<blockquote>
<p>For Luckfox Pico, the basic device tree configurations related to the RV1103 / RV1106 chips—such as rv1106.dtsi, rv1106-pinctrl.dtsi, etc.—are provided by Rockchip. Based on the hardware resources available on the Luckfox Pico, the default configurations are set in .dtsi files, while model-specific hardware information is defined in .dts files.</p>
<ul>
<li>The configurations in .dts files have the highest priority and can override settings in the .dtsi files. You can reference nodes from .dtsi and either modify their properties or recreate them entirely.</li>
<li>For easier editing, the .dts file corresponding to the selected board support package is symlinked to <code>&lt;luckfox-pico SDK&gt;/config/dts_config</code> after running ./build.sh. Normally, you only need to edit the .dts file to configure hardware features—.dtsi files should not be modified.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="dts-tree" src="https://kolevbm.github.io/assets/images/dts-01-b198b812875286b48f2211d30e32ce93.png" width="503" height="372" class="img_ev3q"></p>
</blockquote>
<p>The <code>dts</code> files are located under <code>&lt;SDK-folder&gt;/sysdrv/source/kernel/arch/arm/boot/dts</code> the ones that we need are named as follows:</p>
<table><thead><tr><th style="text-align:center">sbc</th><th style="text-align:center">.dts</th><th style="text-align:center">.dtsi</th></tr></thead><tbody><tr><td style="text-align:center">Luckfox Pico ultra W</td><td style="text-align:center">rv1106g-luckfox-pico-ultra-w.dts</td><td style="text-align:center">rv1106-luckfox-pico-ultra-ipc.dtsi</td></tr></tbody></table>
<p><a href="https://wiki.luckfox.com/Luckfox-Pico-Ultra/Device-Tree" target="_blank" rel="noopener noreferrer">(check here for others)</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-modify-the-dts">1. Modify the <code>dts</code><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#1-modify-the-dts" class="hash-link" aria-label="Direct link to 1-modify-the-dts" title="Direct link to 1-modify-the-dts">​</a></h4>
<p>In the <code>.dts</code> file you can see that I have removed a lot of things for the sake of simplicity and the lab itself (running the CAN). The missing parts are mainly regarding the <code>BT</code> and <code>SDIO-WIFI</code></p>
<ul>
<li>modified: <a href="https://kolevbm.github.io/assets/files/rv1106g-luckfox-pico-ultra-w-modified-5547854a40c65cd809838b71b2a4125d.dts" target="_blank">rv1106g-luckfox-pico-ultra-w.dts</a></li>
<li>original: <a href="https://kolevbm.github.io/assets/files/rv1106g-luckfox-pico-ultra-w-2d1daddd9501df79a5c9e4f72f306fdd.dts" target="_blank">rv1106g-luckfox-pico-ultra-w.dts</a></li>
</ul>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. Modified dts</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. clock frequency</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3. interrupts</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// SPDX-License-Identifier: (GPL-2.0+ OR MIT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* Copyright (c) 2022 Rockchip Electronics Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dts</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v1</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">"rv1106.dtsi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">"rv1106-luckfox-pico-ultra-ipc.dtsi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/input/input.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/display/media-bus-format.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clk_mcp251xfd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp251xfd </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fixed-clock"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">40000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**********SPI**********/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"okay"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"okay"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"microchip,mcp251xfd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">4000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                interrupts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">RK_PC6 IRQ_TYPE_LEVEL_LOW</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                interrupt</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">gpio1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clocks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">names </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mcp251xfd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                vdd</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                xceiver</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>here the <code>clock-frequency</code> must be the equal to the oscillator of the board used e.g. if the oscillator is 20MHz it should be 20000000 in our case we use 40MHz, otherwise it just won't work</p><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp251xfd </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fixed-clock"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">40000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="mcp-oscillator" src="https://kolevbm.github.io/assets/images/mcp-oscillator-a22079a5da0e6ab1ef69adfc46313d58.png" width="956" height="593" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>As pin for the interrupt we are using C6 from the luckfox board which should be configured as interrupt Input pin active on Low level</p><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**********SPI**********/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"okay"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"okay"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"microchip,mcp251xfd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">4000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              interrupts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">RK_PC6 IRQ_TYPE_LEVEL_LOW</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              interrupt</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">gpio1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clocks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">names </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mcp251xfd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              vdd</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              xceiver</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="dts-02" src="https://kolevbm.github.io/assets/images/dts-02-7b2ac0d362596fb0c99af401578a1b7e.png" width="708" height="587" class="img_ev3q"></div><div style="width:100"><img decoding="async" loading="lazy" alt="dts-03" src="https://kolevbm.github.io/assets/images/dts-03-ee2f18fc5c2a83c10a98d9012a146983.png" width="967" height="502" class="img_ev3q"></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-modify-the-dtsi">2. Modify the <code>.dtsi</code><a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#2-modify-the-dtsi" class="hash-link" aria-label="Direct link to 2-modify-the-dtsi" title="Direct link to 2-modify-the-dtsi">​</a></h4>
<p>Here I have removed <code>CSI</code>, <code>LCD/TP</code> and the things related to the RGB,
because some pins are needed for interrupt of the <code>mcp2518fd</code> chip.</p>
<p>You can compare them to see the full changes e.g. with WinMerge:</p>
<ul>
<li>modified <code>.dtsi</code> : <a href="https://kolevbm.github.io/assets/files/rv1106-luckfox-pico-ultra-ipc-modified-756482bb1eeb081dbcb4358e5f364a63.dtsi" target="_blank">rv1106-luckfox-pico-ultra-ipc.dtsi</a></li>
<li>original <code>.dtsi</code> : <a href="https://kolevbm.github.io/assets/files/rv1106-luckfox-pico-ultra-ipc-3fe7d680a1df1b1ea17f217dd67e34cc.dtsi" target="_blank">rv1106-luckfox-pico-ultra-ipc.dtsi</a></li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The configurations in .dts files have the highest priority and can override settings in the .dtsi files, so
the <code>clk_mcp2515</code> in the root node  and <code>&amp;spi0</code> are overwrited by the dts so their prop values are not applied.</p></div></div>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Modified dts</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106-luckfox-pico-ultra-ipc.dtsi</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// SPDX-License-Identifier: (GPL-2.0+ OR MIT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* Copyright (c) 2022 Rockchip Electronics Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">"rv1106-evb.dtsi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/input/input.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/display/media-bus-format.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clk_mcp2515</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp2515 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fixed-clock"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">8000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// SPI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rockchip,spidev"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">50000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pinctrl </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_clk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">clk </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC1 </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_mosi</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mosi </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC2 </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_miso</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">miso </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC3 </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_cs0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cs0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC0 </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-preparation">Final preparation<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#final-preparation" class="hash-link" aria-label="Direct link to Final preparation" title="Direct link to Final preparation">​</a></h2>
<p>Build the image with the <code>SDK</code> and upload it with the <code>SOC toolkit</code></p>
<ul>
<li>Useful commands in host machine:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># attach to the container with the SDK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> attach </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># when inside the SDK folder to see options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh </span><span class="token builtin class-name">help</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># copy a file/folder from docker container to current directory </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">full-path-to-sdk</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/IMAGE/IPC_EMMC_BUILDROOT_RV1106_LUCKFOX_PICO_ULTRA_W_20251125.2257_RELEASE_TEST </span><span class="token builtin class-name">.</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li>useful commands in embedded device:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># check kernel messages regarding mcp can or spi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">dmesg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mcp|can|spi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># prepare the can0 interface link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 </span><span class="token builtin class-name">type</span><span class="token plain"> can bitrate </span><span class="token number" style="color:#36acaa">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># set the can bus Up and active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># check recieved messages with candump</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">candump can0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># make automatic start of the interface on boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/network/interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto lo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iface lo inet loopback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto can0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iface can0 inet manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    up /sbin/ip </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 up </span><span class="token builtin class-name">type</span><span class="token plain"> can bitrate </span><span class="token number" style="color:#36acaa">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    down /sbin/ip </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="end-result">End Result<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#end-result" class="hash-link" aria-label="Direct link to End Result" title="Direct link to End Result">​</a></h2>
<p>After successful build and upload, login the Luckfox and type <code>dmesg | grep mcp</code>, you should see something similar:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.165740</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0: setup mode </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> bits/w, </span><span class="token number" style="color:#36acaa">4000000</span><span class="token plain"> Hz max --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.165812</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0: can_rx_offload_init_queue: </span><span class="token assign-left variable" style="color:#36acaa">skb_queue_len_max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.172937</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0 can0: MCP2518FD rev0.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">-RX_INT </span><span class="token parameter variable" style="color:#36acaa">-MAB_NO_WARN</span><span class="token plain"> +CRC_REG +CRC_RX +CRC_TX +ECC </span><span class="token parameter variable" style="color:#36acaa">-HD</span><span class="token plain"> c:40.00MHz m:4.00MHz r:4.00MHz e:0.00MHz</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> successfully initialized.</span><br></span></code></pre></div></div>
<p>This is okay and the can chip has been initialized</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="https://kolevbm.github.io/blog/luckfox%20rv1106g%20canbus%20mcp2518fd#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://forums.luckfox.com/viewtopic.php?p=4290&amp;hilit=mcp2515#p4290" target="_blank" rel="noopener noreferrer">Luckfox Forum</a><br>
<a href="https://www.devicetree.org/specifications" target="_blank" rel="noopener noreferrer">DeviceTree.org</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106-luckfox-pico-ultra-ipc.dtsi" target="_blank" rel="noopener noreferrer">rv1106-luckfox-pico-ultra-ipc.dtsi</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106g-luckfox-pico-ultra-w.dts" target="_blank" rel="noopener noreferrer">rv1106g-luckfox-pico-ultra-w.dts</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/include/dt-bindings/interrupt-controller/irq.h" target="_blank" rel="noopener noreferrer">irq.h</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/media/sysutils/include/rk_gpio.h" target="_blank" rel="noopener noreferrer">rk_gpio.h</a><br>
<a href="https://notes.rdu.im/system/linux/canbus/" target="_blank" rel="noopener noreferrer">Ruixiang's Notes</a></p>]]></content:encoded>
            <category>luckfox</category>
            <category>buildroot</category>
            <category>can</category>
            <category>canbus</category>
            <category>kernel</category>
            <category>dts</category>
            <category>mcp251xfd</category>
            <category>mcp2518fd</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[Егото е Врагът - Райън Холидей, избрани откъси]]></title>
            <link>https://kolevbm.github.io/blog/ego-is-the-enemy</link>
            <guid>https://kolevbm.github.io/blog/ego-is-the-enemy</guid>
            <pubDate>Mon, 24 Feb 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Егото е врагът, избрани откъси от книгата на Райън Холидей.]]></description>
            <content:encoded><![CDATA[<p>Егото е врагът, избрани откъси от книгата на Райън Холидей.</p>
<blockquote>
<p>Ако не си даваме точна сметка за това какви са собствените ни способности в сравнение с тези на другите, нашата самоувереност не е нищо друго, освен самоизмама.
Как ще стигнем до другите хора, как ще ги мотивираме или ръководим, ако не можем да осъзнаем какви са техните нужди - защото сме загубили връзка със себе си?</p>
</blockquote>
<blockquote>
<p>Егото заменя рационалните и осъзнати части от нашата психика със самохвалство и нарцисизъм и ни казва онова, което желаем да чуем, тогава, когато искаме да го чуем.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="стремежът">Стремежът<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D1%81%D1%82%D1%80%D0%B5%D0%BC%D0%B5%D0%B6%D1%8A%D1%82" class="hash-link" aria-label="Direct link to Стремежът" title="Direct link to Стремежът">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="към-каквото-и-да-се-стремите-егото-е-вашият-враг">Към каквото и да се стремите, егото е вашият враг<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D0%BA%D1%8A%D0%BC-%D0%BA%D0%B0%D0%BA%D0%B2%D0%BE%D1%82%D0%BE-%D0%B8-%D0%B4%D0%B0-%D1%81%D0%B5-%D1%81%D1%82%D1%80%D0%B5%D0%BC%D0%B8%D1%82%D0%B5-%D0%B5%D0%B3%D0%BE%D1%82%D0%BE-%D0%B5-%D0%B2%D0%B0%D1%88%D0%B8%D1%8F%D1%82-%D0%B2%D1%80%D0%B0%D0%B3" class="hash-link" aria-label="Direct link to Към каквото и да се стремите, егото е вашият враг" title="Direct link to Към каквото и да се стремите, егото е вашият враг">​</a></h3>
<blockquote>
<p>Изократ към Демоник:
Упражнявай се в самоконтрол, за да не изпадаш във властта на узбухливостта, удоволствията и болката.
Отвращавай се от ласкателите така, както би се отвращавал от измамниците, защото и едните и другите, довери ли им се човек, нанасят вреда на озни, който ум се доверява.</p>
</blockquote>
<blockquote>
<p>Надменността и нарцисизмът пречат на растежа. Също толкова вредни за него са фантазиите и "проблясъците".
Да се упражнявате в това - да гледате на себе си от известно разстояние, да развивате в себе си способността да се откъсвате от собствените си мисли.
Лесно е да изпаднете в емоционална привързаност и заслепение от работата си.</p>
</blockquote>
<blockquote>
<p>За да имате вяра в своята работа, тази вяра трябва да се базира на истина.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="думи-думи-думи">Думи, думи, думи<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D0%B4%D1%83%D0%BC%D0%B8-%D0%B4%D1%83%D0%BC%D0%B8-%D0%B4%D1%83%D0%BC%D0%B8" class="hash-link" aria-label="Direct link to Думи, думи, думи" title="Direct link to Думи, думи, думи">​</a></h3>
<blockquote>
<p>Стратегическта гъвкавост не е единственото предимство на мълчнието, докато другите приказват. Тя е и психология. Хезоид е казал <strong>"Най-голямото съкровище на човека е пестеливият език"</strong>.</p>
</blockquote>
<blockquote>
<p>Те работят тихо в ъгъла. Превръщат вътрешното си безпокойство в продукт - и поинякога в спокойствие. Пренебрегват порива да търсят признание преди да действат. Не говорят много.
Когато наистина говорят то е заслужено.</p>
</blockquote>
<blockquote>
<p>Единствената връзка между работата и празното приказване е, че второто убива първото.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="не-бъди-страстен">Не бъди страстен<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D0%BD%D0%B5-%D0%B1%D1%8A%D0%B4%D0%B8-%D1%81%D1%82%D1%80%D0%B0%D1%81%D1%82%D0%B5%D0%BD" class="hash-link" aria-label="Direct link to Не бъди страстен" title="Direct link to Не бъди страстен">​</a></h3>
<blockquote>
<p>Как може човек да се труди и да не постига нишо? Ето това е парадоксът на страстта.</p>
</blockquote>
<blockquote>
<p>Целта, бихме могли да кажем, е страст, съчетана с граници. Реализмът е безпристрастност и перспектива.</p>
</blockquote>
<p>Гьоте: "Големите страсти са болести, за излекуването от които няма надежда". Ето защо разсъдливият, целеосъзнат човек действа на друго ниво, отвъд несигурността или болестта.</p>
<blockquote>
<p>Той наема професионалисти и ги използва. Задава въпроси, пита какво би могло да тръгне погрешно, търси примери. Предвижда появате на непредвидени обстоятелства. После започва да действа, с малки стъпки, завършва ги и търси обратна връзка.</p>
</blockquote>
<blockquote>
<p>Далеч по-добре е да сте уплашени от предстоящото - смирени от неговите мащаби и решени да го осъществите въпреки всичко.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="следвай-стратегията-на-платното">Следвай стратегията на платното<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D1%81%D0%BB%D0%B5%D0%B4%D0%B2%D0%B0%D0%B9-%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%B5%D0%B3%D0%B8%D1%8F%D1%82%D0%B0-%D0%BD%D0%B0-%D0%BF%D0%BB%D0%B0%D1%82%D0%BD%D0%BE%D1%82%D0%BE" class="hash-link" aria-label="Direct link to Следвай стратегията на платното" title="Direct link to Следвай стратегията на платното">​</a></h3>
<blockquote>
<p>Когато сме <strong>начинаещи</strong> можем да бъдем сигурни само за няколко основни факта:</p>
</blockquote>
<ol>
<li>изобщо не сме толкова добри или толкова важни, колкото си мислим</li>
<li>имаме нагласа, която трябва да се коригира</li>
<li>повечето от нещата, които мислим, че знаем или повечето от нещата, които сме научили от книгите или в училище, са остарели или са неверни</li>
</ol>
<blockquote>
<p>Ти си най-маловажният човек в стаята, докато не промениш това с резултатите си.</p>
</blockquote>
<p>Мислете за хората по следния начин:</p>
<blockquote>
<p>Какво мога да направя за него? И ако гледате на това по начин, който е изцяло от полза за него, а не за вас. Кумулативният ефект, който би имало това с времето, би бил значителен: бихте се научили до голяма степен да решавате различни проблеми. Бихте имали репутация на крайно необходим човек. Бихте имали безброй нови контакти. Бихте имали огромен брой доброжелатели.</p>
</blockquote>
<blockquote>
<p>Стратегията е най-трудната част. Лесно е да бъдеш озлобен като Марциал. Да мразиш дори самата мисъл за подлизурство. Да презираш онези които имат повече средства, повече опит или по-високо обществено положение от теб. Да си казваш, че всяка секунда, която не изразходваш във вършене на своята работа
или в работа по себе си, е пилеене на твоето дарование. Да настояваш: "Няма да се унижа до такава степен".
Щом се преборим с тоя емоционален и егоистичен импулс, стратегията на платното е ленса. Нейните варианти са безкрайни.
Открийте благоприятни възможности, за да рекламирате техния талант, намирайте канали и хора, с които да сътрудничите, и премахвайте отвличащите предмети, които пречат на техния напредък и фокус. Премислете всяка инвестиция в контактите си и в собственото си развитие.</p>
</blockquote>
<blockquote>
<p>ако повдитнете това наметало, ще видите онова, което егото на повечето хора им пречи да оценят: човека, който разчиства пътя, в крайна сметка контролира неговата посока, точно както платното е основата на картината.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="въздържай-се">Въздържай се<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D0%B2%D1%8A%D0%B7%D0%B4%D1%8A%D1%80%D0%B6%D0%B0%D0%B9-%D1%81%D0%B5" class="hash-link" aria-label="Direct link to Въздържай се" title="Direct link to Въздържай се">​</a></h3>
<blockquote>
<p>Спокойно подминете обидата и се трудете още по-усилено. Играйте си играта. Не обръщайте внимание на шума; за бога, не позволявайте да ви отвличат. Самообладанието е трудно, ала изключителноважно умение.
Често ще се изкушавате, вероятно дори няма да издържите. Никой не е съвършен, но трябва да се опитваме.</p>
</blockquote>
<blockquote>
<p>Робинсън не е лишен от страст, ала той рано научава, че опънатото въже, по което върви, ще понесе само самообладанието и че то не прощава на егото.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="опасността-от-ранното-възгордяване">Опасността от ранното възгордяване<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%82%D0%B0-%D0%BE%D1%82-%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D1%82%D0%BE-%D0%B2%D1%8A%D0%B7%D0%B3%D0%BE%D1%80%D0%B4%D1%8F%D0%B2%D0%B0%D0%BD%D0%B5" class="hash-link" aria-label="Direct link to Опасността от ранното възгордяване" title="Direct link to Опасността от ранното възгордя�ване">​</a></h3>
<p>Малкият принц: "Суетните хора никога не чуват нищо дрдуго , освен похвалите"</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="труд-труд-труд">Труд, труд, труд<a href="https://kolevbm.github.io/blog/ego-is-the-enemy#%D1%82%D1%80%D1%83%D0%B4-%D1%82%D1%80%D1%83%D0%B4-%D1%82%D1%80%D1%83%D0%B4" class="hash-link" aria-label="Direct link to Труд, труд, труд" title="Direct link to Труд, труд, труд">​</a></h3>
<p>Питър Дракъд</p>
<blockquote>
<p>И най-добрият план е само добри намерения, ако не се приведе в дело.</p>
</blockquote>
<blockquote>
<p>Не можеш да си изградиш репутация с намерението какво смяташ да направиш.</p>
</blockquote>
<p>Бен Хоровиц</p>
<blockquote>
<p>"Трудното не е да си поставиш голяма, рискована, смела цел. Трудното е да уволняваш хора, когато не постигнеш голямата си цел... Трудното не е да имаш голяма мечта. Трудното е да се събуждаш нощем облян от студена пот, когато мечтата ти се превърне в кошмар."</p>
</blockquote>
<blockquote>
<p>Дарвин, работи десетилетия по своята теория на еволюцията, като се въздържа да я побликува, защото още не е завършена.</p>
</blockquote>]]></content:encoded>
            <category>финанси</category>
            <category>литература</category>
            <category>его</category>
            <category>non-technical</category>
        </item>
        <item>
            <title><![CDATA[Docker compose for Firefly III with WireGuard VPN client]]></title>
            <link>https://kolevbm.github.io/blog/docker-wg-firefly-iii</link>
            <guid>https://kolevbm.github.io/blog/docker-wg-firefly-iii</guid>
            <pubDate>Tue, 31 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Записах си firefly-iii в docker контейнер на локален сървър Raspberry Pi5, но исках да имам достъп до приложението навсякъде, а не само в домашната мрежа.]]></description>
            <content:encoded><![CDATA[<p>Записах си <a href="https://www.firefly-iii.org/" target="_blank" rel="noopener noreferrer">firefly-iii</a> в docker контейнер на локален сървър Raspberry Pi5, но исках да имам достъп до приложението навсякъде, а не само в домашната мрежа.
За целта направих docker-compose файл, който:</p>
<ul>
<li>създава контейнер с <a href="https://www.firefly-iii.org/" target="_blank" rel="noopener noreferrer">firefly-iii</a> и другите необходими за него контейнери</li>
<li>създава контейнер с <a href="https://github.com/linuxserver/docker-wireguard" target="_blank" rel="noopener noreferrer">linuxserver/wireguard</a> VPN настроен като клиент, който се свързва към личен wireguard VPN сървър инсталиран на Mikrotik рутер в друга мрежа със статичен публичен адрес.</li>
<li>свързва контейнерите в обща изолирана мрежа със статични IP адреси.</li>
<li>пренасочване на портове от VPN контейнера към контейнера с <em>firefly-iii</em>.</li>
</ul>
<p>Но разбира се това не беше достатъчно, за да имам връзка към <em>firefly-iii</em> извън локална мрежа в дома ми.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wireguard-vpn">WireGuard VPN<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#wireguard-vpn" class="hash-link" aria-label="Direct link to WireGuard VPN" title="Direct link to WireGuard VPN">​</a></h2>
<p>За целта трябваше да се направят пренасочвания на портове в контейнера с <em>wireguard</em>. Тези пренасочвания лесно могат да се добавят и през
конфигурационния файл <code>wg0.conf</code> чрез <code>PostUp</code> и <code>PostDown</code> команди.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="стъпка-1-генериране-на-ключове-за-wireguard-контейнера">Стъпка 1 генериране на ключове за <em>wireguard</em> контейнера<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#%D1%81%D1%82%D1%8A%D0%BF%D0%BA%D0%B0-1-%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B8%D1%80%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BA%D0%BB%D1%8E%D1%87%D0%BE%D0%B2%D0%B5-%D0%B7%D0%B0-wireguard-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0" class="hash-link" aria-label="Direct link to стъпка-1-генериране-на-ключове-за-wireguard-контейнера" title="Direct link to стъпка-1-генериране-на-ключове-за-wireguard-контейнера">​</a></h3>
<p>За <code>linux</code> дистрибуции, които са с <code>kernel</code> версия <code>5.6+</code> може да се използва <code>wireguard</code> модула, който е включен в ядрото по подразбиране. Няма нужда от инсталиране на <code>wireguard-tools</code> или други пакети.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Generate keys for wireguard container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> wg genkey </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> privatekey </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> wg pubkey </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> publickey</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>тези файлове трябва да са в директорията <code>./config</code> която после ще се мапне към контейнера с <em>wireguard</em></p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The tee command in Linux reads input from standard input (stdin) and writes it to both standard output (stdout) and one or more specified files. It essentially "splits" the output, allowing it to be displayed on the terminal and saved to a file simultaneously.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="стъпка-11--задаване-на-права-за-private-key-файла">Стъпка 1.1  задаване на права за private key файла<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#%D1%81%D1%82%D1%8A%D0%BF%D0%BA%D0%B0-11--%D0%B7%D0%B0%D0%B4%D0%B0%D0%B2%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BF%D1%80%D0%B0%D0%B2%D0%B0-%D0%B7%D0%B0-private-key-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0" class="hash-link" aria-label="Direct link to Стъпка 1.1  задаване на права за private key файла" title="Direct link to Стъпка 1.1  задаване на права за private key файла">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Set permissions for the private key file</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> privatekey</span><br></span></code></pre></div></div>
<p>4+2 = 6 (read and write for the owner)
0 (no permissions for the group)
0 (no permissions for others)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="стъпка-2-създаване-на-конфигурационен-файл-за-wireguard-контейнера">Стъпка 2 създаване на конфигурационен файл за <em>wireguard</em> контейнера<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#%D1%81%D1%82%D1%8A%D0%BF%D0%BA%D0%B0-2-%D1%81%D1%8A%D0%B7%D0%B4%D0%B0%D0%B2%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B5%D0%BD-%D1%84%D0%B0%D0%B9%D0%BB-%D0%B7%D0%B0-wireguard-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0" class="hash-link" aria-label="Direct link to стъпка-2-създаване-на-конфигурационен-файл-за-wireguard-контейнера" title="Direct link to стъпка-2-създаване-на-конфигурационен-файл-за-wireguard-контейнера">​</a></h3>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">wg0.conf</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Interface]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PrivateKey = &lt;container_private_key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Address = 192.168.100.4/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS = 192.168.100.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PostUp = iptables -t nat -A PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PostDown = iptables -t nat -D PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Peer]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PublicKey = &lt;server_public_key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AllowedIPs = 0.0.0.0/0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endpoint = &lt;server_ip&gt;:&lt;server_port&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PersistentKeepalive = 50</span><br></span></code></pre></div></div>
<ul>
<li>в случая пренасочваме 192.168.100.4:80 <em>wireguard</em> (wg0_interfece) към 192.168.200.4:8080 <em>firefly-iii</em>:
<code>iptables -t nat -A PREROUTING -i %i -p tcp --dport 80 -j DNAT --to-destination 192.168.200.4:8080</code></li>
<li>след това маскираме пакетите, които преминават през интерфейса <code>eth0</code> на контейнера с <em>wireguard</em>:
<code>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></li>
</ul>
<blockquote>
<p>използваме <code>%i</code> за името на интерфейса, което ще бъде заменено автоматично от <em>wireguard</em>.</p>
</blockquote>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>трябва да се добави в <code>/etc/sysctl.conf</code>:
<code>net.ipv4.ip_forward=1</code> за да позвволим пренасочването на портове, в случая това се прави в <code>docker-compose</code> файлa</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="стъпка-3-добавяне-на-нов-пиър-peer-към-wireguard-сървъра">Стъпка 3 добавяне на нов пиър peer към <em>wireguard</em> сървъра<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#%D1%81%D1%82%D1%8A%D0%BF%D0%BA%D0%B0-3-%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D1%8F%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BD%D0%BE%D0%B2-%D0%BF%D0%B8%D1%8A%D1%80-peer-%D0%BA%D1%8A%D0%BC-wireguard-%D1%81%D1%8A%D1%80%D0%B2%D1%8A%D1%80%D0%B0" class="hash-link" aria-label="Direct link to стъпка-3-добавяне-на-нов-пиър-peer-към-wireguard-сървъра" title="Direct link to стъпка-3-добавяне-на-нов-пиър-peer-към-wireguard-сървъра">​</a></h3>
<p>Тези настройки в моя случай са през микотрик рутера, които няма да описвам. Тук можете да намерите информация за това как се прави: <a href="https://help.mikrotik.com/docs/spaces/ROS/pages/69664792/WireGuard" target="_blank" rel="noopener noreferrer">WireGuard VPN Server on MikroTik</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="стъпка-4-стартиране-на-wireguard-тестови-контейнер">Стъпка 4 стартиране на <em>wireguard</em> тестови контейнер<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#%D1%81%D1%82%D1%8A%D0%BF%D0%BA%D0%B0-4-%D1%81%D1%82%D0%B0%D1%80%D1%82%D0%B8%D1%80%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-wireguard-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2%D0%B8-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80" class="hash-link" aria-label="Direct link to стъпка-4-стартиране-на-wireguard-тестови-контейнер" title="Direct link to стъпка-4-стартиране-на-wireguard-тестови-контейнер">​</a></h3>
<p>Целта на тази стъпка е да се тества дали <em>wireguard</em> контейнера може да се свърже към <em>wireguard</em> сървъра.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">wg-test-compose.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">wireguard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lscr.io/linuxserver/wireguard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest         </span><span class="token comment" style="color:#999988;font-style:italic">#should retrieve the correct image for your arch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wireguard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cap_add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> NET_ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_MODULE </span><span class="token comment" style="color:#999988;font-style:italic">#optional Some hosts may not load the iptables kernel modules by default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PUID=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PGID=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Etc/UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- SERVERURL=wireguard.domain.com #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- SERVERPORT=51820 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PEERS=1 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PEERDNS=auto #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- INTERNAL_SUBNET=10.13.13.0 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- ALLOWEDIPS=0.0.0.0/0 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PERSISTENTKEEPALIVE_PEERS= #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> LOG_CONFS=true </span><span class="token comment" style="color:#999988;font-style:italic">#optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /lib/modules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/lib/modules </span><span class="token comment" style="color:#999988;font-style:italic">#optional if SYS_MODULE is set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 51820</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">51820/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sysctls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> net.ipv4.conf.all.src_valid_mark=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> net.ipv4.ip_forward=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>може да стартираме контейнера с
<code>docker compose -f wg-test-compose.yml up </code></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>при успешно стартиран контейнер може да влезете в него с <code>docker exec -it wireguard /bin/bash</code> и да пингнете wireguard сървъра с <code>ping &lt;server_ip&gt;</code>  или друга машина в мрежата на сървъра.</p></div></div>
<p>след като всичко работи може да изтриете контейнера с <code>docker compose -f wg-test-compose.yml down</code> и да преминете към следващия етап</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose">Docker compose<a href="https://kolevbm.github.io/blog/docker-wg-firefly-iii#docker-compose" class="hash-link" aria-label="Direct link to Docker compose" title="Direct link to Docker compose">​</a></h2>
<p>За допълнителна информация как се настройва <em>firefly-iii</em> в docker контейнер може да прочетете тук: <a href="https://docs.firefly-iii.org/how-to/firefly-iii/installation/docker/" target="_blank" rel="noopener noreferrer">Firefly III Docker</a></p>
<p>Целият docker-compose файл изглежда така:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">docker-compose.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">wireguard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lscr.io/linuxserver/wireguard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest         </span><span class="token comment" style="color:#999988;font-style:italic">#should retrieve the correct image for your arch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wireguard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wg_network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ipv4_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.200.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cap_add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> NET_ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_MODULE </span><span class="token comment" style="color:#999988;font-style:italic">#optional Some hosts may not load the iptables kernel modules by default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PUID=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PGID=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TZ=Etc/UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- SERVERURL=wireguard.domain.com #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- SERVERPORT=51820 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PEERS=1 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PEERDNS=auto #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- INTERNAL_SUBNET=10.13.13.0 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- ALLOWEDIPS=0.0.0.0/0 #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#- PERSISTENTKEEPALIVE_PEERS= #optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> LOG_CONFS=true </span><span class="token comment" style="color:#999988;font-style:italic">#optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /lib/modules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/lib/modules </span><span class="token comment" style="color:#999988;font-style:italic">#optional if SYS_MODULE is set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 51820</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">51820/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sysctls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> net.ipv4.conf.all.src_valid_mark=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> net.ipv4.ip_forward=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fireflyiii/core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> firefly_iii_core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> firefly_iii_upload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/www/html/storage/upload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wg_network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ipv4_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.200.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 85</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mariadb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">lts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> firefly_iii_db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .db.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wg_network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ipv4_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.200.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> firefly_iii_db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cron</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># To make this work, set STATIC_CRON_TOKEN in your .env file or as an environment variable and replace REPLACEME below</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The STATIC_CRON_TOKEN must be *exactly* 32 characters long</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> firefly_iii_cron</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sh </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c "echo \"0 3 * * * wget </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">qO</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/api/v1/cron/REPLACEME;echo\" </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> crontab </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token important">&amp;&amp;</span><span class="token plain"> crond </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">L /dev/stdout"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wg_network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ipv4_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.200.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">firefly_iii_upload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">firefly_iii_db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">wg_network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bridge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ipam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">subnet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.200.0/24</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>docker</category>
            <category>finance</category>
            <category>firefly</category>
            <category>wg</category>
            <category>wireguard</category>
        </item>
        <item>
            <title><![CDATA[Regex MDbus LOG file with node.js]]></title>
            <link>https://kolevbm.github.io/blog/regex</link>
            <guid>https://kolevbm.github.io/blog/regex</guid>
            <pubDate>Tue, 24 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Open a file, perform regex and generate output file]]></description>
            <content:encoded><![CDATA[<p>Open a file, perform regex and generate output file</p>
<p>Create a <code>*.js</code> file dor exapmle <code>formatter.js</code> , <em>formatter</em> because this will format <a href="https://kolevbm.github.io/assets/files/beckhoff-5a730f6ca0705fd7acef3cb36c3e065e.LOG" target="_blank">beckhoff.log</a> file from MDBus session to our needs.</p>
<ul>
<li>will filter for slaveID 01 and func type 03 with <code>pattern1</code>, will add new line <code>\n</code> and carriage return <code>\r</code> before the first match group <code>$1</code>, which is (<code>pattern1</code>)</li>
<li>will remove the date/time stamp on <code>pattern2</code>,</li>
<li>additional formatting with the 3rd pattern</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">formatter.js</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"fs"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Function to process the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">processFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">inputFile</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> outputFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Read the input file as a string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"utf8"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Error reading the input file:"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Find the pattern "01 03 " and ensure a newline before each occurrence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pattern1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"01 03 "</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pattern2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{2}</span><span class="token regex regex-source language-regex" style="color:#36acaa"> </span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{2}</span><span class="token regex regex-source language-regex" style="color:#36acaa">:</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{2}</span><span class="token regex regex-source language-regex" style="color:#36acaa">:</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{2}</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\.</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{3}</span><span class="token regex regex-source language-regex" style="color:#36acaa"> B</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> modifiedData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pattern2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RegExp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">pattern1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">)</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"g"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n\r$1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex escape" style="color:#36acaa">\n</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">{2}</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Write the modified content to output.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outputFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> modifiedData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"utf8"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Error writing the output file:"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">File processed successfully. Check the output at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">outputFile</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Specify input and output file paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> inputFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"beckhoff.log"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> outputFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"output.txt"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Process the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">processFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outputFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>To run the code make sure <code>beckhoff.log</code> is in the same folder and type in the terminal:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">node formatter.js</span><br></span></code></pre></div></div>
<p>this will run the app and generate a text file <code>output.txt</code> with formatted data</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-explanation">Additional Explanation:<a href="https://kolevbm.github.io/blog/regex#additional-explanation" class="hash-link" aria-label="Direct link to Additional Explanation:" title="Direct link to Additional Explanation:">​</a></h2>
<p><em><strong>From ChatGPT:</strong></em></p>
<p>The expression <code>\n\r$1</code> is commonly used in the context of a replace operation with regular expressions. Here's what it means:</p>
<p><code>\n\r</code>: This represents a combination of newline (\n) and carriage return (\r), which is often used to create a new line or start a new paragraph in some operating systems (like Windows).</p>
<p><code>\n</code>: Newline character (moves the cursor to the next line).<br>
<code>\r</code>: Carriage return (moves the cursor to the beginning of the line).<br>
<code>$1</code>: In regular expressions, $1 refers to the first captured group from a matching pattern.</p>
<p>When you use parentheses () in a regular expression, whatever is matched inside those parentheses is stored as a "capture group."
<code>$1</code> is a placeholder for the content of the first capturing group, i.e., whatever was matched by the first set of parentheses in the regex.</p>
<p>const regex = /(\d+)/g;
const str = "12345";
const result = str.replace(regex, '\n\r$1');
console.log(result);</p>
<p>Explanation:</p>
<p>Pattern <code>(\d+)</code>: Captures one or more digits (e.g., 12345).
Replacement <code>\n\r$1</code>: Adds a newline and carriage return before the matched digits (which is captured as <code>$1</code>).</p>]]></content:encoded>
            <category>regex</category>
            <category>node</category>
            <category>javascript</category>
            <category>modbus</category>
        </item>
    </channel>
</rss>