<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Running can bus on embedded linux - Luckfox Pico Ultra rv1106g | BK`s notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kolevbm.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kolevbm.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Running can bus on embedded linux - Luckfox Pico Ultra rv1106g | BK`s notes"><meta data-rh="true" name="description" content="Table of Contents:"><meta data-rh="true" property="og:description" content="Table of Contents:"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-11-27T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="luckfox,buildroot,can,canbus,kernel,dts,mcp251xfd,mcp2518fd,linux"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd"><link data-rh="true" rel="alternate" href="https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd" hreflang="en"><link data-rh="true" rel="alternate" href="https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd","mainEntityOfPage":"https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd","url":"https://kolevbm.github.io/blog/luckfox rv1106g canbus mcp2518fd","headline":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","name":"Running can bus on embedded linux - Luckfox Pico Ultra rv1106g","description":"Table of Contents:","datePublished":"2025-11-27T00:00:00.000Z","author":{"@type":"Person","name":"Boris Kolev","description":"owner"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://kolevbm.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BK`s notes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BK`s notes Atom Feed">




<link rel="icon" href="/img/docusaurus.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)"><link rel="stylesheet" href="/assets/css/styles.85c29ba8.css">
<script src="/assets/js/runtime~main.d6dd9668.js" defer="defer"></script>
<script src="/assets/js/main.6f445780.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Notes</b></a><a class="navbar__item navbar__link" href="/docs/espressif/Intro">Espressif</a><a class="navbar__item navbar__link" href="/docs/linux/folder_structure">Linux</a><a class="navbar__item navbar__link" href="/docs/mikrotik/dhcp-server/">MikroTik</a><a class="navbar__item navbar__link" href="/docs/docker/docker_basics">Docker</a><a class="navbar__item navbar__link" href="/docs/regEx/">RegEx</a><a class="navbar__item navbar__link" href="/docs/nvidia/kernel">Nvidia</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/luckfox rv1106g canbus mcp2518fd">Running can bus on embedded linux - Luckfox Pico Ultra rv1106g</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ego-is-the-enemy">Егото е Врагът - Райън Холидей, избрани откъси</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/docker-wg-firefly-iii">Docker compose for Firefly III with WireGuard VPN client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/regex">Regex MDbus LOG file with node.js</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Running can bus on embedded linux - Luckfox Pico Ultra rv1106g</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-11-27T00:00:00.000Z">November 27, 2025</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp" translate="no">Boris Kolev</span></div><small class="authorTitle_nd0D" title="owner">owner</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><strong>Table of Contents:</strong></p>
<ul>
<li class=""><a href="#lab-setup" class="">Lab setup</a></li>
<li class=""><a href="#buildroot" class="">Buildroot</a>
<ul>
<li class=""><a href="#add-the-packages-in-buildroot" class="">Add the packages in buildroot</a></li>
</ul>
</li>
<li class=""><a href="#kernel-config" class="">Kernel config</a>
<ul>
<li class=""><a href="#configuring-the-kernel" class="">Configuring the Kernel</a></li>
<li class=""><a href="#device-tree" class="">Device Tree</a>
<ul>
<li class=""><a href="#1-modify-the-dts" class="">1. Modify the <code>dts</code></a></li>
<li class=""><a href="#2-modify-the-dtsi" class="">2. Modify the <code>.dtsi</code></a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#final-preparation" class="">Final preparation</a></li>
<li class=""><a href="#end-result" class="">End Result</a></li>
<li class=""><a href="#references" class="">References</a></li>
</ul>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="lab-setup">Lab setup<a href="#lab-setup" class="hash-link" aria-label="Direct link to Lab setup" title="Direct link to Lab setup" translate="no">​</a></h2>
<p>The SBC <em>luckfox-pico-ultra</em> is mounted on a custom made motherboard with some external peripherals such as can bus and isolated rs-485</p>
<p>SBC: <a href="https://www.luckfox.com/Luckfox-Pico/EN-Luckfox-Pico-Ultra" target="_blank" rel="noopener noreferrer" class="">Luckfox Pico Ultra W rv1106g 8GB</a><br>
<!-- -->Custom motherboard: <a href="/assets/files/custom-motherboard-8b88d5035818191d3482460d593d54b0.pdf" target="_blank" class="">schematics</a></p>
<p>I am using the containerized Luckfox SDK docker image <code>luckfoxtech/luckfox_pico:1.0</code> for build environment.
As image flashing tool: <code>SOC Toolkit</code> for Windows. The whole system image flashing procedure is well documented in the <a href="https://wiki.luckfox.com/Luckfox-Pico-Ultra/Flash-image" target="_blank" rel="noopener noreferrer" class="">official wiki</a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="buildroot">Buildroot<a href="#buildroot" class="hash-link" aria-label="Direct link to Buildroot" title="Direct link to Buildroot" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-the-packages-in-buildroot">Add the packages in buildroot<a href="#add-the-packages-in-buildroot" class="hash-link" aria-label="Direct link to Add the packages in buildroot" title="Direct link to Add the packages in buildroot" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. can-utils</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. iproute2</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><strong>can-utils</strong> includes <code>candump</code>, <code>cansend</code>, <code>cansniffer</code> etc</p><div style="width:100"><img decoding="async" loading="lazy" alt="packages-1" src="/assets/images/packages-01-3826990006abc127ebcc2fa125c04bb9.png" width="746" height="576" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>iproute2</strong> is the Linux networking toolkit that replaced net-tools (ifconfig, route, arp etc.)<br>
<a href="https://paulgorman.org/technical/linux-iproute2-cheatsheet.html" target="_blank" rel="noopener noreferrer" class="">iproute2 cheatsheet</a></p><div style="width:80"><img decoding="async" loading="lazy" alt="packages-2" src="/assets/images/packages-02-8eb1c128005216d952c5c1b6f2cfd0d3.png" width="736" height="588" class="img_ev3q"></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="kernel-config">Kernel config<a href="#kernel-config" class="hash-link" aria-label="Direct link to Kernel config" title="Direct link to Kernel config" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-the-kernel">Configuring the Kernel<a href="#configuring-the-kernel" class="hash-link" aria-label="Direct link to Configuring the Kernel" title="Direct link to Configuring the Kernel" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. Set a local version</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. Enable the SPI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3. Enable CAN-SPI driver</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>It is good to set the kernel a local version name, so you can later check what is the kernel image on the SBC with <code>uname</code></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">General Setup ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ()Local version - append to kernel release</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="/assets/images/kernel-local-version-ab1466021b3a222ec519b56950135aff.png" width="740" height="591" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [*] SPI support</span><br></span></code></pre></div></div><p></p><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="/assets/images/kernel-spi-support-124d68ae0461a59ddc6cdd94082901e5.png" width="742" height="589" class="img_ev3q"></div>
It is also helpful to enable the Debug support for SPI drivers, one menu deep inside SPI support<p></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  Networking support ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CAN bus subsystem support ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CAN Device Drivers ---&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CAN SPI interfaces ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;*&gt; Microchip MCP251xFD SPI CAN controllers</span><br></span></code></pre></div></div><div style="width:50"><img decoding="async" loading="lazy" alt="kernel-local-version" src="/assets/images/kernel-can-drivers-01-3788877007555cf49e30b2af1dc357e9.png" width="743" height="592" class="img_ev3q"></div><div style="width:100"><img decoding="async" loading="lazy" alt="kernel-local-version" src="/assets/images/kernel-can-drivers-02-c1179bc98222e6b9d046db02cf06bd9a.png" width="737" height="589" class="img_ev3q"></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="device-tree">Device Tree<a href="#device-tree" class="hash-link" aria-label="Direct link to Device Tree" title="Direct link to Device Tree" translate="no">​</a></h3>
<p>According to Luckfox:</p>
<blockquote>
<p>For Luckfox Pico, the basic device tree configurations related to the RV1103 / RV1106 chips—such as rv1106.dtsi, rv1106-pinctrl.dtsi, etc.—are provided by Rockchip. Based on the hardware resources available on the Luckfox Pico, the default configurations are set in .dtsi files, while model-specific hardware information is defined in .dts files.</p>
<ul>
<li class="">The configurations in .dts files have the highest priority and can override settings in the .dtsi files. You can reference nodes from .dtsi and either modify their properties or recreate them entirely.</li>
<li class="">For easier editing, the .dts file corresponding to the selected board support package is symlinked to <code>&lt;luckfox-pico SDK&gt;/config/dts_config</code> after running ./build.sh. Normally, you only need to edit the .dts file to configure hardware features—.dtsi files should not be modified.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="dts-tree" src="/assets/images/dts-01-b198b812875286b48f2211d30e32ce93.png" width="503" height="372" class="img_ev3q"></p>
</blockquote>
<p>The <code>dts</code> files are located under <code>&lt;SDK-folder&gt;/sysdrv/source/kernel/arch/arm/boot/dts</code> the ones that we need are named as follows:</p>
<table><thead><tr><th style="text-align:center">sbc</th><th style="text-align:center">.dts</th><th style="text-align:center">.dtsi</th></tr></thead><tbody><tr><td style="text-align:center">Luckfox Pico ultra W</td><td style="text-align:center">rv1106g-luckfox-pico-ultra-w.dts</td><td style="text-align:center">rv1106-luckfox-pico-ultra-ipc.dtsi</td></tr></tbody></table>
<p><a href="https://wiki.luckfox.com/Luckfox-Pico-Ultra/Device-Tree" target="_blank" rel="noopener noreferrer" class="">(check here for others)</a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-modify-the-dts">1. Modify the <code>dts</code><a href="#1-modify-the-dts" class="hash-link" aria-label="Direct link to 1-modify-the-dts" title="Direct link to 1-modify-the-dts" translate="no">​</a></h4>
<p>In the <code>.dts</code> file you can see that I have removed a lot of things for the sake of simplicity and the lab itself (running the CAN). The missing parts are mainly regarding the <code>BT</code> and <code>SDIO-WIFI</code></p>
<ul>
<li class="">modified: <a href="/assets/files/rv1106g-luckfox-pico-ultra-w-modified-5547854a40c65cd809838b71b2a4125d.dts" target="_blank" class="">rv1106g-luckfox-pico-ultra-w.dts</a></li>
<li class="">original: <a href="/assets/files/rv1106g-luckfox-pico-ultra-w-2d1daddd9501df79a5c9e4f72f306fdd.dts" target="_blank" class="">rv1106g-luckfox-pico-ultra-w.dts</a></li>
</ul>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1. Modified dts</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2. clock frequency</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">3. interrupts</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// SPDX-License-Identifier: (GPL-2.0+ OR MIT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* Copyright (c) 2022 Rockchip Electronics Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dts</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v1</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;rv1106.dtsi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;rv1106-luckfox-pico-ultra-ipc.dtsi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/input/input.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/display/media-bus-format.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clk_mcp251xfd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp251xfd </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fixed-clock&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">40000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**********SPI**********/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;microchip,mcp251xfd&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">4000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                interrupts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">RK_PC6 IRQ_TYPE_LEVEL_LOW</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                interrupt</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">gpio1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clocks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">names </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mcp251xfd&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                vdd</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                xceiver</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>here the <code>clock-frequency</code> must be the equal to the oscillator of the board used e.g. if the oscillator is 20MHz it should be 20000000 in our case we use 40MHz, otherwise it just won&#x27;t work</p><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp251xfd </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fixed-clock&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">40000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="mcp-oscillator" src="/assets/images/mcp-oscillator-a22079a5da0e6ab1ef69adfc46313d58.png" width="956" height="593" class="img_ev3q"></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>As pin for the interrupt we are using C6 from the luckfox board which should be configured as interrupt Input pin active on Low level</p><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106g-luckfox-pico-ultra-w.dts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**********SPI**********/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;microchip,mcp251xfd&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">4000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              interrupts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">RK_PC6 IRQ_TYPE_LEVEL_LOW</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              interrupt</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">gpio1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clocks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clk_mcp251xfd</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">names </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mcp251xfd&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              vdd</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              xceiver</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">supply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vcc_3v3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><br></span></code></pre></div></div><div style="width:100"><img decoding="async" loading="lazy" alt="dts-02" src="/assets/images/dts-02-7b2ac0d362596fb0c99af401578a1b7e.png" width="708" height="587" class="img_ev3q"></div><div style="width:100"><img decoding="async" loading="lazy" alt="dts-03" src="/assets/images/dts-03-ee2f18fc5c2a83c10a98d9012a146983.png" width="967" height="502" class="img_ev3q"></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-modify-the-dtsi">2. Modify the <code>.dtsi</code><a href="#2-modify-the-dtsi" class="hash-link" aria-label="Direct link to 2-modify-the-dtsi" title="Direct link to 2-modify-the-dtsi" translate="no">​</a></h4>
<p>Here I have removed <code>CSI</code>, <code>LCD/TP</code> and the things related to the RGB,
because some pins are needed for interrupt of the <code>mcp2518fd</code> chip.</p>
<p>You can compare them to see the full changes e.g. with WinMerge:</p>
<ul>
<li class="">modified <code>.dtsi</code> : <a href="/assets/files/rv1106-luckfox-pico-ultra-ipc-modified-756482bb1eeb081dbcb4358e5f364a63.dtsi" target="_blank" class="">rv1106-luckfox-pico-ultra-ipc.dtsi</a></li>
<li class="">original <code>.dtsi</code> : <a href="/assets/files/rv1106-luckfox-pico-ultra-ipc-3fe7d680a1df1b1ea17f217dd67e34cc.dtsi" target="_blank" class="">rv1106-luckfox-pico-ultra-ipc.dtsi</a></li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The configurations in .dts files have the highest priority and can override settings in the .dtsi files, so
the <code>clk_mcp2515</code> in the root node  and <code>&amp;spi0</code> are overwrited by the dts so their prop values are not applied.</p></div></div>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Modified dts</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">rv1106-luckfox-pico-ultra-ipc.dtsi</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// SPDX-License-Identifier: (GPL-2.0+ OR MIT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* Copyright (c) 2022 Rockchip Electronics Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;rv1106-evb.dtsi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/input/input.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/display/media-bus-format.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clk_mcp2515</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clk_mcp2515 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fixed-clock&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">clock</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">8000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// SPI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pinctrl</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_clk </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_miso </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_mosi </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">spi0m0_cs0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">address</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">1</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">size</span><span class="token macro property expression operator" style="color:#393A34">-</span><span class="token macro property expression" style="color:#36acaa">cells </span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token macro property expression punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spidev@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rockchip,spidev&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">max</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">50000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pinctrl </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spi0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_clk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">clk </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC1 </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_mosi</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mosi </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC2 </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_miso</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">miso </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC3 </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spi0m0_cs0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spi0m0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cs0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rockchip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> RK_PC0 </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pcfg_pull_none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="final-preparation">Final preparation<a href="#final-preparation" class="hash-link" aria-label="Direct link to Final preparation" title="Direct link to Final preparation" translate="no">​</a></h2>
<p>Build the image with the <code>SDK</code> and upload it with the <code>SOC toolkit</code></p>
<ul>
<li class="">Useful commands in host machine:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># attach to the container with the SDK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> attach </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># when inside the SDK folder to see options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh </span><span class="token builtin class-name">help</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># copy a file/folder from docker container to current directory </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">full-path-to-sdk</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/IMAGE/IPC_EMMC_BUILDROOT_RV1106_LUCKFOX_PICO_ULTRA_W_20251125.2257_RELEASE_TEST </span><span class="token builtin class-name">.</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class="">useful commands in embedded device:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># check kernel messages regarding mcp can or spi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">dmesg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mcp|can|spi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># prepare the can0 interface link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 </span><span class="token builtin class-name">type</span><span class="token plain"> can bitrate </span><span class="token number" style="color:#36acaa">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># set the can bus Up and active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># check recieved messages with candump</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">candump can0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># make automatic start of the interface on boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/network/interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto lo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iface lo inet loopback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto can0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iface can0 inet manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    up /sbin/ip </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 up </span><span class="token builtin class-name">type</span><span class="token plain"> can bitrate </span><span class="token number" style="color:#36acaa">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    down /sbin/ip </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> can0 down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="end-result">End Result<a href="#end-result" class="hash-link" aria-label="Direct link to End Result" title="Direct link to End Result" translate="no">​</a></h2>
<p>After successful build and upload, login the Luckfox and type <code>dmesg | grep mcp</code>, you should see something similar:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.165740</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0: setup mode </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> bits/w, </span><span class="token number" style="color:#36acaa">4000000</span><span class="token plain"> Hz max --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.165812</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0: can_rx_offload_init_queue: </span><span class="token assign-left variable" style="color:#36acaa">skb_queue_len_max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0.172937</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> mcp251xfd spi0.0 can0: MCP2518FD rev0.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">-RX_INT </span><span class="token parameter variable" style="color:#36acaa">-MAB_NO_WARN</span><span class="token plain"> +CRC_REG +CRC_RX +CRC_TX +ECC </span><span class="token parameter variable" style="color:#36acaa">-HD</span><span class="token plain"> c:40.00MHz m:4.00MHz r:4.00MHz e:0.00MHz</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> successfully initialized.</span><br></span></code></pre></div></div>
<p>This is okay and the can chip has been initialized</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<p><a href="https://forums.luckfox.com/viewtopic.php?p=4290&amp;hilit=mcp2515#p4290" target="_blank" rel="noopener noreferrer" class="">Luckfox Forum</a><br>
<a href="https://www.devicetree.org/specifications" target="_blank" rel="noopener noreferrer" class="">DeviceTree.org</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106-luckfox-pico-ultra-ipc.dtsi" target="_blank" rel="noopener noreferrer" class="">rv1106-luckfox-pico-ultra-ipc.dtsi</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/arch/arm/boot/dts/rv1106g-luckfox-pico-ultra-w.dts" target="_blank" rel="noopener noreferrer" class="">rv1106g-luckfox-pico-ultra-w.dts</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/sysdrv/source/kernel/include/dt-bindings/interrupt-controller/irq.h" target="_blank" rel="noopener noreferrer" class="">irq.h</a><br>
<a href="https://github.com/LuckfoxTECH/luckfox-pico/blob/994243753789e1b40ef91122e8b3688aae8f01b8/media/sysutils/include/rk_gpio.h" target="_blank" rel="noopener noreferrer" class="">rk_gpio.h</a><br>
<a href="https://notes.rdu.im/system/linux/canbus/" target="_blank" rel="noopener noreferrer" class="">Ruixiang&#x27;s Notes</a></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/luckfox">luckfox</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildroot">buildroot</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/can">can</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/canbus">canbus</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/kernel">kernel</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/dts">dts</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/mcp-251-xfd">mcp251xfd</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/mcp-2518-fd">mcp2518fd</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">linux</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/ego-is-the-enemy"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Егото е Врагът - Райън Холидей, избрани откъси</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lab-setup" class="table-of-contents__link toc-highlight">Lab setup</a></li><li><a href="#buildroot" class="table-of-contents__link toc-highlight">Buildroot</a><ul><li><a href="#add-the-packages-in-buildroot" class="table-of-contents__link toc-highlight">Add the packages in buildroot</a></li></ul></li><li><a href="#kernel-config" class="table-of-contents__link toc-highlight">Kernel config</a><ul><li><a href="#configuring-the-kernel" class="table-of-contents__link toc-highlight">Configuring the Kernel</a></li><li><a href="#device-tree" class="table-of-contents__link toc-highlight">Device Tree</a></li></ul></li><li><a href="#final-preparation" class="table-of-contents__link toc-highlight">Final preparation</a></li><li><a href="#end-result" class="table-of-contents__link toc-highlight">End Result</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Boris Kolev</div></div></div></footer></div>
</body>
</html>